// Generated by HLC 4.0.0 (HL v4)
#include <hl/code.h>

hxsl__Shader hxsl_Cache_getLinkShader(hxsl__Cache r0,hl__types__ArrayObj r1) {
	String r2, r7, r11;
	vvirtual *r15, *r18;
	haxe__ds__StringMap r6, r37;
	hl__types__ArrayObj r3, r28;
	venum *r22, *r23, *r26, *r29, *r31, *r33, *r34, *r35;
	hl_type *r17;
	hxsl__SharedShader r10;
	hl__types__ArrayBytes_Int r19;
	hxsl__Shader r8, r9;
	hxsl__Globals r38;
	hxsl__$Shader r36;
	vclosure *r24, *r25, *r27, *r30, *r32;
	vdynamic *r5, *r14;
	vbyte *r20;
	varray *r16;
	int r12, r13, r21;
	if( r1 == NULL ) hl_null_access();
	r2 = (String)global$438;
	r2 = hl_types_ArrayObj_join(r1,r2);
	r6 = r0->linkShaders;
	if( r6 == NULL ) hl_null_access();
	r5 = haxe_ds_StringMap_get(r6,r2);
	r8 = (hxsl__Shader)r5;
	if( !r8 ) goto label$884$9;
	return r8;
	label$884$9:
	r10 = (hxsl__SharedShader)hl_alloc_obj(hxsl__SharedShader__val);
	r7 = (String)global$8;
	hxsl_SharedShader_new(r10,r7);
	r3 = hl_types_ArrayObj_copy(r1);
	r7 = (String)global$1355;
	r11 = (String)global$440;
	r11 = hl_types_ArrayObj_join(r1,r11);
	r11 = haxe_crypto_Md5_encode(r11);
	if( r11 == NULL ) hl_null_access();
	r12 = 0;
	r13 = 8;
	r14 = hl_alloc_dynamic(&type$3);
	r14->v.i = r13;
	r11 = String_substr(r11,r12,r14);
	r7 = String___add__(r7,r11);
	r15 = hl_alloc_virtual(&type$144);
	if( hl_vfields(r15)[1] ) *(String*)(hl_vfields(r15)[1]) = (String)r7; else hl_dyn_setp(r15->value,150958933/*name*/,&type$13,r7);
	r17 = &type$146;
	r12 = 0;
	r16 = hl_alloc_array(r17,r12);
	r3 = hl_types_ArrayObj_alloc(r16);
	if( hl_vfields(r15)[2] ) *(hl__types__ArrayObj*)(hl_vfields(r15)[2]) = (hl__types__ArrayObj)r3; else hl_dyn_setp(r15->value,239676598/*vars*/,&type$46,r3);
	r17 = &type$3863;
	r12 = 0;
	r16 = hl_alloc_array(r17,r12);
	r3 = hl_types_ArrayObj_alloc(r16);
	if( hl_vfields(r15)[0] ) *(hl__types__ArrayObj*)(hl_vfields(r15)[0]) = (hl__types__ArrayObj)r3; else hl_dyn_setp(r15->value,63237214/*funs*/,&type$46,r3);
	r10->data = r15;
	r18 = NULL;
	r6 = (haxe__ds__StringMap)hl_alloc_obj(haxe__ds__StringMap__val);
	haxe_ds_StringMap_new(r6);
	r12 = 4;
	r20 = hl_alloc_bytes(r12);
	r12 = 0;
	r13 = 0;
	r21 = 2;
	r21 = r12 << r21;
	*(int*)(r20 + r21) = r13;
	++r12;
	r12 = 1;
	r19 = hl_types_ArrayBase_allocI32(r20,r12);
	r12 = 4;
	r23 = (venum*)global$1356;
	r22 = hl_alloc_enum(&type$148,5);
	((hxsl_Type_TVec*)r22)->p0 = r12;
	((hxsl_Type_TVec*)r22)->p1 = r23;
	r24 = hl_alloc_closure_ptr(&type$3848,fun$3869,r18);
	r26 = hl_alloc_enum(&type$3851,0);
	((Enum$3851*)r26)->p0 = (hxsl__SharedShader)r10;
	((Enum$3851*)r26)->p1 = (haxe__ds__StringMap)r6;
	r25 = hl_alloc_closure_ptr(&type$3850,fun$3870,r26);
	r17 = &type$3849;
	r12 = 1;
	r16 = hl_alloc_array(r17,r12);
	r27 = NULL;
	r12 = 0;
	((vclosure**)(r16 + 1))[r12] = r27;
	r3 = hl_types_ArrayObj_alloc(r16);
	if( r3 == NULL ) hl_null_access();
	r12 = 0;
	r29 = hl_alloc_enum(&type$3854,0);
	((Enum$3854*)r29)->p0 = (vvirtual*)r18;
	((Enum$3854*)r29)->p1 = (haxe__ds__StringMap)r6;
	((Enum$3854*)r29)->p2 = (venum*)r22;
	((Enum$3854*)r29)->p3 = (vclosure*)r24;
	((Enum$3854*)r29)->p4 = (vclosure*)r25;
	((Enum$3854*)r29)->p5 = (hl__types__ArrayObj)r3;
	r27 = hl_alloc_closure_ptr(&type$3853,fun$3871,r29);
	r13 = r3->length;
	if( ((unsigned)r12) < ((unsigned)r13) ) goto label$884$77;
	hl_types_ArrayObj___expand(r3,r12);
	label$884$77:
	r16 = r3->array;
	((vclosure**)(r16 + 1))[r12] = r27;
	r31 = hl_alloc_enum(&type$3858,0);
	((Enum$3858*)r31)->p0 = (hxsl__SharedShader)r10;
	((Enum$3858*)r31)->p1 = (vvirtual*)r18;
	((Enum$3858*)r31)->p2 = (hl__types__ArrayBytes_Int)r19;
	((Enum$3858*)r31)->p3 = (venum*)r22;
	((Enum$3858*)r31)->p4 = (hl__types__ArrayObj)r3;
	r30 = hl_alloc_closure_ptr(&type$3857,fun$3872,r31);
	r33 = hl_alloc_enum(&type$3861,0);
	((Enum$3861*)r33)->p0 = (hxsl__SharedShader)r10;
	((Enum$3861*)r33)->p1 = (vvirtual*)r18;
	((Enum$3861*)r33)->p2 = (vclosure*)r30;
	r32 = hl_alloc_closure_ptr(&type$3860,fun$3873,r33);
	if( r32 == NULL ) hl_null_access();
	r34 = (venum*)global$1368;
	r17 = &type$2397;
	r12 = 1;
	r16 = hl_alloc_array(r17,r12);
	r11 = (String)global$1369;
	r14 = NULL;
	r35 = hl_alloc_enum(&type$2397,1);
	((hxsl_Output_Value*)r35)->p0 = r11;
	((hxsl_Output_Value*)r35)->p1 = r14;
	r12 = 0;
	((venum**)(r16 + 1))[r12] = r35;
	r28 = hl_types_ArrayObj_alloc(r16);
	r32->hasValue ? ((void (*)(vdynamic*,venum*,hl__types__ArrayObj))r32->fun)((vdynamic*)r32->value,r34,r28) : ((void (*)(venum*,hl__types__ArrayObj))r32->fun)(r34,r28);
	r34 = (venum*)global$1370;
	r32->hasValue ? ((void (*)(vdynamic*,venum*,hl__types__ArrayObj))r32->fun)((vdynamic*)r32->value,r34,r1) : ((void (*)(venum*,hl__types__ArrayObj))r32->fun)(r34,r1);
	r36 = (hxsl__$Shader)global$63;
	r5 = Type_createEmptyInstance(((hl__Class)r36));
	r9 = (hxsl__Shader)hl_dyn_castp(&r5,&type$9,&type$142);
	if( r9 == NULL ) hl_null_access();
	r9->shader = r10;
	r37 = r0->linkShaders;
	if( r37 == NULL ) hl_null_access();
	haxe_ds_StringMap_set(r37,r2,((vdynamic*)r9));
	r38 = NULL;
	hxsl_Shader_updateConstantsFinal(r9,r38);
	return r9;
}

hxsl__RuntimeShader hxsl_Cache_link(hxsl__Cache r0,hxsl__ShaderList r1) {
	hxsl__RuntimeShader r14;
	haxe__ds__IntMap r9;
	hxsl__ShaderInstance r8;
	hxsl__Shader r7;
	hxsl__SearchMap r2, r10, r13;
	hxsl__ShaderList r4, r5, r6;
	vdynamic *r11;
	int r12;
	r2 = r0->linkCache;
	r4 = r1;
	r5 = NULL;
	label$885$3:
	if( r4 == r5 ) goto label$885$33;
	if( r4 == NULL ) hl_null_access();
	r7 = r4->s;
	r6 = r4->next;
	r4 = r6;
	if( r7 == NULL ) hl_null_access();
	r8 = r7->instance;
	if( r2 == NULL ) hl_null_access();
	r9 = r2->next;
	if( r9 ) goto label$885$17;
	r9 = (haxe__ds__IntMap)hl_alloc_obj(haxe__ds__IntMap__val);
	haxe_ds_IntMap_new(r9);
	r2->next = r9;
	label$885$17:
	r9 = r2->next;
	if( r9 == NULL ) hl_null_access();
	if( r8 == NULL ) hl_null_access();
	r12 = r8->id;
	r11 = haxe_ds_IntMap_get(r9,r12);
	r10 = (hxsl__SearchMap)r11;
	if( r10 ) goto label$885$31;
	r13 = (hxsl__SearchMap)hl_alloc_obj(hxsl__SearchMap__val);
	hxsl_SearchMap_new(r13);
	r10 = r13;
	r9 = r2->next;
	if( r9 == NULL ) hl_null_access();
	r12 = r8->id;
	haxe_ds_IntMap_set(r9,r12,((vdynamic*)r10));
	label$885$31:
	r2 = r10;
	goto label$885$3;
	label$885$33:
	if( r2 == NULL ) hl_null_access();
	r14 = r2->linked;
	if( r14 ) goto label$885$38;
	r14 = hxsl_Cache_compileRuntimeShader(r0,r1);
	r2->linked = r14;
	label$885$38:
	r14 = r2->linked;
	return r14;
}

hxsl__RuntimeShader hxsl_Cache_compileRuntimeShader(hxsl__Cache r0,hxsl__ShaderList r1) {
	hxsl__RuntimeShader r49, r52;
	bool *r31;
	String r30, r32, r33;
	haxe__ds__StringMap r58;
	vvirtual *r13, *r23, *r25, *r37, *r40, *r44, *r48, *r53;
	hl__types__ArrayObj r2, r12, r22, r24;
	hxsl__RuntimeShaderData r57;
	venum *r36, *r38, *r39;
	hl_type *r4;
	bool r28;
	hxsl__SharedShader r51;
	hxsl___Linker__AllocatedVar r35;
	haxe__ds__IntMap r34, r41;
	hxsl__Linker r18;
	hxsl__ShaderInstance r14;
	hxsl__Error r26, r29, r46;
	hxsl__Shader r10;
	hxsl__Splitter r45;
	hxsl__$Error r27;
	hxsl__ShaderList r7, r8, r9;
	vclosure *r16, *r17;
	hl__types__ArrayDyn r15;
	int *r55;
	hxsl__ShaderInstanceDesc r50;
	hxsl__Dce r47;
	vdynamic *r19, *r43;
	vbyte *r56;
	int r5, r11, r20, r21, r42, r54;
	varray *r3;
	hl_trap_ctx trap$0;
	r4 = &type$3869;
	r5 = 0;
	r3 = hl_alloc_array(r4,r5);
	r2 = hl_types_ArrayObj_alloc(r3);
	r5 = 0;
	r7 = r1;
	r8 = NULL;
	label$886$7:
	if( r7 == r8 ) goto label$886$25;
	if( r7 == NULL ) hl_null_access();
	r10 = r7->s;
	r9 = r7->next;
	r7 = r9;
	if( r2 == NULL ) hl_null_access();
	r13 = hl_alloc_virtual(&type$3869);
	if( r10 == NULL ) hl_null_access();
	r14 = r10->instance;
	if( hl_vfields(r13)[1] ) *(hxsl__ShaderInstance*)(hl_vfields(r13)[1]) = (hxsl__ShaderInstance)r14; else hl_dyn_setp(r13->value,96158928/*inst*/,&type$151,r14);
	r11 = r10->priority;
	if( hl_vfields(r13)[2] ) *(int*)(hl_vfields(r13)[2]) = (int)r11; else hl_dyn_seti(r13->value,112/*p*/,&type$3,r11);
	r11 = r5;
	++r5;
	if( hl_vfields(r13)[0] ) *(int*)(hl_vfields(r13)[0]) = (int)r11; else hl_dyn_seti(r13->value,-32204280/*index*/,&type$3,r11);
	r11 = hl_types_ArrayObj_push(r2,((vdynamic*)r13));
	goto label$886$7;
	label$886$25:
	if( r2 == NULL ) hl_null_access();
	hl_types_ArrayObj_reverse(r2);
	r15 = (hl__types__ArrayDyn)hl_dyn_castp(&r2,&type$46,&type$321);
	r16 = &cl$3874;
	if( r16 ) goto label$886$32;
	r17 = NULL;
	goto label$886$33;
	label$886$32:
	r17 = hl_alloc_closure_ptr(&type$3870,fun$3875,r16);
	label$886$33:
	haxe_ds_ArraySort_sort(r15,r17);
	r18 = (hxsl__Linker)hl_alloc_obj(hxsl__Linker__val);
	hxsl_Linker_new(r18);
	hl_trap(trap$0,r19,label$886$67);
	r4 = &type$144;
	r11 = 0;
	r3 = hl_alloc_array(r4,r11);
	r12 = hl_types_ArrayObj_alloc(r3);
	r11 = 0;
	label$886$42:
	if( r2 == NULL ) hl_null_access();
	r21 = r2->length;
	if( r11 >= r21 ) goto label$886$62;
	if( r12 == NULL ) hl_null_access();
	r20 = r11;
	++r11;
	r21 = r2->length;
	if( ((unsigned)r20) < ((unsigned)r21) ) goto label$886$53;
	r13 = NULL;
	goto label$886$56;
	label$886$53:
	r3 = r2->array;
	r19 = ((vdynamic**)(r3 + 1))[r20];
	r13 = hl_to_virtual(&type$3869,(vdynamic*)r19);
	label$886$56:
	if( r13 == NULL ) hl_null_access();
	r14 = hl_vfields(r13)[1] ? (*(hxsl__ShaderInstance*)(hl_vfields(r13)[1])) : (hxsl__ShaderInstance)hl_dyn_getp(r13->value,96158928/*inst*/,&type$151);
	if( r14 == NULL ) hl_null_access();
	r23 = r14->shader;
	r20 = hl_types_ArrayObj_push(r12,((vdynamic*)r23));
	goto label$886$42;
	label$886$62:
	if( r18 == NULL ) hl_null_access();
	r25 = hxsl_Linker_link(r18,r12);
	r23 = r25;
	hl_endtrap(trap$0);
	goto label$886$110;
	label$886$67:
	r27 = (hxsl__$Error)global$1343;
	r28 = hl_BaseType_check(((hl__BaseType)r27),r19);
	if( !r28 ) goto label$886$109;
	r29 = (hxsl__Error)r19;
	r26 = r29;
	r4 = &type$13;
	r11 = 0;
	r3 = hl_alloc_array(r4,r11);
	r12 = hl_types_ArrayObj_alloc(r3);
	r11 = 0;
	label$886$77:
	if( r2 == NULL ) hl_null_access();
	r21 = r2->length;
	if( r11 >= r21 ) goto label$886$99;
	if( r12 == NULL ) hl_null_access();
	r20 = r11;
	++r11;
	r21 = r2->length;
	if( ((unsigned)r20) < ((unsigned)r21) ) goto label$886$88;
	r13 = NULL;
	goto label$886$91;
	label$886$88:
	r3 = r2->array;
	r19 = ((vdynamic**)(r3 + 1))[r20];
	r13 = hl_to_virtual(&type$3869,(vdynamic*)r19);
	label$886$91:
	if( r13 == NULL ) hl_null_access();
	r14 = hl_vfields(r13)[1] ? (*(hxsl__ShaderInstance*)(hl_vfields(r13)[1])) : (hxsl__ShaderInstance)hl_dyn_getp(r13->value,96158928/*inst*/,&type$151);
	if( r14 == NULL ) hl_null_access();
	r25 = r14->shader;
	r31 = NULL;
	r30 = hxsl_Printer_shaderToString(r25,r31);
	r20 = hl_types_ArrayObj_push(r12,((vdynamic*)r30));
	goto label$886$77;
	label$886$99:
	if( r26 == NULL ) hl_null_access();
	r30 = r26->msg;
	r32 = (String)global$534;
	if( r12 == NULL ) hl_null_access();
	r33 = (String)global$1374;
	r33 = hl_types_ArrayObj_join(r12,r33);
	r32 = String___add__(r32,r33);
	r30 = String___add__(r30,r32);
	r26->msg = r30;
	hl_throw((vdynamic*)r26);
	label$886$109:
	hl_rethrow((vdynamic*)r19);
	label$886$110:
	r34 = (haxe__ds__IntMap)hl_alloc_obj(haxe__ds__IntMap__val);
	haxe_ds_IntMap_new(r34);
	r11 = 0;
	r12 = r18->allVars;
	label$886$114:
	if( r12 == NULL ) hl_null_access();
	r21 = r12->length;
	if( r11 >= r21 ) goto label$886$176;
	r21 = r12->length;
	if( ((unsigned)r11) < ((unsigned)r21) ) goto label$886$122;
	r35 = NULL;
	goto label$886$125;
	label$886$122:
	r3 = r12->array;
	r19 = ((vdynamic**)(r3 + 1))[r11];
	r35 = (hxsl___Linker__AllocatedVar)r19;
	label$886$125:
	++r11;
	if( r35 == NULL ) hl_null_access();
	r37 = r35->v;
	if( r37 == NULL ) hl_null_access();
	r36 = hl_vfields(r37)[1] ? (*(venum**)(hl_vfields(r37)[1])) : (venum*)hl_dyn_getp(r37->value,118088286/*kind*/,&type$147);
	r38 = (venum*)global$1375;
	if( r36 != r38 ) goto label$886$175;
	r37 = r35->v;
	if( r37 == NULL ) hl_null_access();
	r39 = hl_vfields(r37)[5] ? (*(venum**)(hl_vfields(r37)[5])) : (venum*)hl_dyn_getp(r37->value,218690500/*type*/,&type$148);
	if( r39 == NULL ) hl_null_access();
	r20 = HL__ENUM_INDEX__(r39);
	r21 = 13;
	if( r20 != r21 ) goto label$886$140;
	goto label$886$114;
	label$886$140:
	if( r2 == NULL ) hl_null_access();
	r20 = r35->instanceIndex;
	r21 = r2->length;
	if( ((unsigned)r20) < ((unsigned)r21) ) goto label$886$146;
	r13 = NULL;
	goto label$886$149;
	label$886$146:
	r3 = r2->array;
	r19 = ((vdynamic**)(r3 + 1))[r20];
	r13 = hl_to_virtual(&type$3869,(vdynamic*)r19);
	label$886$149:
	if( r34 == NULL ) hl_null_access();
	r20 = r35->id;
	r40 = hl_alloc_virtual(&type$3874);
	if( r13 == NULL ) hl_null_access();
	r21 = hl_vfields(r13)[0] ? (*(int*)(hl_vfields(r13)[0])) : (int)hl_dyn_geti(r13->value,-32204280/*index*/,&type$3);
	if( hl_vfields(r40)[1] ) *(int*)(hl_vfields(r40)[1]) = (int)r21; else hl_dyn_seti(r40->value,434184351/*instance*/,&type$3,r21);
	r14 = hl_vfields(r13)[1] ? (*(hxsl__ShaderInstance*)(hl_vfields(r13)[1])) : (hxsl__ShaderInstance)hl_dyn_getp(r13->value,96158928/*inst*/,&type$151);
	if( r14 == NULL ) hl_null_access();
	r41 = r14->params;
	if( r41 == NULL ) hl_null_access();
	r22 = r35->merged;
	if( r22 == NULL ) hl_null_access();
	r21 = 0;
	r42 = r22->length;
	if( ((unsigned)r21) < ((unsigned)r42) ) goto label$886$166;
	r37 = NULL;
	goto label$886$169;
	label$886$166:
	r3 = r22->array;
	r19 = ((vdynamic**)(r3 + 1))[r21];
	r37 = hl_to_virtual(&type$146,(vdynamic*)r19);
	label$886$169:
	if( r37 == NULL ) hl_null_access();
	r21 = hl_vfields(r37)[0] ? (*(int*)(hl_vfields(r37)[0])) : (int)hl_dyn_geti(r37->value,23515/*id*/,&type$3);
	r19 = haxe_ds_IntMap_get(r41,r21);
	r43 = (vdynamic*)r19;
	if( hl_vfields(r40)[0] ) *(vdynamic**)(hl_vfields(r40)[0]) = (vdynamic*)r43; else hl_dyn_setp(r40->value,-32204280/*index*/,&type$127,r43);
	haxe_ds_IntMap_set(r34,r20,((vdynamic*)r40));
	label$886$175:
	goto label$886$114;
	label$886$176:
	hl_trap(trap$0,r19,label$886$182);
	r45 = (hxsl__Splitter)hl_alloc_obj(hxsl__Splitter__val);
	hxsl_Splitter_new(r45);
	r44 = hxsl_Splitter_split(r45,r23);
	hl_endtrap(trap$0);
	goto label$886$196;
	label$886$182:
	r27 = (hxsl__$Error)global$1343;
	r28 = hl_BaseType_check(((hl__BaseType)r27),r19);
	if( !r28 ) goto label$886$195;
	r46 = (hxsl__Error)r19;
	if( r46 == NULL ) hl_null_access();
	r30 = r46->msg;
	r32 = (String)global$534;
	r31 = NULL;
	r33 = hxsl_Printer_shaderToString(r23,r31);
	r32 = String___add__(r32,r33);
	r30 = String___add__(r30,r32);
	r46->msg = r30;
	hl_throw((vdynamic*)r46);
	label$886$195:
	hl_rethrow((vdynamic*)r19);
	label$886$196:
	r47 = (hxsl__Dce)hl_alloc_obj(hxsl__Dce__val);
	hxsl_Dce_new(r47);
	if( r44 == NULL ) hl_null_access();
	r25 = hl_vfields(r44)[1] ? (*(vvirtual**)(hl_vfields(r44)[1])) : (vvirtual*)hl_dyn_getp(r44->value,-515384742/*vertex*/,&type$144);
	r48 = hl_vfields(r44)[0] ? (*(vvirtual**)(hl_vfields(r44)[0])) : (vvirtual*)hl_dyn_getp(r44->value,-303735098/*fragment*/,&type$144);
	r44 = hxsl_Dce_dce(r47,r25,r48);
	if( r44 == NULL ) hl_null_access();
	r25 = hl_vfields(r44)[1] ? (*(vvirtual**)(hl_vfields(r44)[1])) : (vvirtual*)hl_dyn_getp(r44->value,-515384742/*vertex*/,&type$144);
	r48 = hl_vfields(r44)[0] ? (*(vvirtual**)(hl_vfields(r44)[0])) : (vvirtual*)hl_dyn_getp(r44->value,-303735098/*fragment*/,&type$144);
	r49 = hxsl_Cache_buildRuntimeShader(r0,r25,r48,r34);
	r4 = &type$3878;
	r11 = 0;
	r3 = hl_alloc_array(r4,r11);
	r12 = hl_types_ArrayObj_alloc(r3);
	r7 = r1;
	r8 = NULL;
	label$886$212:
	if( r7 == r8 ) goto label$886$226;
	if( r7 == NULL ) hl_null_access();
	r10 = r7->s;
	r9 = r7->next;
	r7 = r9;
	if( r12 == NULL ) hl_null_access();
	r50 = (hxsl__ShaderInstanceDesc)hl_alloc_obj(hxsl__ShaderInstanceDesc__val);
	if( r10 == NULL ) hl_null_access();
	r51 = r10->shader;
	r11 = r10->constBits;
	hxsl_ShaderInstanceDesc_new(r50,r51,r11);
	r11 = hl_types_ArrayObj_push(r12,((vdynamic*)r50));
	goto label$886$212;
	label$886$226:
	if( r49 == NULL ) hl_null_access();
	r53 = hl_alloc_virtual(&type$206);
	if( hl_vfields(r53)[0] ) *(hl__types__ArrayObj*)(hl_vfields(r53)[0]) = (hl__types__ArrayObj)r12; else hl_dyn_setp(r53->value,186287176/*instances*/,&type$46,r12);
	r30 = NULL;
	if( hl_vfields(r53)[1] ) *(String*)(hl_vfields(r53)[1]) = (String)r30; else hl_dyn_setp(r53->value,359375608/*signature*/,&type$13,r30);
	r49->spec = r53;
	r11 = 0;
	if( r2 == NULL ) hl_null_access();
	r20 = r2->length;
	label$886$235:
	if( r11 >= r20 ) goto label$886$268;
	r21 = r11;
	++r11;
	if( r49 == NULL ) hl_null_access();
	r53 = r49->spec;
	if( r53 == NULL ) hl_null_access();
	r22 = hl_vfields(r53)[0] ? (*(hl__types__ArrayObj*)(hl_vfields(r53)[0])) : (hl__types__ArrayObj)hl_dyn_getp(r53->value,186287176/*instances*/,&type$46);
	if( r22 == NULL ) hl_null_access();
	if( r2 == NULL ) hl_null_access();
	r42 = r2->length;
	r54 = 1;
	r42 = r42 - r54;
	r42 = r42 - r21;
	r54 = r2->length;
	if( ((unsigned)r42) < ((unsigned)r54) ) goto label$886$253;
	r13 = NULL;
	goto label$886$256;
	label$886$253:
	r3 = r2->array;
	r19 = ((vdynamic**)(r3 + 1))[r42];
	r13 = hl_to_virtual(&type$3869,(vdynamic*)r19);
	label$886$256:
	if( r13 == NULL ) hl_null_access();
	r42 = hl_vfields(r13)[0] ? (*(int*)(hl_vfields(r13)[0])) : (int)hl_dyn_geti(r13->value,-32204280/*index*/,&type$3);
	r54 = r22->length;
	if( ((unsigned)r42) < ((unsigned)r54) ) goto label$886$262;
	r50 = NULL;
	goto label$886$265;
	label$886$262:
	r3 = r22->array;
	r19 = ((vdynamic**)(r3 + 1))[r42];
	r50 = (hxsl__ShaderInstanceDesc)r19;
	label$886$265:
	if( r50 == NULL ) hl_null_access();
	r50->index = r21;
	goto label$886$235;
	label$886$268:
	r4 = &type$13;
	r11 = 0;
	r3 = hl_alloc_array(r4,r11);
	r22 = hl_types_ArrayObj_alloc(r3);
	r11 = 0;
	if( r49 == NULL ) hl_null_access();
	r53 = r49->spec;
	if( r53 == NULL ) hl_null_access();
	r24 = hl_vfields(r53)[0] ? (*(hl__types__ArrayObj*)(hl_vfields(r53)[0])) : (hl__types__ArrayObj)hl_dyn_getp(r53->value,186287176/*instances*/,&type$46);
	label$886$277:
	if( r24 == NULL ) hl_null_access();
	r21 = r24->length;
	if( r11 >= r21 ) goto label$886$312;
	r21 = r24->length;
	if( ((unsigned)r11) < ((unsigned)r21) ) goto label$886$285;
	r50 = NULL;
	goto label$886$288;
	label$886$285:
	r3 = r24->array;
	r19 = ((vdynamic**)(r3 + 1))[r11];
	r50 = (hxsl__ShaderInstanceDesc)r19;
	label$886$288:
	++r11;
	if( r22 == NULL ) hl_null_access();
	if( r50 == NULL ) hl_null_access();
	r51 = r50->shader;
	if( r51 == NULL ) hl_null_access();
	r25 = r51->data;
	if( r25 == NULL ) hl_null_access();
	r30 = hl_vfields(r25)[1] ? (*(String*)(hl_vfields(r25)[1])) : (String)hl_dyn_getp(r25->value,150958933/*name*/,&type$13);
	r32 = (String)global$1228;
	r30 = String___add__(r30,r32);
	r20 = r50->bits;
	r55 = &r20;
	r56 = hl_itos(r20,r55);
	r32 = String___alloc__(r56,r20);
	r30 = String___add__(r30,r32);
	r32 = (String)global$1228;
	r30 = String___add__(r30,r32);
	r20 = r50->index;
	r55 = &r20;
	r56 = hl_itos(r20,r55);
	r32 = String___alloc__(r56,r20);
	r30 = String___add__(r30,r32);
	r20 = hl_types_ArrayObj_push(r22,((vdynamic*)r30));
	goto label$886$277;
	label$886$312:
	if( r22 == NULL ) hl_null_access();
	r30 = (String)global$440;
	r30 = hl_types_ArrayObj_join(r22,r30);
	if( r49 == NULL ) hl_null_access();
	r53 = r49->spec;
	if( r53 == NULL ) hl_null_access();
	r32 = haxe_crypto_Md5_encode(r30);
	if( hl_vfields(r53)[1] ) *(String*)(hl_vfields(r53)[1]) = (String)r32; else hl_dyn_setp(r53->value,359375608/*signature*/,&type$13,r32);
	r57 = r49->vertex;
	if( r57 == NULL ) hl_null_access();
	r25 = r57->data;
	r31 = NULL;
	r32 = hxsl_Printer_shaderToString(r25,r31);
	r57 = r49->fragment;
	if( r57 == NULL ) hl_null_access();
	r25 = r57->data;
	r31 = NULL;
	r33 = hxsl_Printer_shaderToString(r25,r31);
	r32 = String___add__(r32,r33);
	r32 = haxe_crypto_Md5_encode(r32);
	r49->signature = r32;
	r58 = r0->byID;
	if( r58 == NULL ) hl_null_access();
	r32 = r49->signature;
	r19 = haxe_ds_StringMap_get(r58,r32);
	r52 = (hxsl__RuntimeShader)r19;
	if( !r52 ) goto label$886$343;
	if( r52 == NULL ) hl_null_access();
	r11 = r52->id;
	r49->id = r11;
	goto label$886$347;
	label$886$343:
	r58 = r0->byID;
	if( r58 == NULL ) hl_null_access();
	r32 = r49->signature;
	haxe_ds_StringMap_set(r58,r32,((vdynamic*)r49));
	label$886$347:
	return r49;
}

hxsl__RuntimeShader hxsl_Cache_buildRuntimeShader(hxsl__Cache r0,vvirtual* r1,vvirtual* r2,haxe__ds__IntMap r3) {
	hxsl__RuntimeShader r4;
	venum *r7;
	hxsl__RuntimeShaderData r6;
	bool r9;
	haxe__ds__IntMap r8;
	r4 = (hxsl__RuntimeShader)hl_alloc_obj(hxsl__RuntimeShader__val);
	hxsl_RuntimeShader_new(r4);
	r7 = (venum*)global$1368;
	r6 = hxsl_Cache_flattenShader(r0,r1,r7,r3);
	r4->vertex = r6;
	r6 = r4->vertex;
	if( r6 == NULL ) hl_null_access();
	r9 = true;
	r6->vertex = r9;
	r7 = (venum*)global$1370;
	r6 = hxsl_Cache_flattenShader(r0,r2,r7,r3);
	r4->fragment = r6;
	r8 = (haxe__ds__IntMap)hl_alloc_obj(haxe__ds__IntMap__val);
	haxe_ds_IntMap_new(r8);
	r4->globals = r8;
	r6 = r4->vertex;
	hxsl_Cache_initGlobals(r0,r4,r6);
	r6 = r4->fragment;
	hxsl_Cache_initGlobals(r0,r4,r6);
	return r4;
}

void hxsl_Cache_initGlobals(hxsl__Cache r0,hxsl__RuntimeShader r1,hxsl__RuntimeShaderData r2) {
	bool r8;
	hxsl__AllocGlobal r3, r5;
	haxe__ds__IntMap r6;
	hxsl__AllocParam r10, r11;
	vdynamic *r9;
	int r7;
	if( r2 == NULL ) hl_null_access();
	r3 = r2->globals;
	label$888$2:
	if( !r3 ) goto label$888$15;
	if( r1 == NULL ) hl_null_access();
	r6 = r1->globals;
	if( r6 == NULL ) hl_null_access();
	if( r3 == NULL ) hl_null_access();
	r7 = r3->gid;
	r8 = true;
	r9 = hl_alloc_dynbool(r8);
	haxe_ds_IntMap_set(r6,r7,r9);
	r5 = r3->next;
	r3 = r5;
	goto label$888$2;
	label$888$15:
	if( r2 == NULL ) hl_null_access();
	r10 = r2->params;
	label$888$17:
	if( !r10 ) goto label$888$34;
	if( r10 == NULL ) hl_null_access();
	r5 = r10->perObjectGlobal;
	if( !r5 ) goto label$888$31;
	if( r1 == NULL ) hl_null_access();
	r6 = r1->globals;
	if( r6 == NULL ) hl_null_access();
	r5 = r10->perObjectGlobal;
	if( r5 == NULL ) hl_null_access();
	r7 = r5->gid;
	r8 = true;
	r9 = hl_alloc_dynbool(r8);
	haxe_ds_IntMap_set(r6,r7,r9);
	label$888$31:
	r11 = r10->next;
	r10 = r11;
	goto label$888$17;
	label$888$34:
	return;
}

String hxsl_Cache_getPath(hxsl__Cache r0,vvirtual* r1) {
	String r3, r4;
	vvirtual *r2;
	if( r1 == NULL ) hl_null_access();
	r2 = hl_vfields(r1)[3] ? (*(vvirtual**)(hl_vfields(r1)[3])) : (vvirtual*)hl_dyn_getp(r1->value,-310508246/*parent*/,&type$146);
	if( r2 ) goto label$889$5;
	r3 = hl_vfields(r1)[2] ? (*(String*)(hl_vfields(r1)[2])) : (String)hl_dyn_getp(r1->value,150958933/*name*/,&type$13);
	return r3;
	label$889$5:
	r2 = hl_vfields(r1)[3] ? (*(vvirtual**)(hl_vfields(r1)[3])) : (vvirtual*)hl_dyn_getp(r1->value,-310508246/*parent*/,&type$146);
	r3 = hxsl_Cache_getPath(r0,r2);
	r4 = (String)global$210;
	r3 = String___add__(r3,r4);
	r4 = hl_vfields(r1)[2] ? (*(String*)(hl_vfields(r1)[2])) : (String)hl_dyn_getp(r1->value,150958933/*name*/,&type$13);
	r3 = String___add__(r3,r4);
	return r3;
}

hxsl__RuntimeShaderData hxsl_Cache_flattenShader(hxsl__Cache r0,vvirtual* r1,venum* r2,haxe__ds__IntMap r3) {
	String r23;
	haxe__ds__ObjectMap r15;
	hl__types__ArrayObj r9, r21, r24;
	vvirtual *r7, *r18, *r20, *r36, *r40;
	venum *r22, *r29, *r33, *r34, *r35, *r39;
	hl_type *r11;
	hxsl__RuntimeShaderData r6;
	bool r8;
	hxsl__AllocGlobal r28, r32;
	hxsl__Flatten r4;
	hxsl__AllocParam r37, r38;
	hxsl___Flatten__Alloc r27;
	hl__types__ArrayBytes_Float r13;
	vclosure *r16, *r19, *r41, *r42;
	vdynamic *r14, *r17;
	int r12, r25, r26, r30, r31;
	varray *r10;
	r4 = (hxsl__Flatten)hl_alloc_obj(hxsl__Flatten__val);
	hxsl_Flatten_new(r4);
	r6 = (hxsl__RuntimeShaderData)hl_alloc_obj(hxsl__RuntimeShaderData__val);
	hxsl_RuntimeShaderData_new(r6);
	r8 = r0->constsToGlobal;
	r7 = hxsl_Flatten_flatten(r4,r1,r2,r8);
	r11 = &type$3883;
	r12 = 0;
	r10 = hl_alloc_array(r11,r12);
	r9 = hl_types_ArrayObj_alloc(r10);
	r13 = r4->consts;
	r6->consts = r13;
	r12 = 0;
	r6->texturesCount = r12;
	r15 = r4->allocData;
	if( r15 == NULL ) hl_null_access();
	r14 = haxe_ds_ObjectMap_keys(r15);
	label$890$17:
	if( r14 == NULL ) hl_null_access();
	r16 = (vclosure*)hl_dyn_getp((vdynamic*)r14,407283053/*hasNext*/,&type$118);
	if( r16 == NULL ) hl_null_access();
	r8 = r16->hasValue ? ((bool (*)(vdynamic*))r16->fun)((vdynamic*)r16->value) : ((bool (*)(void))r16->fun)();
	if( !r8 ) goto label$890$314;
	r19 = (vclosure*)hl_dyn_getp((vdynamic*)r14,151160317/*next*/,&type$3887);
	if( r19 == NULL ) hl_null_access();
	r18 = r19->hasValue ? ((vvirtual* (*)(vdynamic*))r19->fun)((vdynamic*)r19->value) : ((vvirtual* (*)(void))r19->fun)();
	if( r4 == NULL ) hl_null_access();
	r15 = r4->allocData;
	if( r15 == NULL ) hl_null_access();
	r17 = haxe_ds_ObjectMap_get(r15,((vdynamic*)r18));
	r21 = (hl__types__ArrayObj)hl_dyn_castp(&r17,&type$9,&type$46);
	if( r18 == NULL ) hl_null_access();
	r22 = hl_vfields(r18)[1] ? (*(venum**)(hl_vfields(r18)[1])) : (venum*)hl_dyn_getp(r18->value,118088286/*kind*/,&type$147);
	if( r22 == NULL ) hl_null_access();
	r12 = HL__ENUM_INDEX__(r22);
	switch(r12) {
		default:
		case 1:
			r23 = (String)global$319;
			hl_throw((vdynamic*)r23);
		case 0:
			r11 = &type$205;
			r12 = 0;
			r10 = hl_alloc_array(r11,r12);
			r24 = hl_types_ArrayObj_alloc(r10);
			r12 = 0;
			label$890$43:
			if( r21 == NULL ) hl_null_access();
			r26 = r21->length;
			if( r12 >= r26 ) goto label$890$69;
			r26 = r21->length;
			if( ((unsigned)r12) < ((unsigned)r26) ) goto label$890$51;
			r27 = NULL;
			goto label$890$54;
			label$890$51:
			r10 = r21->array;
			r17 = ((vdynamic**)(r10 + 1))[r12];
			r27 = (hxsl___Flatten__Alloc)r17;
			label$890$54:
			++r12;
			if( r27 == NULL ) hl_null_access();
			r20 = r27->v;
			if( !r20 ) goto label$890$68;
			if( r24 == NULL ) hl_null_access();
			r28 = (hxsl__AllocGlobal)hl_alloc_obj(hxsl__AllocGlobal__val);
			r25 = r27->pos;
			r20 = r27->v;
			r23 = hxsl_Cache_getPath(r0,r20);
			r20 = r27->v;
			if( r20 == NULL ) hl_null_access();
			r29 = hl_vfields(r20)[5] ? (*(venum**)(hl_vfields(r20)[5])) : (venum*)hl_dyn_getp(r20->value,218690500/*type*/,&type$148);
			hxsl_AllocGlobal_new(r28,r25,r23,r29);
			r25 = hl_types_ArrayObj_push(r24,((vdynamic*)r28));
			label$890$68:
			goto label$890$43;
			label$890$69:
			r12 = 0;
			if( r24 == NULL ) hl_null_access();
			r25 = r24->length;
			r26 = 1;
			r25 = r25 - r26;
			label$890$74:
			if( r12 >= r25 ) goto label$890$98;
			r26 = r12;
			++r12;
			if( r24 == NULL ) hl_null_access();
			r31 = r24->length;
			if( ((unsigned)r26) < ((unsigned)r31) ) goto label$890$83;
			r28 = NULL;
			goto label$890$86;
			label$890$83:
			r10 = r24->array;
			r17 = ((vdynamic**)(r10 + 1))[r26];
			r28 = (hxsl__AllocGlobal)r17;
			label$890$86:
			if( r28 == NULL ) hl_null_access();
			r31 = 1;
			r30 = r26 + r31;
			r31 = r24->length;
			if( ((unsigned)r30) < ((unsigned)r31) ) goto label$890$93;
			r32 = NULL;
			goto label$890$96;
			label$890$93:
			r10 = r24->array;
			r17 = ((vdynamic**)(r10 + 1))[r30];
			r32 = (hxsl__AllocGlobal)r17;
			label$890$96:
			r28->next = r32;
			goto label$890$74;
			label$890$98:
			if( r18 == NULL ) hl_null_access();
			r29 = hl_vfields(r18)[5] ? (*(venum**)(hl_vfields(r18)[5])) : (venum*)hl_dyn_getp(r18->value,218690500/*type*/,&type$148);
			if( r29 == NULL ) hl_null_access();
			r12 = HL__ENUM_INDEX__(r29);
			r25 = 15;
			if( r12 != r25 ) goto label$890$139;
			r33 = ((hxsl_Type_TArray*)r29)->p0;
			if( r33 == NULL ) hl_null_access();
			r12 = HL__ENUM_INDEX__(r33);
			r25 = 5;
			if( r12 != r25 ) goto label$890$139;
			r33 = ((hxsl_Type_TArray*)r29)->p0;
			r12 = ((hxsl_Type_TVec*)r33)->p0;
			r25 = 4;
			if( r12 != r25 ) goto label$890$139;
			r33 = ((hxsl_Type_TArray*)r29)->p0;
			r34 = ((hxsl_Type_TVec*)r33)->p1;
			if( r34 == NULL ) hl_null_access();
			r12 = HL__ENUM_INDEX__(r34);
			r25 = 1;
			if( r12 != r25 ) goto label$890$139;
			r35 = ((hxsl_Type_TArray*)r29)->p1;
			if( r35 == NULL ) hl_null_access();
			r12 = HL__ENUM_INDEX__(r35);
			r25 = 0;
			if( r12 != r25 ) goto label$890$139;
			if( r6 == NULL ) hl_null_access();
			if( r24 == NULL ) hl_null_access();
			r12 = 0;
			r25 = r24->length;
			if( ((unsigned)r12) < ((unsigned)r25) ) goto label$890$131;
			r28 = NULL;
			goto label$890$134;
			label$890$131:
			r10 = r24->array;
			r17 = ((vdynamic**)(r10 + 1))[r12];
			r28 = (hxsl__AllocGlobal)r17;
			label$890$134:
			r6->globals = r28;
			r35 = ((hxsl_Type_TArray*)r29)->p1;
			r12 = ((hxsl_SizeDecl_SConst*)r35)->p0;
			r6->globalsSize = r12;
			goto label$890$141;
			label$890$139:
			r23 = (String)global$319;
			hl_throw((vdynamic*)r23);
			label$890$141:
			goto label$890$313;
		case 2:
			r11 = &type$204;
			r12 = 0;
			r10 = hl_alloc_array(r11,r12);
			r24 = hl_types_ArrayObj_alloc(r10);
			r12 = 0;
			label$890$147:
			if( r21 == NULL ) hl_null_access();
			r26 = r21->length;
			if( r12 >= r26 ) goto label$890$208;
			r26 = r21->length;
			if( ((unsigned)r12) < ((unsigned)r26) ) goto label$890$155;
			r27 = NULL;
			goto label$890$158;
			label$890$155:
			r10 = r21->array;
			r17 = ((vdynamic**)(r10 + 1))[r12];
			r27 = (hxsl___Flatten__Alloc)r17;
			label$890$158:
			++r12;
			if( r27 == NULL ) hl_null_access();
			r20 = r27->v;
			if( r20 ) goto label$890$163;
			goto label$890$147;
			label$890$163:
			if( r3 == NULL ) hl_null_access();
			r20 = r27->v;
			if( r20 == NULL ) hl_null_access();
			r25 = hl_vfields(r20)[0] ? (*(int*)(hl_vfields(r20)[0])) : (int)hl_dyn_geti(r20->value,23515/*id*/,&type$3);
			r17 = haxe_ds_IntMap_get(r3,r25);
			r36 = hl_to_virtual(&type$3889,(vdynamic*)r17);
			if( r36 ) goto label$890$193;
			r37 = (hxsl__AllocParam)hl_alloc_obj(hxsl__AllocParam__val);
			r20 = r27->v;
			if( r20 == NULL ) hl_null_access();
			r23 = hl_vfields(r20)[2] ? (*(String*)(hl_vfields(r20)[2])) : (String)hl_dyn_getp(r20->value,150958933/*name*/,&type$13);
			r25 = r27->pos;
			r26 = -1;
			r30 = -1;
			r20 = r27->v;
			if( r20 == NULL ) hl_null_access();
			r29 = hl_vfields(r20)[5] ? (*(venum**)(hl_vfields(r20)[5])) : (venum*)hl_dyn_getp(r20->value,218690500/*type*/,&type$148);
			hxsl_AllocParam_new(r37,r23,r25,r26,r30,r29);
			r28 = (hxsl__AllocGlobal)hl_alloc_obj(hxsl__AllocGlobal__val);
			r25 = -1;
			r20 = r27->v;
			r23 = hxsl_Cache_getPath(r0,r20);
			r20 = r27->v;
			if( r20 == NULL ) hl_null_access();
			r29 = hl_vfields(r20)[5] ? (*(venum**)(hl_vfields(r20)[5])) : (venum*)hl_dyn_getp(r20->value,218690500/*type*/,&type$148);
			hxsl_AllocGlobal_new(r28,r25,r23,r29);
			r37->perObjectGlobal = r28;
			if( r24 == NULL ) hl_null_access();
			r25 = hl_types_ArrayObj_push(r24,((vdynamic*)r37));
			goto label$890$147;
			label$890$193:
			if( r24 == NULL ) hl_null_access();
			r37 = (hxsl__AllocParam)hl_alloc_obj(hxsl__AllocParam__val);
			r20 = r27->v;
			if( r20 == NULL ) hl_null_access();
			r23 = hl_vfields(r20)[2] ? (*(String*)(hl_vfields(r20)[2])) : (String)hl_dyn_getp(r20->value,150958933/*name*/,&type$13);
			r25 = r27->pos;
			if( r36 == NULL ) hl_null_access();
			r26 = hl_vfields(r36)[1] ? (*(int*)(hl_vfields(r36)[1])) : (int)hl_dyn_geti(r36->value,434184351/*instance*/,&type$3);
			r30 = hl_vfields(r36)[0] ? (*(int*)(hl_vfields(r36)[0])) : (int)hl_dyn_geti(r36->value,-32204280/*index*/,&type$3);
			r20 = r27->v;
			if( r20 == NULL ) hl_null_access();
			r29 = hl_vfields(r20)[5] ? (*(venum**)(hl_vfields(r20)[5])) : (venum*)hl_dyn_getp(r20->value,218690500/*type*/,&type$148);
			hxsl_AllocParam_new(r37,r23,r25,r26,r30,r29);
			r25 = hl_types_ArrayObj_push(r24,((vdynamic*)r37));
			goto label$890$147;
			label$890$208:
			r12 = 0;
			if( r24 == NULL ) hl_null_access();
			r25 = r24->length;
			r26 = 1;
			r25 = r25 - r26;
			label$890$213:
			if( r12 >= r25 ) goto label$890$237;
			r26 = r12;
			++r12;
			if( r24 == NULL ) hl_null_access();
			r31 = r24->length;
			if( ((unsigned)r26) < ((unsigned)r31) ) goto label$890$222;
			r37 = NULL;
			goto label$890$225;
			label$890$222:
			r10 = r24->array;
			r17 = ((vdynamic**)(r10 + 1))[r26];
			r37 = (hxsl__AllocParam)r17;
			label$890$225:
			if( r37 == NULL ) hl_null_access();
			r31 = 1;
			r30 = r26 + r31;
			r31 = r24->length;
			if( ((unsigned)r30) < ((unsigned)r31) ) goto label$890$232;
			r38 = NULL;
			goto label$890$235;
			label$890$232:
			r10 = r24->array;
			r17 = ((vdynamic**)(r10 + 1))[r30];
			r38 = (hxsl__AllocParam)r17;
			label$890$235:
			r37->next = r38;
			goto label$890$213;
			label$890$237:
			if( r18 == NULL ) hl_null_access();
			r29 = hl_vfields(r18)[5] ? (*(venum**)(hl_vfields(r18)[5])) : (venum*)hl_dyn_getp(r18->value,218690500/*type*/,&type$148);
			if( r29 == NULL ) hl_null_access();
			r12 = HL__ENUM_INDEX__(r29);
			r25 = 15;
			if( r12 != r25 ) goto label$890$311;
			r33 = ((hxsl_Type_TArray*)r29)->p0;
			r8 = hxsl_Tools_isSampler(r33);
			if( !r8 ) goto label$890$258;
			if( r9 == NULL ) hl_null_access();
			r40 = hl_alloc_virtual(&type$3883);
			if( hl_vfields(r40)[1] ) *(venum**)(hl_vfields(r40)[1]) = (venum*)r33; else hl_dyn_setp(r40->value,116/*t*/,&type$148,r33);
			if( hl_vfields(r40)[0] ) *(hl__types__ArrayObj*)(hl_vfields(r40)[0]) = (hl__types__ArrayObj)r24; else hl_dyn_setp(r40->value,4847905/*all*/,&type$46,r24);
			r12 = hl_types_ArrayObj_push(r9,((vdynamic*)r40));
			if( r6 == NULL ) hl_null_access();
			r12 = r6->texturesCount;
			if( r24 == NULL ) hl_null_access();
			r25 = r24->length;
			r12 = r12 + r25;
			r6->texturesCount = r12;
			goto label$890$310;
			label$890$258:
			r39 = ((hxsl_Type_TArray*)r29)->p0;
			if( r39 == NULL ) hl_null_access();
			r12 = HL__ENUM_INDEX__(r39);
			switch(r12) {
				default:
				case 0:
				case 1:
				case 2:
				case 3:
				case 4:
				case 6:
				case 7:
				case 8:
				case 9:
				case 10:
				case 11:
				case 12:
				case 13:
				case 14:
				case 15:
					r23 = (String)global$319;
					hl_throw((vdynamic*)r23);
				case 5:
					r39 = ((hxsl_Type_TArray*)r29)->p0;
					r12 = ((hxsl_Type_TVec*)r39)->p0;
					r25 = 4;
					if( r12 != r25 ) goto label$890$294;
					r39 = ((hxsl_Type_TArray*)r29)->p0;
					r34 = ((hxsl_Type_TVec*)r39)->p1;
					if( r34 == NULL ) hl_null_access();
					r12 = HL__ENUM_INDEX__(r34);
					r25 = 1;
					if( r12 != r25 ) goto label$890$294;
					r35 = ((hxsl_Type_TArray*)r29)->p1;
					if( r35 == NULL ) hl_null_access();
					r12 = HL__ENUM_INDEX__(r35);
					r25 = 0;
					if( r12 != r25 ) goto label$890$294;
					if( r6 == NULL ) hl_null_access();
					if( r24 == NULL ) hl_null_access();
					r12 = 0;
					r25 = r24->length;
					if( ((unsigned)r12) < ((unsigned)r25) ) goto label$890$286;
					r37 = NULL;
					goto label$890$289;
					label$890$286:
					r10 = r24->array;
					r17 = ((vdynamic**)(r10 + 1))[r12];
					r37 = (hxsl__AllocParam)r17;
					label$890$289:
					r6->params = r37;
					r35 = ((hxsl_Type_TArray*)r29)->p1;
					r12 = ((hxsl_SizeDecl_SConst*)r35)->p0;
					r6->paramsSize = r12;
					goto label$890$296;
					label$890$294:
					r23 = (String)global$319;
					hl_throw((vdynamic*)r23);
					label$890$296:
					goto label$890$310;
				case 16:
					if( r6 == NULL ) hl_null_access();
					if( r24 == NULL ) hl_null_access();
					r12 = 0;
					r25 = r24->length;
					if( ((unsigned)r12) < ((unsigned)r25) ) goto label$890$304;
					r37 = NULL;
					goto label$890$307;
					label$890$304:
					r10 = r24->array;
					r17 = ((vdynamic**)(r10 + 1))[r12];
					r37 = (hxsl__AllocParam)r17;
					label$890$307:
					r6->buffers = r37;
					r12 = r24->length;
					r6->bufferCount = r12;
			}
			label$890$310:
			goto label$890$313;
			label$890$311:
			r23 = (String)global$319;
			hl_throw((vdynamic*)r23);
	}
	label$890$313:
	goto label$890$17;
	label$890$314:
	if( r9 == NULL ) hl_null_access();
	r12 = r9->length;
	r25 = 0;
	if( r25 >= r12 ) goto label$890$395;
	r41 = &cl$3926;
	if( r41 ) goto label$890$322;
	r42 = NULL;
	goto label$890$323;
	label$890$322:
	r42 = hl_alloc_closure_ptr(&type$3884,fun$3927,r41);
	label$890$323:
	hl_types_ArrayObj_sort(r9,r42);
	if( r6 == NULL ) hl_null_access();
	r12 = 0;
	r25 = r9->length;
	if( ((unsigned)r12) < ((unsigned)r25) ) goto label$890$330;
	r40 = NULL;
	goto label$890$333;
	label$890$330:
	r10 = r9->array;
	r14 = ((vdynamic**)(r10 + 1))[r12];
	r40 = hl_to_virtual(&type$3883,(vdynamic*)r14);
	label$890$333:
	if( r40 == NULL ) hl_null_access();
	r21 = hl_vfields(r40)[0] ? (*(hl__types__ArrayObj*)(hl_vfields(r40)[0])) : (hl__types__ArrayObj)hl_dyn_getp(r40->value,4847905/*all*/,&type$46);
	if( r21 == NULL ) hl_null_access();
	r12 = 0;
	r25 = r21->length;
	if( ((unsigned)r12) < ((unsigned)r25) ) goto label$890$341;
	r37 = NULL;
	goto label$890$344;
	label$890$341:
	r10 = r21->array;
	r14 = ((vdynamic**)(r10 + 1))[r12];
	r37 = (hxsl__AllocParam)r14;
	label$890$344:
	r6->textures = r37;
	r12 = 1;
	r25 = r9->length;
	label$890$347:
	if( r12 >= r25 ) goto label$890$395;
	r26 = r12;
	++r12;
	if( r9 == NULL ) hl_null_access();
	r31 = 1;
	r30 = r26 - r31;
	r31 = r9->length;
	if( ((unsigned)r30) < ((unsigned)r31) ) goto label$890$358;
	r40 = NULL;
	goto label$890$361;
	label$890$358:
	r10 = r9->array;
	r14 = ((vdynamic**)(r10 + 1))[r30];
	r40 = hl_to_virtual(&type$3883,(vdynamic*)r14);
	label$890$361:
	if( r40 == NULL ) hl_null_access();
	r21 = hl_vfields(r40)[0] ? (*(hl__types__ArrayObj*)(hl_vfields(r40)[0])) : (hl__types__ArrayObj)hl_dyn_getp(r40->value,4847905/*all*/,&type$46);
	if( r21 == NULL ) hl_null_access();
	r30 = r21->length;
	r31 = 1;
	r30 = r30 - r31;
	r31 = r21->length;
	if( ((unsigned)r30) < ((unsigned)r31) ) goto label$890$371;
	r37 = NULL;
	goto label$890$374;
	label$890$371:
	r10 = r21->array;
	r14 = ((vdynamic**)(r10 + 1))[r30];
	r37 = (hxsl__AllocParam)r14;
	label$890$374:
	if( r37 == NULL ) hl_null_access();
	r31 = r9->length;
	if( ((unsigned)r26) < ((unsigned)r31) ) goto label$890$379;
	r40 = NULL;
	goto label$890$382;
	label$890$379:
	r10 = r9->array;
	r14 = ((vdynamic**)(r10 + 1))[r26];
	r40 = hl_to_virtual(&type$3883,(vdynamic*)r14);
	label$890$382:
	if( r40 == NULL ) hl_null_access();
	r24 = hl_vfields(r40)[0] ? (*(hl__types__ArrayObj*)(hl_vfields(r40)[0])) : (hl__types__ArrayObj)hl_dyn_getp(r40->value,4847905/*all*/,&type$46);
	if( r24 == NULL ) hl_null_access();
	r30 = 0;
	r31 = r24->length;
	if( ((unsigned)r30) < ((unsigned)r31) ) goto label$890$390;
	r38 = NULL;
	goto label$890$393;
	label$890$390:
	r10 = r24->array;
	r14 = ((vdynamic**)(r10 + 1))[r30];
	r38 = (hxsl__AllocParam)r14;
	label$890$393:
	r37->next = r38;
	goto label$890$347;
	label$890$395:
	if( r6 == NULL ) hl_null_access();
	r28 = r6->globals;
	if( r28 ) goto label$890$400;
	r12 = 0;
	r6->globalsSize = r12;
	label$890$400:
	r37 = r6->params;
	if( r37 ) goto label$890$404;
	r12 = 0;
	r6->paramsSize = r12;
	label$890$404:
	r37 = r6->buffers;
	if( r37 ) goto label$890$408;
	r12 = 0;
	r6->bufferCount = r12;
	label$890$408:
	r6->data = r7;
	return r6;
}

void hxsl_Cache_new(hxsl__Cache r0) {
	haxe__ds__StringMap r4;
	bool r1;
	hxsl__SearchMap r2;
	r1 = false;
	r0->constsToGlobal = r1;
	r2 = (hxsl__SearchMap)hl_alloc_obj(hxsl__SearchMap__val);
	hxsl_SearchMap_new(r2);
	r0->linkCache = r2;
	r4 = (haxe__ds__StringMap)hl_alloc_obj(haxe__ds__StringMap__val);
	haxe_ds_StringMap_new(r4);
	r0->linkShaders = r4;
	r4 = (haxe__ds__StringMap)hl_alloc_obj(haxe__ds__StringMap__val);
	haxe_ds_StringMap_new(r4);
	r0->byID = r4;
	return;
}

void hxsl_Cache_clear() {
	hxsl__Cache r0;
	hxsl__$Cache r1;
	r0 = NULL;
	r1 = (hxsl__$Cache)global$83;
	r1->INST = r0;
	return;
}

void hxsl_Cache_set(hxsl__Cache r0) {
	hxsl__$Cache r1;
	r1 = (hxsl__$Cache)global$83;
	r1->INST = r0;
	return;
}

hxsl__Cache hxsl_Cache_get() {
	hxsl__Cache r0, r3;
	hxsl__$Cache r1;
	r1 = (hxsl__$Cache)global$83;
	r0 = r1->INST;
	if( r0 ) goto label$899$8;
	r3 = (hxsl__Cache)hl_alloc_obj(hxsl__Cache__val);
	hxsl_Cache_new(r3);
	r0 = r3;
	r1 = (hxsl__$Cache)global$83;
	r1->INST = r3;
	label$899$8:
	return r0;
}

