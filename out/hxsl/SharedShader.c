// Generated by HLC 4.0.0 (HL v4)
#include <hl/code.h>

void hxsl_SharedShader_initialize(hxsl__SharedShader r0) {
	String r10;
	vvirtual *r4, *r7;
	hl__types__ArrayObj r3;
	vdynamic *r8;
	varray *r9;
	int r1, r5, r6;
	r1 = 0;
	r4 = r0->data;
	if( r4 == NULL ) hl_null_access();
	r3 = hl_vfields(r4)[2] ? (*(hl__types__ArrayObj*)(hl_vfields(r4)[2])) : (hl__types__ArrayObj)hl_dyn_getp(r4->value,239676598/*vars*/,&type$46);
	label$771$4:
	if( r3 == NULL ) hl_null_access();
	r6 = r3->length;
	if( r1 >= r6 ) goto label$771$20;
	r5 = r1;
	++r1;
	r6 = r3->length;
	if( ((unsigned)r5) < ((unsigned)r6) ) goto label$771$14;
	r7 = NULL;
	goto label$771$17;
	label$771$14:
	r9 = r3->array;
	r8 = ((vdynamic**)(r9 + 1))[r5];
	r7 = hl_to_virtual(&type$146,(vdynamic*)r8);
	label$771$17:
	r10 = NULL;
	hxsl_SharedShader_browseVar(r0,r7,r10);
	goto label$771$4;
	label$771$20:
	return;
}

hxsl__ShaderInstance hxsl_SharedShader_getInstance(hxsl__SharedShader r0,int r1) {
	haxe__ds__IntMap r3;
	hxsl__ShaderInstance r4, r5;
	vdynamic *r2;
	r3 = r0->instanceCache;
	if( r3 == NULL ) hl_null_access();
	r2 = haxe_ds_IntMap_get(r3,r1);
	r4 = (hxsl__ShaderInstance)r2;
	if( r4 ) goto label$772$7;
	r5 = hxsl_SharedShader_makeInstance(r0,r1);
	return r5;
	label$772$7:
	return r4;
}

hxsl__ShaderInstance hxsl_SharedShader_makeInstance(hxsl__SharedShader r0,int r1) {
	String r10;
	hl__types__ArrayObj r19;
	hxsl__$SharedShader r16;
	vvirtual *r6, *r9, *r18;
	hxsl__Eval r2;
	venum *r8, *r12;
	bool r13;
	haxe__ds__IntMap r21;
	hxsl__ShaderInstance r17;
	hxsl__ShaderConst r4, r5;
	vdynamic *r11;
	varray *r20;
	int r7, r14, r15;
	r2 = (hxsl__Eval)hl_alloc_obj(hxsl__Eval__val);
	hxsl_Eval_new(r2);
	r4 = r0->consts;
	label$773$3:
	if( !r4 ) goto label$773$40;
	if( r4 == NULL ) hl_null_access();
	r6 = r4->v;
	r9 = r4->v;
	if( r9 == NULL ) hl_null_access();
	r8 = hl_vfields(r9)[5] ? (*(venum**)(hl_vfields(r9)[5])) : (venum*)hl_dyn_getp(r9->value,218690500/*type*/,&type$148);
	if( r8 == NULL ) hl_null_access();
	r7 = HL__ENUM_INDEX__(r8);
	switch(r7) {
		default:
		case 0:
		case 3:
		case 4:
		case 5:
		case 6:
		case 7:
		case 8:
		case 9:
		case 10:
		case 11:
		case 12:
		case 13:
		case 14:
		case 15:
		case 16:
			r10 = (String)global$319;
			hl_throw((vdynamic*)r10);
		case 2:
			r14 = r4->pos;
			r7 = ((unsigned)r1) >> r14;
			r14 = 1;
			r7 = r7 & r14;
			r14 = 0;
			if( r7 != r14 ) goto label$773$23;
			r13 = false;
			goto label$773$24;
			label$773$23:
			r13 = true;
			label$773$24:
			r12 = hl_alloc_enum(&type$814,1);
			((hxsl_Const_CBool*)r12)->p0 = r13;
			goto label$773$35;
		case 1:
		case 17:
			r14 = r4->pos;
			r7 = ((unsigned)r1) >> r14;
			r14 = 1;
			r15 = r4->bits;
			r14 = r14 << r15;
			r15 = 1;
			r14 = r14 - r15;
			r7 = r7 & r14;
			r12 = hl_alloc_enum(&type$814,2);
			((hxsl_Const_CInt*)r12)->p0 = r7;
	}
	label$773$35:
	if( r2 == NULL ) hl_null_access();
	hxsl_Eval_setConstant(r2,r6,r12);
	r5 = r4->next;
	r4 = r5;
	goto label$773$3;
	label$773$40:
	if( r2 == NULL ) hl_null_access();
	r13 = true;
	r2->inlineCalls = r13;
	r16 = (hxsl__$SharedShader)global$62;
	r13 = r16->UNROLL_LOOPS;
	r2->unrollLoops = r13;
	r17 = (hxsl__ShaderInstance)hl_alloc_obj(hxsl__ShaderInstance__val);
	r18 = r0->data;
	r18 = hxsl_Eval_eval(r2,r18);
	hxsl_ShaderInstance_new(r17,r18);
	r7 = 0;
	r0->paramsCount = r7;
	r7 = 0;
	r18 = r0->data;
	if( r18 == NULL ) hl_null_access();
	r19 = hl_vfields(r18)[2] ? (*(hl__types__ArrayObj*)(hl_vfields(r18)[2])) : (hl__types__ArrayObj)hl_dyn_getp(r18->value,239676598/*vars*/,&type$46);
	label$773$56:
	if( r19 == NULL ) hl_null_access();
	r15 = r19->length;
	if( r7 >= r15 ) goto label$773$71;
	r14 = r7;
	++r7;
	r15 = r19->length;
	if( ((unsigned)r14) < ((unsigned)r15) ) goto label$773$66;
	r6 = NULL;
	goto label$773$69;
	label$773$66:
	r20 = r19->array;
	r11 = ((vdynamic**)(r20 + 1))[r14];
	r6 = hl_to_virtual(&type$146,(vdynamic*)r11);
	label$773$69:
	hxsl_SharedShader_addParam(r0,r2,r17,r6);
	goto label$773$56;
	label$773$71:
	r21 = r0->instanceCache;
	if( r21 == NULL ) hl_null_access();
	haxe_ds_IntMap_set(r21,r1,((vdynamic*)r17));
	return r17;
}

void hxsl_SharedShader_addSelfParam(hxsl__SharedShader r0,hxsl__ShaderInstance r1,vvirtual* r2) {
	hl__types__ArrayObj r8;
	vvirtual *r4;
	venum *r3, *r12, *r13;
	haxe__ds__IntMap r14;
	vdynamic *r10, *r15;
	varray *r11;
	int r6, r7, r9;
	if( r2 == NULL ) hl_null_access();
	r3 = hl_vfields(r2)[5] ? (*(venum**)(hl_vfields(r2)[5])) : (venum*)hl_dyn_getp(r2->value,218690500/*type*/,&type$148);
	if( r3 == NULL ) hl_null_access();
	r6 = HL__ENUM_INDEX__(r3);
	r7 = 13;
	if( r6 != r7 ) goto label$774$24;
	r8 = ((hxsl_Type_TStruct*)r3)->p0;
	r6 = 0;
	label$774$8:
	if( r8 == NULL ) hl_null_access();
	r9 = r8->length;
	if( r6 >= r9 ) goto label$774$23;
	r7 = r6;
	++r6;
	r9 = r8->length;
	if( ((unsigned)r7) < ((unsigned)r9) ) goto label$774$18;
	r4 = NULL;
	goto label$774$21;
	label$774$18:
	r11 = r8->array;
	r10 = ((vdynamic**)(r11 + 1))[r7];
	r4 = hl_to_virtual(&type$146,(vdynamic*)r10);
	label$774$21:
	hxsl_SharedShader_addSelfParam(r0,r1,r4);
	goto label$774$8;
	label$774$23:
	goto label$774$37;
	label$774$24:
	r12 = hl_vfields(r2)[1] ? (*(venum**)(hl_vfields(r2)[1])) : (venum*)hl_dyn_getp(r2->value,118088286/*kind*/,&type$147);
	r13 = (venum*)global$1375;
	if( r12 != r13 ) goto label$774$37;
	if( r1 == NULL ) hl_null_access();
	r14 = r1->params;
	if( r14 == NULL ) hl_null_access();
	r6 = hl_vfields(r2)[0] ? (*(int*)(hl_vfields(r2)[0])) : (int)hl_dyn_geti(r2->value,23515/*id*/,&type$3);
	r7 = r0->paramsCount;
	r15 = hl_alloc_dynamic(&type$3);
	r15->v.i = r7;
	haxe_ds_IntMap_set(r14,r6,((vdynamic*)r15));
	r6 = r0->paramsCount;
	++r6;
	r0->paramsCount = r6;
	label$774$37:
	return;
}

void hxsl_SharedShader_addParam(hxsl__SharedShader r0,hxsl__Eval r1,hxsl__ShaderInstance r2,vvirtual* r3) {
	haxe__ds__ObjectMap r16;
	hl__types__ArrayObj r9;
	vvirtual *r5;
	venum *r4, *r13, *r14;
	haxe__ds__IntMap r15;
	vdynamic *r11, *r17;
	varray *r12;
	int r7, r8, r10;
	if( r3 == NULL ) hl_null_access();
	r4 = hl_vfields(r3)[5] ? (*(venum**)(hl_vfields(r3)[5])) : (venum*)hl_dyn_getp(r3->value,218690500/*type*/,&type$148);
	if( r4 == NULL ) hl_null_access();
	r7 = HL__ENUM_INDEX__(r4);
	r8 = 13;
	if( r7 != r8 ) goto label$775$24;
	r9 = ((hxsl_Type_TStruct*)r4)->p0;
	r7 = 0;
	label$775$8:
	if( r9 == NULL ) hl_null_access();
	r10 = r9->length;
	if( r7 >= r10 ) goto label$775$23;
	r8 = r7;
	++r7;
	r10 = r9->length;
	if( ((unsigned)r8) < ((unsigned)r10) ) goto label$775$18;
	r5 = NULL;
	goto label$775$21;
	label$775$18:
	r12 = r9->array;
	r11 = ((vdynamic**)(r12 + 1))[r8];
	r5 = hl_to_virtual(&type$146,(vdynamic*)r11);
	label$775$21:
	hxsl_SharedShader_addParam(r0,r1,r2,r5);
	goto label$775$8;
	label$775$23:
	goto label$775$43;
	label$775$24:
	r13 = hl_vfields(r3)[1] ? (*(venum**)(hl_vfields(r3)[1])) : (venum*)hl_dyn_getp(r3->value,118088286/*kind*/,&type$147);
	r14 = (venum*)global$1375;
	if( r13 != r14 ) goto label$775$43;
	if( r2 == NULL ) hl_null_access();
	r15 = r2->params;
	if( r15 == NULL ) hl_null_access();
	if( r1 == NULL ) hl_null_access();
	r16 = r1->varMap;
	if( r16 == NULL ) hl_null_access();
	r11 = haxe_ds_ObjectMap_get(r16,((vdynamic*)r3));
	r5 = hl_to_virtual(&type$146,(vdynamic*)r11);
	if( r5 == NULL ) hl_null_access();
	r7 = hl_vfields(r5)[0] ? (*(int*)(hl_vfields(r5)[0])) : (int)hl_dyn_geti(r5->value,23515/*id*/,&type$3);
	r8 = r0->paramsCount;
	r17 = hl_alloc_dynamic(&type$3);
	r17->v.i = r8;
	haxe_ds_IntMap_set(r15,r7,((vdynamic*)r17));
	r7 = r0->paramsCount;
	++r7;
	r0->paramsCount = r7;
	label$775$43:
	return;
}

void hxsl_SharedShader_browseVar(hxsl__SharedShader r0,vvirtual* r1,String r2) {
	String r6, r7, r8;
	hl__types__ArrayObj r11;
	vvirtual *r3;
	venum *r9, *r15, *r16;
	bool r19;
	hxsl__ShaderGlobal r18;
	hxsl__ShaderConst r21, r22, r23;
	vdynamic *r13, *r17;
	varray *r14;
	int r4, r10, r12, r20;
	if( r1 == NULL ) hl_null_access();
	r4 = hxsl_Tools_allocVarId();
	if( hl_vfields(r1)[0] ) *(int*)(hl_vfields(r1)[0]) = (int)r4; else hl_dyn_seti(r1->value,23515/*id*/,&type$3,r4);
	if( r2 ) goto label$776$7;
	r6 = hxsl_Tools_getName(r1);
	r2 = r6;
	goto label$776$12;
	label$776$7:
	r7 = (String)global$210;
	r8 = hl_vfields(r1)[2] ? (*(String*)(hl_vfields(r1)[2])) : (String)hl_dyn_getp(r1->value,150958933/*name*/,&type$13);
	r7 = String___add__(r7,r8);
	r6 = String___add__(r2,r7);
	r2 = r6;
	label$776$12:
	r9 = hl_vfields(r1)[5] ? (*(venum**)(hl_vfields(r1)[5])) : (venum*)hl_dyn_getp(r1->value,218690500/*type*/,&type$148);
	if( r9 == NULL ) hl_null_access();
	r4 = HL__ENUM_INDEX__(r9);
	r10 = 13;
	if( r4 != r10 ) goto label$776$35;
	r11 = ((hxsl_Type_TStruct*)r9)->p0;
	r4 = 0;
	label$776$19:
	if( r11 == NULL ) hl_null_access();
	r12 = r11->length;
	if( r4 >= r12 ) goto label$776$34;
	r10 = r4;
	++r4;
	r12 = r11->length;
	if( ((unsigned)r10) < ((unsigned)r12) ) goto label$776$29;
	r3 = NULL;
	goto label$776$32;
	label$776$29:
	r14 = r11->array;
	r13 = ((vdynamic**)(r14 + 1))[r10];
	r3 = hl_to_virtual(&type$146,(vdynamic*)r13);
	label$776$32:
	hxsl_SharedShader_browseVar(r0,r3,r2);
	goto label$776$19;
	label$776$34:
	goto label$776$70;
	label$776$35:
	r4 = 0;
	r15 = hl_vfields(r1)[1] ? (*(venum**)(hl_vfields(r1)[1])) : (venum*)hl_dyn_getp(r1->value,118088286/*kind*/,&type$147);
	r16 = (venum*)global$1410;
	if( r15 != r16 ) goto label$776$47;
	r17 = hxsl_Globals_allocID(r6);
	r10 = r17 ? r17->v.i : 0;
	r4 = r10;
	r11 = r0->globals;
	if( r11 == NULL ) hl_null_access();
	r18 = (hxsl__ShaderGlobal)hl_alloc_obj(hxsl__ShaderGlobal__val);
	hxsl_ShaderGlobal_new(r18,r1,r10);
	r10 = hl_types_ArrayObj_push(r11,((vdynamic*)r18));
	label$776$47:
	r19 = hxsl_Tools_isConst(r1);
	if( r19 ) goto label$776$50;
	return;
	label$776$50:
	r10 = hxsl_Tools_getConstBits(r1);
	r20 = 0;
	if( r20 >= r10 ) goto label$776$70;
	r21 = (hxsl__ShaderConst)hl_alloc_obj(hxsl__ShaderConst__val);
	r22 = r0->consts;
	if( r22 ) goto label$776$58;
	r12 = 0;
	goto label$776$65;
	label$776$58:
	r22 = r0->consts;
	if( r22 == NULL ) hl_null_access();
	r12 = r22->pos;
	r22 = r0->consts;
	if( r22 == NULL ) hl_null_access();
	r20 = r22->bits;
	r12 = r12 + r20;
	label$776$65:
	hxsl_ShaderConst_new(r21,r1,r12,r10);
	r21->globalId = r4;
	r23 = r0->consts;
	r21->next = r23;
	r0->consts = r21;
	label$776$70:
	return;
}

void hxsl_SharedShader_new(hxsl__SharedShader r0,String r1) {
	String r9;
	vvirtual *r11;
	hl__types__ArrayObj r5;
	hl_type *r7;
	haxe__ds__IntMap r2;
	hxsl__ShaderConst r4;
	vdynamic *r10;
	int r8;
	varray *r6;
	r2 = (haxe__ds__IntMap)hl_alloc_obj(haxe__ds__IntMap__val);
	haxe_ds_IntMap_new(r2);
	r0->instanceCache = r2;
	r4 = NULL;
	r0->consts = r4;
	r7 = &type$4042;
	r8 = 0;
	r6 = hl_alloc_array(r7,r8);
	r5 = hl_types_ArrayObj_alloc(r6);
	r0->globals = r5;
	r9 = (String)global$8;
	if( r1 != r9 && (!r1 || !r9 || String___compare(r1,(vdynamic*)r9) != 0) ) goto label$779$13;
	return;
	label$779$13:
	r10 = haxe_Unserializer_run(r1);
	r11 = hl_to_virtual(&type$144,(vdynamic*)r10);
	r0->data = r11;
	hxsl_SharedShader_initialize(r0);
	return;
}

