// Generated by HLC 4.0.0 (HL v4)
#include <hl/code.h>

String Sys_programPath() {
	String r0;
	$Sys r1;
	r1 = ($Sys)global$204;
	r0 = r1->sys_program_path;
	return r0;
}

int Sys_command(String r0,hl__types__ArrayObj r1) {
	String r6, r7, r12;
	hl__types__ArrayObj r3, r10;
	hl_type *r9;
	bool r15;
	vclosure *r17, *r18;
	hl__types__ArrayDyn r16;
	vdynamic *r14;
	varray *r8;
	vbyte *r5;
	int r2, r4, r11, r13;
	r2 = 0;
	if( r1 ) goto label$2014$5;
	r5 = Sys_getPath(r0);
	r4 = hl_sys_command(r5);
	goto label$2014$69;
	label$2014$5:
	r6 = Sys_systemName();
	r7 = (String)global$206;
	if( r6 != r7 && (!r6 || !r7 || String___compare(r6,(vdynamic*)r7) != 0) ) goto label$2014$48;
	r9 = &type$13;
	r4 = 0;
	r8 = hl_alloc_array(r9,r4);
	r3 = hl_types_ArrayObj_alloc(r8);
	r4 = 0;
	r9 = &type$13;
	r11 = 1;
	r8 = hl_alloc_array(r9,r11);
	r7 = (String)global$207;
	r12 = (String)global$196;
	r6 = StringTools_replace(r0,r7,r12);
	r11 = 0;
	((String*)(r8 + 1))[r11] = r6;
	r10 = hl_types_ArrayObj_alloc(r8);
	if( r10 == NULL ) hl_null_access();
	r10 = hl_types_ArrayObj_concat(r10,r1);
	label$2014$24:
	if( r10 == NULL ) hl_null_access();
	r13 = r10->length;
	if( r4 >= r13 ) goto label$2014$42;
	if( r3 == NULL ) hl_null_access();
	r11 = r4;
	++r4;
	r13 = r10->length;
	if( ((unsigned)r11) < ((unsigned)r13) ) goto label$2014$35;
	r6 = NULL;
	goto label$2014$38;
	label$2014$35:
	r8 = r10->array;
	r14 = ((vdynamic**)(r8 + 1))[r11];
	r6 = (String)r14;
	label$2014$38:
	r15 = true;
	r6 = StringTools_quoteWinArg(r6,r15);
	r11 = hl_types_ArrayObj_push(r3,((vdynamic*)r6));
	goto label$2014$24;
	label$2014$42:
	if( r3 == NULL ) hl_null_access();
	r6 = (String)global$192;
	r6 = hl_types_ArrayObj_join(r3,r6);
	r5 = Sys_getPath(r6);
	r4 = hl_sys_command(r5);
	goto label$2014$69;
	label$2014$48:
	r9 = &type$13;
	r4 = 1;
	r8 = hl_alloc_array(r9,r4);
	r4 = 0;
	((String*)(r8 + 1))[r4] = r0;
	r3 = hl_types_ArrayObj_alloc(r8);
	if( r3 == NULL ) hl_null_access();
	r3 = hl_types_ArrayObj_concat(r3,r1);
	if( r3 == NULL ) hl_null_access();
	r17 = &cl$1976;
	if( r17 ) goto label$2014$61;
	r18 = NULL;
	goto label$2014$62;
	label$2014$61:
	r18 = hl_alloc_closure_ptr(&type$1375,fun$2021,r17);
	label$2014$62:
	r16 = hl_types_ArrayObj_map(r3,r18);
	r3 = (hl__types__ArrayObj)hl_dyn_castp(&r16,&type$321,&type$46);
	if( r3 == NULL ) hl_null_access();
	r6 = (String)global$192;
	r6 = hl_types_ArrayObj_join(r3,r6);
	r5 = Sys_getPath(r6);
	r4 = hl_sys_command(r5);
	label$2014$69:
	return r4;
}

String Sys_systemName() {
	String r1;
	int r2;
	vbyte *r0;
	r0 = hl_sys_string();
	r1 = (String)hl_alloc_obj(String__val);
	r1->bytes = r0;
	r2 = 0;
	r2 = hl_ucs2length(r0,r2);
	r1->length = r2;
	return r1;
}

String Sys_getCwd() {
	String r0;
	vbyte *r1;
	r1 = hl_sys_get_cwd();
	r0 = Sys_makePath(r1);
	return r0;
}

String Sys_getEnv(String r0) {
	String r2;
	vbyte *r1;
	r1 = Sys_getPath(r0);
	r1 = hl_sys_get_env(r1);
	if( r1 ) goto label$2012$5;
	r2 = NULL;
	return r2;
	label$2012$5:
	r2 = Sys_makePath(r1);
	return r2;
}

void Sys_println(vdynamic* r0) {
	String r3;
	vbyte *r2;
	r3 = Std_string(r0);
	if( r3 == NULL ) hl_null_access();
	r2 = r3->bytes;
	hl_sys_print(r2);
	r3 = (String)global$205;
	if( r3 == NULL ) hl_null_access();
	r2 = r3->bytes;
	hl_sys_print(r2);
	return;
}

String Sys_makePath(vbyte* r0) {
	String r1;
	$Sys r3;
	bool r2;
	int r4;
	if( r0 ) goto label$1996$3;
	r1 = NULL;
	return r1;
	label$1996$3:
	r3 = ($Sys)global$204;
	r2 = r3->utf8Path;
	if( !r2 ) goto label$1996$8;
	r1 = String_fromUTF8(r0);
	return r1;
	label$1996$8:
	r1 = (String)hl_alloc_obj(String__val);
	r1->bytes = r0;
	r4 = 0;
	r4 = hl_ucs2length(r0,r4);
	r1->length = r4;
	return r1;
}

vbyte* Sys_getPath(String r0) {
	$Sys r2;
	bool r1;
	int *r5;
	int r4;
	vbyte *r3;
	r2 = ($Sys)global$204;
	r1 = r2->utf8Path;
	if( !r1 ) goto label$1990$9;
	if( r0 == NULL ) hl_null_access();
	r3 = r0->bytes;
	r4 = 0;
	r5 = NULL;
	r3 = hl_utf16_to_utf8(r3,r4,r5);
	return r3;
	label$1990$9:
	if( r0 == NULL ) hl_null_access();
	r3 = r0->bytes;
	return r3;
}

