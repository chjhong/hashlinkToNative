// Generated by HLC 4.0.0 (HL v4)
#include <hl/code.h>

int hxd_res_Image_getFormat(hxd__res__Image r0) {
	vvirtual *r1, *r3;
	int r2;
	r1 = hxd_res_Image_getSize(r0);
	r3 = r0->inf;
	if( r3 == NULL ) hl_null_access();
	r2 = hl_vfields(r3)[0] ? (*(int*)(hl_vfields(r3)[0])) : (int)hl_dyn_geti(r3->value,-40988873/*format*/,&type$3);
	return r2;
}

vvirtual* hxd_res_Image_getSize(hxd__res__Image r0) {
	String r14, r15;
	hxd__fs__FileEntry r6;
	vvirtual *r2, *r4;
	bool r11;
	hxd__fs__FileInput r5;
	haxe__io__Eof r12;
	haxe__io__$Eof r10;
	vdynamic *r3;
	int r7, r8, r9, r13, r16, r17;
	hl_trap_ctx trap$0;
	r2 = r0->inf;
	if( !r2 ) goto label$1898$5;
	r2 = r0->inf;
	r4 = hl_to_virtual(&type$3710,(vdynamic*)r2);
	return r4;
	label$1898$5:
	r5 = (hxd__fs__FileInput)hl_alloc_obj(hxd__fs__FileInput__val);
	r6 = r0->entry;
	hxd_fs_FileInput_new(r5,r6);
	r7 = 0;
	r8 = 0;
	hl_trap(trap$0,r3,label$1898$14);
	r9 = haxe_io_Input_readUInt16(((haxe__io__Input)r5));
	hl_endtrap(trap$0);
	goto label$1898$21;
	label$1898$14:
	r10 = (haxe__io__$Eof)global$333;
	r11 = hl_BaseType_check(((hl__BaseType)r10),r3);
	if( !r11 ) goto label$1898$20;
	r12 = (haxe__io__Eof)r3;
	r9 = 0;
	goto label$1898$21;
	label$1898$20:
	hl_rethrow((vdynamic*)r3);
	label$1898$21:
	r13 = 18759;
	if( r13 == r9 ) goto label$1898$48;
	r13 = 20617;
	if( r13 == r9 ) goto label$1898$56;
	r13 = 55551;
	if( r13 == r9 ) goto label$1898$80;
	r6 = r0->entry;
	if( r6 == NULL ) hl_null_access();
	r14 = hxd_fs_FileEntry_get_extension(r6);
	r15 = (String)global$1218;
	if( r14 != r15 && (!r14 || !r15 || String___compare(r14,(vdynamic*)r15) != 0) ) goto label$1898$41;
	r13 = 3;
	r9 = r13;
	r13 = 10;
	hxd_fs_FileInput_skip(r5,r13);
	r13 = haxe_io_Input_readUInt16(((haxe__io__Input)r5));
	r7 = r13;
	r13 = haxe_io_Input_readUInt16(((haxe__io__Input)r5));
	r8 = r13;
	goto label$1898$47;
	label$1898$41:
	r14 = (String)global$514;
	r6 = r0->entry;
	if( r6 == NULL ) hl_null_access();
	r15 = ((String (*)(hxd__fs__FileEntry))r6->$type->vobj_proto[15])(r6);
	r14 = String___add__(r14,r15);
	hl_throw((vdynamic*)r14);
	label$1898$47:
	goto label$1898$106;
	label$1898$48:
	r13 = 2;
	r9 = r13;
	r13 = haxe_io_Input_readInt32(((haxe__io__Input)r5));
	r13 = haxe_io_Input_readUInt16(((haxe__io__Input)r5));
	r7 = r13;
	r13 = haxe_io_Input_readUInt16(((haxe__io__Input)r5));
	r8 = r13;
	goto label$1898$106;
	label$1898$56:
	r13 = 1;
	r9 = r13;
	r11 = true;
	r11 = haxe_io_Input_set_bigEndian(((haxe__io__Input)r5),r11);
	r13 = 6;
	hxd_fs_FileInput_skip(r5,r13);
	label$1898$62:
	r11 = true;
	if( !r11 ) goto label$1898$79;
	if( r5 == NULL ) hl_null_access();
	r13 = haxe_io_Input_readInt32(((haxe__io__Input)r5));
	r16 = haxe_io_Input_readInt32(((haxe__io__Input)r5));
	r17 = 1229472850;
	if( r16 != r17 ) goto label$1898$75;
	r16 = haxe_io_Input_readInt32(((haxe__io__Input)r5));
	r7 = r16;
	r16 = haxe_io_Input_readInt32(((haxe__io__Input)r5));
	r8 = r16;
	goto label$1898$79;
	label$1898$75:
	r17 = 4;
	r16 = r13 + r17;
	hxd_fs_FileInput_skip(r5,r16);
	goto label$1898$62;
	label$1898$79:
	goto label$1898$106;
	label$1898$80:
	r13 = 0;
	r9 = r13;
	r11 = true;
	r11 = haxe_io_Input_set_bigEndian(((haxe__io__Input)r5),r11);
	label$1898$84:
	r11 = true;
	if( !r11 ) goto label$1898$106;
	if( r5 == NULL ) hl_null_access();
	r13 = haxe_io_Input_readUInt16(((haxe__io__Input)r5));
	r16 = 65472;
	if( r16 == r13 ) goto label$1898$98;
	r16 = 65474;
	if( r16 == r13 ) goto label$1898$98;
	r13 = haxe_io_Input_readUInt16(((haxe__io__Input)r5));
	r16 = 2;
	r13 = r13 - r16;
	hxd_fs_FileInput_skip(r5,r13);
	goto label$1898$105;
	label$1898$98:
	r13 = haxe_io_Input_readUInt16(((haxe__io__Input)r5));
	r13 = hxd_fs_FileInput_readByte(r5);
	r13 = haxe_io_Input_readUInt16(((haxe__io__Input)r5));
	r8 = r13;
	r13 = haxe_io_Input_readUInt16(((haxe__io__Input)r5));
	r7 = r13;
	goto label$1898$106;
	label$1898$105:
	goto label$1898$84;
	label$1898$106:
	if( r5 == NULL ) hl_null_access();
	hxd_fs_FileInput_close(r5);
	r2 = hl_alloc_virtual(&type$1356);
	if( hl_vfields(r2)[2] ) *(int*)(hl_vfields(r2)[2]) = (int)r7; else hl_dyn_seti(r2->value,-362629759/*width*/,&type$3,r7);
	if( hl_vfields(r2)[1] ) *(int*)(hl_vfields(r2)[1]) = (int)r8; else hl_dyn_seti(r2->value,38537191/*height*/,&type$3,r8);
	if( hl_vfields(r2)[0] ) *(int*)(hl_vfields(r2)[0]) = (int)r9; else hl_dyn_seti(r2->value,-40988873/*format*/,&type$3,r9);
	r0->inf = r2;
	r2 = r0->inf;
	r4 = hl_to_virtual(&type$3710,(vdynamic*)r2);
	return r4;
}

hxd__Pixels hxd_res_Image_getPixels(hxd__res__Image r0,venum* r1,vdynamic* r2) {
	String r14, r15;
	hxd__fs__FileEntry r8;
	hxd__Pixels r10, r11;
	haxe__io__BytesInput r18;
	vvirtual *r3, *r6, *r16, *r23, *r26;
	venum *r9, *r25, *r27, *r38;
	format__gif__Reader r17;
	bool r13;
	haxe__io__Bytes r7;
	hl__types__ArrayBytes_Int r33;
	format__tga__Reader r24;
	int *r22;
	vdynamic *r19, *r20;
	vbyte *r28;
	int r5, r12, r21, r29, r30, r31, r32, r34, r35, r36, r37;
	r3 = hxd_res_Image_getSize(r0);
	r6 = r0->inf;
	if( r6 == NULL ) hl_null_access();
	r5 = hl_vfields(r6)[0] ? (*(int*)(hl_vfields(r6)[0])) : (int)hl_dyn_geti(r6->value,-40988873/*format*/,&type$3);
	switch(r5) {
		default:
			goto label$1899$194;
		case 0:
			r8 = r0->entry;
			if( r8 == NULL ) hl_null_access();
			r7 = ((haxe__io__Bytes (*)(hxd__fs__FileEntry))r8->$type->vobj_proto[1])(r8);
			if( r1 ) goto label$1899$12;
			r9 = (venum*)global$903;
			r1 = r9;
			label$1899$12:
			r6 = r0->inf;
			if( r6 == NULL ) hl_null_access();
			r5 = hl_vfields(r6)[2] ? (*(int*)(hl_vfields(r6)[2])) : (int)hl_dyn_geti(r6->value,-362629759/*width*/,&type$3);
			r6 = r0->inf;
			if( r6 == NULL ) hl_null_access();
			r12 = hl_vfields(r6)[1] ? (*(int*)(hl_vfields(r6)[1])) : (int)hl_dyn_geti(r6->value,38537191/*height*/,&type$3);
			r13 = r2 ? r2->v.b : 0;
			r11 = hxd_res_Image_decodeJPG(r7,r5,r12,r1,r13);
			r10 = r11;
			if( r11 ) goto label$1899$28;
			r14 = (String)global$1296;
			r8 = r0->entry;
			if( r8 == NULL ) hl_null_access();
			r15 = ((String (*)(hxd__fs__FileEntry))r8->$type->vobj_proto[15])(r8);
			r14 = String___add__(r14,r15);
			hl_throw((vdynamic*)r14);
			label$1899$28:
			goto label$1899$194;
		case 1:
			r8 = r0->entry;
			if( r8 == NULL ) hl_null_access();
			r7 = ((haxe__io__Bytes (*)(hxd__fs__FileEntry))r8->$type->vobj_proto[1])(r8);
			if( r1 ) goto label$1899$35;
			r9 = (venum*)global$903;
			r1 = r9;
			label$1899$35:
			r6 = r0->inf;
			if( r6 == NULL ) hl_null_access();
			r5 = hl_vfields(r6)[2] ? (*(int*)(hl_vfields(r6)[2])) : (int)hl_dyn_geti(r6->value,-362629759/*width*/,&type$3);
			r6 = r0->inf;
			if( r6 == NULL ) hl_null_access();
			r12 = hl_vfields(r6)[1] ? (*(int*)(hl_vfields(r6)[1])) : (int)hl_dyn_geti(r6->value,38537191/*height*/,&type$3);
			r13 = r2 ? r2->v.b : 0;
			r11 = hxd_res_Image_decodePNG(r7,r5,r12,r1,r13);
			r10 = r11;
			if( r11 ) goto label$1899$51;
			r14 = (String)global$1296;
			r8 = r0->entry;
			if( r8 == NULL ) hl_null_access();
			r15 = ((String (*)(hxd__fs__FileEntry))r8->$type->vobj_proto[15])(r8);
			r14 = String___add__(r14,r15);
			hl_throw((vdynamic*)r14);
			label$1899$51:
			goto label$1899$194;
		case 2:
			r17 = (format__gif__Reader)hl_alloc_obj(format__gif__Reader__val);
			r18 = (haxe__io__BytesInput)hl_alloc_obj(haxe__io__BytesInput__val);
			r8 = r0->entry;
			if( r8 == NULL ) hl_null_access();
			r7 = ((haxe__io__Bytes (*)(hxd__fs__FileEntry))r8->$type->vobj_proto[1])(r8);
			r19 = NULL;
			r20 = NULL;
			haxe_io_BytesInput_new(r18,r7,r19,r20);
			format_gif_Reader_new(r17,((haxe__io__Input)r18));
			r16 = format_gif_Reader_read(r17);
			r11 = (hxd__Pixels)hl_alloc_obj(hxd__Pixels__val);
			r6 = r0->inf;
			if( r6 == NULL ) hl_null_access();
			r5 = hl_vfields(r6)[2] ? (*(int*)(hl_vfields(r6)[2])) : (int)hl_dyn_geti(r6->value,-362629759/*width*/,&type$3);
			r6 = r0->inf;
			if( r6 == NULL ) hl_null_access();
			r12 = hl_vfields(r6)[1] ? (*(int*)(hl_vfields(r6)[1])) : (int)hl_dyn_geti(r6->value,38537191/*height*/,&type$3);
			r21 = 0;
			r7 = format_gif_Tools_extractFullBGRA(r16,r21);
			r9 = (venum*)global$903;
			r22 = NULL;
			hxd_Pixels_new(r11,r5,r12,r7,r9,r22);
			r10 = r11;
			goto label$1899$194;
		case 3:
			r24 = (format__tga__Reader)hl_alloc_obj(format__tga__Reader__val);
			r18 = (haxe__io__BytesInput)hl_alloc_obj(haxe__io__BytesInput__val);
			r8 = r0->entry;
			if( r8 == NULL ) hl_null_access();
			r7 = ((haxe__io__Bytes (*)(hxd__fs__FileEntry))r8->$type->vobj_proto[1])(r8);
			r19 = NULL;
			r20 = NULL;
			haxe_io_BytesInput_new(r18,r7,r19,r20);
			format_tga_Reader_new(r24,((haxe__io__Input)r18));
			r23 = format_tga_Reader_read(r24);
			if( r23 == NULL ) hl_null_access();
			r26 = hl_vfields(r23)[2] ? (*(vvirtual**)(hl_vfields(r23)[2])) : (vvirtual*)hl_dyn_getp(r23->value,-50329203/*header*/,&type$1438);
			if( r26 == NULL ) hl_null_access();
			r25 = hl_vfields(r26)[8] ? (*(venum**)(hl_vfields(r26)[8])) : (venum*)hl_dyn_getp(r26->value,255690810/*imageType*/,&type$464);
			r27 = (venum*)global$367;
			if( r25 != r27 ) goto label$1899$97;
			r26 = hl_vfields(r23)[2] ? (*(vvirtual**)(hl_vfields(r23)[2])) : (vvirtual*)hl_dyn_getp(r23->value,-50329203/*header*/,&type$1438);
			if( r26 == NULL ) hl_null_access();
			r5 = hl_vfields(r26)[1] ? (*(int*)(hl_vfields(r26)[1])) : (int)hl_dyn_geti(r26->value,485379471/*bitsPerPixel*/,&type$3);
			r12 = 32;
			if( r5 == r12 ) goto label$1899$113;
			label$1899$97:
			r14 = (String)global$1219;
			r26 = hl_vfields(r23)[2] ? (*(vvirtual**)(hl_vfields(r23)[2])) : (vvirtual*)hl_dyn_getp(r23->value,-50329203/*header*/,&type$1438);
			if( r26 == NULL ) hl_null_access();
			r25 = hl_vfields(r26)[8] ? (*(venum**)(hl_vfields(r26)[8])) : (venum*)hl_dyn_getp(r26->value,255690810/*imageType*/,&type$464);
			r15 = Std_string(((vdynamic*)r25));
			r14 = String___add__(r14,r15);
			r15 = (String)global$207;
			r14 = String___add__(r14,r15);
			r26 = hl_vfields(r23)[2] ? (*(vvirtual**)(hl_vfields(r23)[2])) : (vvirtual*)hl_dyn_getp(r23->value,-50329203/*header*/,&type$1438);
			if( r26 == NULL ) hl_null_access();
			r5 = hl_vfields(r26)[1] ? (*(int*)(hl_vfields(r26)[1])) : (int)hl_dyn_geti(r26->value,485379471/*bitsPerPixel*/,&type$3);
			r22 = &r5;
			r28 = hl_itos(r5,r22);
			r15 = String___alloc__(r28,r5);
			r14 = String___add__(r14,r15);
			hl_throw((vdynamic*)r14);
			label$1899$113:
			r26 = hl_vfields(r23)[2] ? (*(vvirtual**)(hl_vfields(r23)[2])) : (vvirtual*)hl_dyn_getp(r23->value,-50329203/*header*/,&type$1438);
			if( r26 == NULL ) hl_null_access();
			r5 = hl_vfields(r26)[9] ? (*(int*)(hl_vfields(r26)[9])) : (int)hl_dyn_geti(r26->value,-362629759/*width*/,&type$3);
			r26 = hl_vfields(r23)[2] ? (*(vvirtual**)(hl_vfields(r23)[2])) : (vvirtual*)hl_dyn_getp(r23->value,-50329203/*header*/,&type$1438);
			if( r26 == NULL ) hl_null_access();
			r12 = hl_vfields(r26)[6] ? (*(int*)(hl_vfields(r26)[6])) : (int)hl_dyn_geti(r26->value,38537191/*height*/,&type$3);
			r9 = (venum*)global$948;
			r11 = hxd_Pixels_alloc(r5,r12,r9);
			r10 = r11;
			r11 = hxd__Pixels_PixelsARGB_Impl__fromPixels(r11);
			r21 = 0;
			label$1899$124:
			if( r21 >= r12 ) goto label$1899$174;
			r29 = r21;
			++r21;
			r30 = 0;
			label$1899$129:
			if( r30 >= r5 ) goto label$1899$173;
			r31 = r30;
			++r30;
			if( r23 == NULL ) hl_null_access();
			r33 = hl_vfields(r23)[3] ? (*(hl__types__ArrayBytes_Int*)(hl_vfields(r23)[3])) : (hl__types__ArrayBytes_Int)hl_dyn_getp(r23->value,77065130/*imageData*/,&type$33);
			if( r33 == NULL ) hl_null_access();
			r34 = r29 * r5;
			r32 = r31 + r34;
			r34 = r33->length;
			if( ((unsigned)r32) < ((unsigned)r34) ) goto label$1899$142;
			r32 = 0;
			goto label$1899$146;
			label$1899$142:
			r28 = r33->bytes;
			r34 = 2;
			r34 = r32 << r34;
			r32 = *(int*)(r28 + r34);
			label$1899$146:
			if( r11 == NULL ) hl_null_access();
			r7 = r11->bytes;
			if( r7 == NULL ) hl_null_access();
			r36 = r11->width;
			r35 = r29 * r36;
			r34 = r31 + r35;
			r35 = 2;
			r34 = r34 << r35;
			r35 = r11->offset;
			r34 = r34 + r35;
			r36 = 24;
			r35 = ((unsigned)r32) >> r36;
			r37 = 8;
			r36 = r32 >> r37;
			r37 = 65280;
			r36 = r36 & r37;
			r35 = r35 | r36;
			r37 = 8;
			r36 = r32 << r37;
			r37 = 16711680;
			r36 = r36 & r37;
			r35 = r35 | r36;
			r37 = 24;
			r36 = r32 << r37;
			r35 = r35 | r36;
			haxe_io_Bytes_setInt32(r7,r34,r35);
			goto label$1899$129;
			label$1899$173:
			goto label$1899$124;
			label$1899$174:
			if( r23 == NULL ) hl_null_access();
			r26 = hl_vfields(r23)[2] ? (*(vvirtual**)(hl_vfields(r23)[2])) : (vvirtual*)hl_dyn_getp(r23->value,-50329203/*header*/,&type$1438);
			if( r26 == NULL ) hl_null_access();
			r38 = hl_vfields(r26)[7] ? (*(venum**)(hl_vfields(r26)[7])) : (venum*)hl_dyn_getp(r26->value,-213835246/*imageOrigin*/,&type$465);
			if( r38 == NULL ) hl_null_access();
			r21 = HL__ENUM_INDEX__(r38);
			switch(r21) {
				default:
				case 1:
					r14 = (String)global$1219;
					r26 = hl_vfields(r23)[2] ? (*(vvirtual**)(hl_vfields(r23)[2])) : (vvirtual*)hl_dyn_getp(r23->value,-50329203/*header*/,&type$1438);
					if( r26 == NULL ) hl_null_access();
					r38 = hl_vfields(r26)[7] ? (*(venum**)(hl_vfields(r26)[7])) : (venum*)hl_dyn_getp(r26->value,-213835246/*imageOrigin*/,&type$465);
					r15 = Std_string(((vdynamic*)r38));
					r14 = String___add__(r14,r15);
					hl_throw((vdynamic*)r14);
				case 0:
					if( r10 == NULL ) hl_null_access();
					r21 = r10->flags;
					r29 = 4;
					r21 = r21 | r29;
					r10->flags = r21;
					goto label$1899$194;
				case 2:
					break;
			}
	}
	label$1899$194:
	if( !r1 ) goto label$1899$197;
	if( r10 == NULL ) hl_null_access();
	hxd_Pixels_convert(r10,r1);
	label$1899$197:
	if( !r2 ) goto label$1899$201;
	if( r10 == NULL ) hl_null_access();
	r13 = r2 ? r2->v.b : 0;
	hxd_Pixels_setFlip(r10,r13);
	label$1899$201:
	return r10;
}

hxd__BitmapData hxd_res_Image_toBitmap(hxd__res__Image r0) {
	hxd__Pixels r7;
	vvirtual *r1, *r4;
	venum *r8;
	hxd__BitmapData r2;
	vdynamic *r9;
	int r3, r5;
	r1 = hxd_res_Image_getSize(r0);
	r2 = (hxd__BitmapData)hl_alloc_obj(hxd__BitmapData__val);
	r4 = r0->inf;
	if( r4 == NULL ) hl_null_access();
	r3 = hl_vfields(r4)[2] ? (*(int*)(hl_vfields(r4)[2])) : (int)hl_dyn_geti(r4->value,-362629759/*width*/,&type$3);
	r4 = r0->inf;
	if( r4 == NULL ) hl_null_access();
	r5 = hl_vfields(r4)[1] ? (*(int*)(hl_vfields(r4)[1])) : (int)hl_dyn_geti(r4->value,38537191/*height*/,&type$3);
	hxd_BitmapData_new(r2,r3,r5);
	r8 = NULL;
	r9 = NULL;
	r7 = hxd_res_Image_getPixels(r0,r8,r9);
	hxd_BitmapData_setPixels(r2,r7);
	if( r7 == NULL ) hl_null_access();
	hxd_Pixels_dispose(r7);
	return r2;
}

void hxd_res_Image_watchCallb(hxd__res__Image r0) {
	vvirtual *r2, *r5;
	vclosure *r8;
	h3d__mat__Texture r7;
	int r1, r4, r6;
	r2 = r0->inf;
	if( r2 == NULL ) hl_null_access();
	r1 = hl_vfields(r2)[2] ? (*(int*)(hl_vfields(r2)[2])) : (int)hl_dyn_geti(r2->value,-362629759/*width*/,&type$3);
	r2 = r0->inf;
	if( r2 == NULL ) hl_null_access();
	r4 = hl_vfields(r2)[1] ? (*(int*)(hl_vfields(r2)[1])) : (int)hl_dyn_geti(r2->value,38537191/*height*/,&type$3);
	r2 = NULL;
	r0->inf = r2;
	r5 = hxd_res_Image_getSize(r0);
	if( r5 == NULL ) hl_null_access();
	r6 = hl_vfields(r5)[1] ? (*(int*)(hl_vfields(r5)[1])) : (int)hl_dyn_geti(r5->value,-362629759/*width*/,&type$3);
	if( r1 != r6 ) goto label$1901$14;
	r6 = hl_vfields(r5)[0] ? (*(int*)(hl_vfields(r5)[0])) : (int)hl_dyn_geti(r5->value,38537191/*height*/,&type$3);
	if( r4 == r6 ) goto label$1901$17;
	label$1901$14:
	r7 = r0->tex;
	if( r7 == NULL ) hl_null_access();
	h3d_mat_Texture_resize(r7,r1,r4);
	label$1901$17:
	r7 = r0->tex;
	if( r7 == NULL ) hl_null_access();
	r8 = NULL;
	r7->realloc = r8;
	hxd_res_Image_loadTexture(r0);
	return;
}

void hxd_res_Image_loadTexture(hxd__res__Image r0) {
	hxd__fs__FileEntry r6;
	bool r3;
	hxd__res__$Image r4;
	vclosure *r5, *r9;
	h3d__mat__Texture r7;
	int r2, r8;
	r2 = hxd_res_Image_getFormat(r0);
	r4 = (hxd__res__$Image)global$167;
	r3 = r4->DEFAULT_ASYNC;
	if( r3 ) goto label$1902$16;
	r5 = hl_alloc_closure_ptr(&type$3714,fun$3745,r0);
	r6 = r0->entry;
	if( r6 == NULL ) hl_null_access();
	r3 = hxd_fs_FileEntry_get_isAvailable(r6);
	if( !r3 ) goto label$1902$12;
	if( r5 == NULL ) hl_null_access();
	r5->hasValue ? ((void (*)(vdynamic*))r5->fun)((vdynamic*)r5->value) : ((void (*)(void))r5->fun)();
	goto label$1902$15;
	label$1902$12:
	r6 = r0->entry;
	if( r6 == NULL ) hl_null_access();
	((void (*)(hxd__fs__FileEntry,vclosure*))r6->$type->vobj_proto[7])(r6,r5);
	label$1902$15:
	goto label$1902$26;
	label$1902$16:
	r7 = r0->tex;
	if( r7 == NULL ) hl_null_access();
	r2 = r7->flags;
	r8 = 512;
	r2 = r2 | r8;
	r7->flags = r2;
	r6 = r0->entry;
	if( r6 == NULL ) hl_null_access();
	r9 = hl_alloc_closure_ptr(&type$3715,fun$3746,r0);
	((void (*)(hxd__fs__FileEntry,vclosure*))r6->$type->vobj_proto[8])(r6,r9);
	label$1902$26:
	return;
}

h3d__mat__Texture hxd_res_Image_toTexture(hxd__res__Image r0) {
	hxd__fs__FileEntry r22;
	String r21;
	hl__types__ArrayObj r13;
	vvirtual *r3, *r5, *r18;
	venum *r16, *r17, *r19, *r20;
	hl_type *r15;
	bool r7;
	hxd__res__$Image r8;
	varray *r14;
	int r4, r6, r9, r10, r11, r12;
	h3d__mat__Texture r2;
	r2 = r0->tex;
	if( !r2 ) goto label$1903$4;
	r2 = r0->tex;
	return r2;
	label$1903$4:
	r3 = hxd_res_Image_getSize(r0);
	r5 = r0->inf;
	if( r5 == NULL ) hl_null_access();
	r4 = hl_vfields(r5)[2] ? (*(int*)(hl_vfields(r5)[2])) : (int)hl_dyn_geti(r5->value,-362629759/*width*/,&type$3);
	r5 = r0->inf;
	if( r5 == NULL ) hl_null_access();
	r6 = hl_vfields(r5)[1] ? (*(int*)(hl_vfields(r5)[1])) : (int)hl_dyn_geti(r5->value,38537191/*height*/,&type$3);
	r8 = (hxd__res__$Image)global$167;
	r7 = r8->ALLOW_NPOT;
	if( r7 ) goto label$1903$30;
	r9 = 1;
	r10 = 1;
	label$1903$16:
	if( r9 >= r4 ) goto label$1903$22;
	r12 = 1;
	r11 = r9 << r12;
	r9 = r11;
	goto label$1903$16;
	label$1903$22:
	if( r10 >= r6 ) goto label$1903$28;
	r12 = 1;
	r11 = r10 << r12;
	r10 = r11;
	goto label$1903$22;
	label$1903$28:
	r4 = r9;
	r6 = r10;
	label$1903$30:
	r2 = (h3d__mat__Texture)hl_alloc_obj(h3d__mat__Texture__val);
	r15 = &type$497;
	r11 = 1;
	r14 = hl_alloc_array(r15,r11);
	r16 = (venum*)global$465;
	r11 = 0;
	((venum**)(r14 + 1))[r11] = r16;
	r13 = hl_types_ArrayObj_alloc(r14);
	r17 = NULL;
	r18 = NULL;
	h3d_mat_Texture_new(r2,r4,r6,r13,r17,r18);
	r0->tex = r2;
	r8 = (hxd__res__$Image)global$167;
	r19 = r8->DEFAULT_FILTER;
	r20 = (venum*)global$419;
	if( r19 == r20 ) goto label$1903$51;
	r2 = r0->tex;
	if( r2 == NULL ) hl_null_access();
	r8 = (hxd__res__$Image)global$167;
	r19 = r8->DEFAULT_FILTER;
	r19 = h3d_mat_Texture_set_filter(r2,r19);
	label$1903$51:
	r2 = r0->tex;
	if( r2 == NULL ) hl_null_access();
	r22 = r0->entry;
	if( r22 == NULL ) hl_null_access();
	r21 = ((String (*)(hxd__fs__FileEntry))r22->$type->vobj_proto[15])(r22);
	h3d_mat_Texture_setName(r2,r21);
	hxd_res_Image_loadTexture(r0);
	r2 = r0->tex;
	return r2;
}

h2d__Tile hxd_res_Image_toTile(hxd__res__Image r0) {
	vvirtual *r1;
	h2d__Tile r2;
	int *r8, *r9;
	int r4, r5, r6, r7;
	h3d__mat__Texture r3;
	r1 = hxd_res_Image_getSize(r0);
	r3 = hxd_res_Image_toTexture(r0);
	r2 = h2d_Tile_fromTexture(r3);
	if( r2 == NULL ) hl_null_access();
	r4 = 0;
	r5 = 0;
	if( r1 == NULL ) hl_null_access();
	r6 = hl_vfields(r1)[1] ? (*(int*)(hl_vfields(r1)[1])) : (int)hl_dyn_geti(r1->value,-362629759/*width*/,&type$3);
	r7 = hl_vfields(r1)[0] ? (*(int*)(hl_vfields(r1)[0])) : (int)hl_dyn_geti(r1->value,38537191/*height*/,&type$3);
	r8 = NULL;
	r9 = NULL;
	r2 = h2d_Tile_sub(r2,r4,r5,r6,r7,r8,r9);
	return r2;
}

void hxd_res_Image_new(hxd__res__Image r0,hxd__fs__FileEntry r1) {
	hxd_res_Resource_new(((hxd__res__Resource)r0),r1);
	return;
}

hxd__Pixels hxd_res_Image_decodePNG(haxe__io__Bytes r0,int r1,int r2,venum* r3,bool r4) {
	hxd__Pixels r19;
	venum *r7;
	bool r14;
	haxe__io__Bytes r9;
	haxe__io__BytesDataImpl r11, r13;
	int *r20;
	vbyte *r12, *r15;
	int r6, r8, r10, r16, r17, r18;
	if( r3 == NULL ) hl_null_access();
	r6 = HL__ENUM_INDEX__(r3);
	switch(r6) {
		default:
			r7 = (venum*)global$903;
			r3 = r7;
			r8 = 8;
			r6 = r8;
			goto label$1895$16;
		case 0:
			r8 = 10;
			r6 = r8;
			goto label$1895$16;
		case 1:
			r8 = 8;
			r6 = r8;
			goto label$1895$16;
		case 2:
			r8 = 7;
			r6 = r8;
	}
	label$1895$16:
	r8 = r1 * r2;
	r10 = 4;
	r8 = r8 * r10;
	r9 = haxe_io_Bytes_alloc(r8);
	r11 = (haxe__io__BytesDataImpl)hl_alloc_obj(haxe__io__BytesDataImpl__val);
	if( r0 == NULL ) hl_null_access();
	r12 = r0->b;
	r8 = r0->length;
	haxe_io_BytesDataImpl_new(r11,r12,r8);
	r13 = (haxe__io__BytesDataImpl)hl_alloc_obj(haxe__io__BytesDataImpl__val);
	if( r9 == NULL ) hl_null_access();
	r12 = r9->b;
	r8 = r9->length;
	haxe_io_BytesDataImpl_new(r13,r12,r8);
	if( r11 ) goto label$1895$33;
	r12 = NULL;
	goto label$1895$34;
	label$1895$33:
	r12 = r11->bytes;
	label$1895$34:
	r8 = r0->length;
	if( r13 ) goto label$1895$38;
	r15 = NULL;
	goto label$1895$39;
	label$1895$38:
	r15 = r13->bytes;
	label$1895$39:
	r17 = 4;
	r16 = r1 * r17;
	if( !r4 ) goto label$1895$44;
	r18 = 1;
	goto label$1895$45;
	label$1895$44:
	r18 = 0;
	label$1895$45:
	r14 = fmt_png_decode(r12,r8,r15,r1,r2,r16,r6,r18);
	if( r14 ) goto label$1895$49;
	r19 = NULL;
	return r19;
	label$1895$49:
	r19 = (hxd__Pixels)hl_alloc_obj(hxd__Pixels__val);
	r20 = NULL;
	hxd_Pixels_new(r19,r1,r2,r9,r3,r20);
	if( !r4 ) goto label$1895$57;
	r8 = r19->flags;
	r10 = 4;
	r8 = r8 | r10;
	r19->flags = r8;
	label$1895$57:
	return r19;
}

hxd__Pixels hxd_res_Image_decodeJPG(haxe__io__Bytes r0,int r1,int r2,venum* r3,bool r4) {
	hxd__Pixels r19;
	venum *r7;
	bool r14;
	haxe__io__Bytes r9;
	haxe__io__BytesDataImpl r11, r13;
	int *r20;
	vbyte *r12, *r15;
	int r6, r8, r10, r16, r17, r18;
	if( r3 == NULL ) hl_null_access();
	r6 = HL__ENUM_INDEX__(r3);
	switch(r6) {
		default:
			r7 = (venum*)global$903;
			r3 = r7;
			r8 = 8;
			r6 = r8;
			goto label$1894$16;
		case 0:
			r8 = 10;
			r6 = r8;
			goto label$1894$16;
		case 1:
			r8 = 8;
			r6 = r8;
			goto label$1894$16;
		case 2:
			r8 = 7;
			r6 = r8;
	}
	label$1894$16:
	r8 = r1 * r2;
	r10 = 4;
	r8 = r8 * r10;
	r9 = haxe_io_Bytes_alloc(r8);
	r11 = (haxe__io__BytesDataImpl)hl_alloc_obj(haxe__io__BytesDataImpl__val);
	if( r0 == NULL ) hl_null_access();
	r12 = r0->b;
	r8 = r0->length;
	haxe_io_BytesDataImpl_new(r11,r12,r8);
	r13 = (haxe__io__BytesDataImpl)hl_alloc_obj(haxe__io__BytesDataImpl__val);
	if( r9 == NULL ) hl_null_access();
	r12 = r9->b;
	r8 = r9->length;
	haxe_io_BytesDataImpl_new(r13,r12,r8);
	if( r11 ) goto label$1894$33;
	r12 = NULL;
	goto label$1894$34;
	label$1894$33:
	r12 = r11->bytes;
	label$1894$34:
	r8 = r0->length;
	if( r13 ) goto label$1894$38;
	r15 = NULL;
	goto label$1894$39;
	label$1894$38:
	r15 = r13->bytes;
	label$1894$39:
	r17 = 4;
	r16 = r1 * r17;
	if( !r4 ) goto label$1894$44;
	r18 = 1;
	goto label$1894$45;
	label$1894$44:
	r18 = 0;
	label$1894$45:
	r14 = fmt_jpg_decode(r12,r8,r15,r1,r2,r16,r6,r18);
	if( r14 ) goto label$1894$49;
	r19 = NULL;
	return r19;
	label$1894$49:
	r19 = (hxd__Pixels)hl_alloc_obj(hxd__Pixels__val);
	r20 = NULL;
	hxd_Pixels_new(r19,r1,r2,r9,r3,r20);
	if( !r4 ) goto label$1894$57;
	r8 = r19->flags;
	r10 = 4;
	r8 = r8 | r10;
	r19->flags = r8;
	label$1894$57:
	return r19;
}

