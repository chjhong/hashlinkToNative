// Generated by HLC 4.0.0 (HL v4)
#include <hl/code.h>

void hxd_fs_ConvertTGA2PNG_convert(hxd__fs__ConvertTGA2PNG r0) {
	String r5, r14;
	hxd__Pixels r17, r21;
	haxe__io__BytesInput r3;
	vvirtual *r1, *r10;
	venum *r9, *r11, *r20, *r30;
	haxe__io__Bytes r4;
	hl__types__ArrayBytes_Int r25;
	int *r15;
	vdynamic *r6, *r7;
	format__tga__Reader r2;
	vbyte *r16;
	int r12, r13, r18, r19, r22, r23, r24, r26, r27, r28, r29;
	r2 = (format__tga__Reader)hl_alloc_obj(format__tga__Reader__val);
	r3 = (haxe__io__BytesInput)hl_alloc_obj(haxe__io__BytesInput__val);
	r5 = r0->srcPath;
	r4 = sys_io_File_getBytes(r5);
	r6 = NULL;
	r7 = NULL;
	haxe_io_BytesInput_new(r3,r4,r6,r7);
	format_tga_Reader_new(r2,((haxe__io__Input)r3));
	r1 = format_tga_Reader_read(r2);
	if( r1 == NULL ) hl_null_access();
	r10 = hl_vfields(r1)[2] ? (*(vvirtual**)(hl_vfields(r1)[2])) : (vvirtual*)hl_dyn_getp(r1->value,-50329203/*header*/,&type$1438);
	if( r10 == NULL ) hl_null_access();
	r9 = hl_vfields(r10)[8] ? (*(venum**)(hl_vfields(r10)[8])) : (venum*)hl_dyn_getp(r10->value,255690810/*imageType*/,&type$464);
	r11 = (venum*)global$367;
	if( r9 != r11 ) goto label$3540$20;
	r10 = hl_vfields(r1)[2] ? (*(vvirtual**)(hl_vfields(r1)[2])) : (vvirtual*)hl_dyn_getp(r1->value,-50329203/*header*/,&type$1438);
	if( r10 == NULL ) hl_null_access();
	r12 = hl_vfields(r10)[1] ? (*(int*)(hl_vfields(r10)[1])) : (int)hl_dyn_geti(r10->value,485379471/*bitsPerPixel*/,&type$3);
	r13 = 32;
	if( r12 == r13 ) goto label$3540$36;
	label$3540$20:
	r5 = (String)global$1219;
	r10 = hl_vfields(r1)[2] ? (*(vvirtual**)(hl_vfields(r1)[2])) : (vvirtual*)hl_dyn_getp(r1->value,-50329203/*header*/,&type$1438);
	if( r10 == NULL ) hl_null_access();
	r9 = hl_vfields(r10)[8] ? (*(venum**)(hl_vfields(r10)[8])) : (venum*)hl_dyn_getp(r10->value,255690810/*imageType*/,&type$464);
	r14 = Std_string(((vdynamic*)r9));
	r5 = String___add__(r5,r14);
	r14 = (String)global$207;
	r5 = String___add__(r5,r14);
	r10 = hl_vfields(r1)[2] ? (*(vvirtual**)(hl_vfields(r1)[2])) : (vvirtual*)hl_dyn_getp(r1->value,-50329203/*header*/,&type$1438);
	if( r10 == NULL ) hl_null_access();
	r12 = hl_vfields(r10)[1] ? (*(int*)(hl_vfields(r10)[1])) : (int)hl_dyn_geti(r10->value,485379471/*bitsPerPixel*/,&type$3);
	r15 = &r12;
	r16 = hl_itos(r12,r15);
	r14 = String___alloc__(r16,r12);
	r5 = String___add__(r5,r14);
	hl_throw((vdynamic*)r5);
	label$3540$36:
	r10 = hl_vfields(r1)[2] ? (*(vvirtual**)(hl_vfields(r1)[2])) : (vvirtual*)hl_dyn_getp(r1->value,-50329203/*header*/,&type$1438);
	if( r10 == NULL ) hl_null_access();
	r12 = hl_vfields(r10)[9] ? (*(int*)(hl_vfields(r10)[9])) : (int)hl_dyn_geti(r10->value,-362629759/*width*/,&type$3);
	r10 = hl_vfields(r1)[2] ? (*(vvirtual**)(hl_vfields(r1)[2])) : (vvirtual*)hl_dyn_getp(r1->value,-50329203/*header*/,&type$1438);
	if( r10 == NULL ) hl_null_access();
	r13 = hl_vfields(r10)[6] ? (*(int*)(hl_vfields(r10)[6])) : (int)hl_dyn_geti(r10->value,38537191/*height*/,&type$3);
	r20 = (venum*)global$948;
	r17 = hxd_Pixels_alloc(r12,r13,r20);
	r21 = hxd__Pixels_PixelsARGB_Impl__fromPixels(r17);
	r18 = 0;
	label$3540$46:
	if( r18 >= r13 ) goto label$3540$96;
	r19 = r18;
	++r18;
	r22 = 0;
	label$3540$51:
	if( r22 >= r12 ) goto label$3540$95;
	r23 = r22;
	++r22;
	if( r1 == NULL ) hl_null_access();
	r25 = hl_vfields(r1)[3] ? (*(hl__types__ArrayBytes_Int*)(hl_vfields(r1)[3])) : (hl__types__ArrayBytes_Int)hl_dyn_getp(r1->value,77065130/*imageData*/,&type$33);
	if( r25 == NULL ) hl_null_access();
	r26 = r19 * r12;
	r24 = r23 + r26;
	r26 = r25->length;
	if( ((unsigned)r24) < ((unsigned)r26) ) goto label$3540$64;
	r24 = 0;
	goto label$3540$68;
	label$3540$64:
	r16 = r25->bytes;
	r26 = 2;
	r26 = r24 << r26;
	r24 = *(int*)(r16 + r26);
	label$3540$68:
	if( r21 == NULL ) hl_null_access();
	r4 = r21->bytes;
	if( r4 == NULL ) hl_null_access();
	r28 = r21->width;
	r27 = r19 * r28;
	r26 = r23 + r27;
	r27 = 2;
	r26 = r26 << r27;
	r27 = r21->offset;
	r26 = r26 + r27;
	r28 = 24;
	r27 = ((unsigned)r24) >> r28;
	r29 = 8;
	r28 = r24 >> r29;
	r29 = 65280;
	r28 = r28 & r29;
	r27 = r27 | r28;
	r29 = 8;
	r28 = r24 << r29;
	r29 = 16711680;
	r28 = r28 & r29;
	r27 = r27 | r28;
	r29 = 24;
	r28 = r24 << r29;
	r27 = r27 | r28;
	haxe_io_Bytes_setInt32(r4,r26,r27);
	goto label$3540$51;
	label$3540$95:
	goto label$3540$46;
	label$3540$96:
	if( r1 == NULL ) hl_null_access();
	r10 = hl_vfields(r1)[2] ? (*(vvirtual**)(hl_vfields(r1)[2])) : (vvirtual*)hl_dyn_getp(r1->value,-50329203/*header*/,&type$1438);
	if( r10 == NULL ) hl_null_access();
	r30 = hl_vfields(r10)[7] ? (*(venum**)(hl_vfields(r10)[7])) : (venum*)hl_dyn_getp(r10->value,-213835246/*imageOrigin*/,&type$465);
	if( r30 == NULL ) hl_null_access();
	r18 = HL__ENUM_INDEX__(r30);
	switch(r18) {
		default:
		case 1:
			r5 = (String)global$1219;
			r10 = hl_vfields(r1)[2] ? (*(vvirtual**)(hl_vfields(r1)[2])) : (vvirtual*)hl_dyn_getp(r1->value,-50329203/*header*/,&type$1438);
			if( r10 == NULL ) hl_null_access();
			r30 = hl_vfields(r10)[7] ? (*(venum**)(hl_vfields(r10)[7])) : (venum*)hl_dyn_getp(r10->value,-213835246/*imageOrigin*/,&type$465);
			r14 = Std_string(((vdynamic*)r30));
			r5 = String___add__(r5,r14);
			hl_throw((vdynamic*)r5);
		case 0:
			if( r17 == NULL ) hl_null_access();
			r18 = r17->flags;
			r19 = 4;
			r18 = r18 | r19;
			r17->flags = r18;
			goto label$3540$116;
		case 2:
			break;
	}
	label$3540$116:
	r5 = r0->dstPath;
	if( r17 == NULL ) hl_null_access();
	r6 = NULL;
	r4 = hxd_Pixels_toPNG(r17,r6);
	sys_io_File_saveBytes(r5,r4);
	return;
}

void hxd_fs_ConvertTGA2PNG_new(hxd__fs__ConvertTGA2PNG r0) {
	String r2, r3;
	r2 = (String)global$1218;
	r3 = (String)global$405;
	hxd_fs_Convert_new(((hxd__fs__Convert)r0),r2,r3);
	return;
}

