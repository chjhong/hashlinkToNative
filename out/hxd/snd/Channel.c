// Generated by HLC 4.0.0 (HL v4)
#include <hl/code.h>

double hxd_snd_Channel_set_position(hxd__snd__Channel r0,double r1) {
	bool r3;
	double r2;
	r2 = hl_sys_time();
	r0->lastStamp = r2;
	r3 = true;
	r0->positionChanged = r3;
	r0->position = r1;
	return r1;
}

bool hxd_snd_Channel_set_pause(hxd__snd__Channel r0,bool r1) {
	double r2;
	if( r1 ) goto label$3673$3;
	r2 = hl_sys_time();
	r0->lastStamp = r2;
	label$3673$3:
	r0->pause = r1;
	return r1;
}

void hxd_snd_Channel_updateCurrentVolume(hxd__snd__Channel r0,double r1) {
	hl__types__ArrayObj r13;
	vvirtual *r4, *r5;
	hxd__snd__Manager r11;
	bool r3;
	hxd__snd__Effect r16;
	hxd__snd__SoundGroup r10;
	double r6, r8, r9;
	vdynamic *r17;
	varray *r18;
	int r12, r14, r15;
	hxd__snd__ChannelGroup r7;
	r3 = r0->pause;
	if( !r3 ) goto label$3674$9;
	r4 = r0->currentFade;
	if( !r4 ) goto label$3674$9;
	r4 = r0->currentFade;
	r5 = NULL;
	r0->currentFade = r5;
	hxd_snd_Channel_updateCurrentVolume(r0,r1);
	r0->currentFade = r4;
	label$3674$9:
	hxd_snd_ChannelBase_updateCurrentVolume(((hxd__snd__ChannelBase)r0),r1);
	r7 = r0->channelGroup;
	if( r7 == NULL ) hl_null_access();
	hxd_snd_ChannelBase_updateCurrentVolume(((hxd__snd__ChannelBase)r7),r1);
	r6 = r0->currentVolume;
	r7 = r0->channelGroup;
	if( r7 == NULL ) hl_null_access();
	r8 = r7->currentVolume;
	r10 = r0->soundGroup;
	if( r10 == NULL ) hl_null_access();
	r9 = r10->volume;
	r8 = r8 * r9;
	r6 = r6 * r8;
	r0->currentVolume = r6;
	r11 = r0->manager;
	if( !r11 ) goto label$3674$69;
	r12 = 0;
	r7 = r0->channelGroup;
	if( r7 == NULL ) hl_null_access();
	r13 = r7->effects;
	label$3674$29:
	if( r13 == NULL ) hl_null_access();
	r15 = r13->length;
	if( r12 >= r15 ) goto label$3674$48;
	r6 = r0->currentVolume;
	r14 = r12;
	++r12;
	r15 = r13->length;
	if( ((unsigned)r14) < ((unsigned)r15) ) goto label$3674$40;
	r16 = NULL;
	goto label$3674$43;
	label$3674$40:
	r18 = r13->array;
	r17 = ((vdynamic**)(r18 + 1))[r14];
	r16 = (hxd__snd__Effect)r17;
	label$3674$43:
	if( r16 == NULL ) hl_null_access();
	r8 = ((double (*)(hxd__snd__Effect))r16->$type->vobj_proto[1])(r16);
	r6 = r6 * r8;
	r0->currentVolume = r6;
	goto label$3674$29;
	label$3674$48:
	r12 = 0;
	r13 = r0->effects;
	label$3674$50:
	if( r13 == NULL ) hl_null_access();
	r15 = r13->length;
	if( r12 >= r15 ) goto label$3674$69;
	r6 = r0->currentVolume;
	r14 = r12;
	++r12;
	r15 = r13->length;
	if( ((unsigned)r14) < ((unsigned)r15) ) goto label$3674$61;
	r16 = NULL;
	goto label$3674$64;
	label$3674$61:
	r18 = r13->array;
	r17 = ((vdynamic**)(r18 + 1))[r14];
	r16 = (hxd__snd__Effect)r17;
	label$3674$64:
	if( r16 == NULL ) hl_null_access();
	r8 = ((double (*)(hxd__snd__Effect))r16->$type->vobj_proto[1])(r16);
	r6 = r6 * r8;
	r0->currentVolume = r6;
	goto label$3674$50;
	label$3674$69:
	return;
}

void hxd_snd_Channel_calcAudibleGain(hxd__snd__Channel r0,double r1) {
	hl__types__ArrayObj r6;
	hxd__snd__Manager r4;
	hxd__snd__Effect r10;
	double r3;
	vdynamic *r11;
	varray *r12;
	hxd__snd__ChannelGroup r7;
	int r5, r8, r9;
	hxd_snd_Channel_updateCurrentVolume(r0,r1);
	r3 = r0->currentVolume;
	r0->audibleGain = r3;
	r4 = r0->manager;
	if( !r4 ) goto label$3675$47;
	r5 = 0;
	r7 = r0->channelGroup;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->effects;
	label$3675$9:
	if( r6 == NULL ) hl_null_access();
	r9 = r6->length;
	if( r5 >= r9 ) goto label$3675$27;
	r8 = r5;
	++r5;
	r9 = r6->length;
	if( ((unsigned)r8) < ((unsigned)r9) ) goto label$3675$19;
	r10 = NULL;
	goto label$3675$22;
	label$3675$19:
	r12 = r6->array;
	r11 = ((vdynamic**)(r12 + 1))[r8];
	r10 = (hxd__snd__Effect)r11;
	label$3675$22:
	if( r10 == NULL ) hl_null_access();
	r3 = r0->audibleGain;
	r3 = ((double (*)(hxd__snd__Effect,double))r10->$type->vobj_proto[0])(r10,r3);
	r0->audibleGain = r3;
	goto label$3675$9;
	label$3675$27:
	r5 = 0;
	r6 = r0->effects;
	label$3675$29:
	if( r6 == NULL ) hl_null_access();
	r9 = r6->length;
	if( r5 >= r9 ) goto label$3675$47;
	r8 = r5;
	++r5;
	r9 = r6->length;
	if( ((unsigned)r8) < ((unsigned)r9) ) goto label$3675$39;
	r10 = NULL;
	goto label$3675$42;
	label$3675$39:
	r12 = r6->array;
	r11 = ((vdynamic**)(r12 + 1))[r8];
	r10 = (hxd__snd__Effect)r11;
	label$3675$42:
	if( r10 == NULL ) hl_null_access();
	r3 = r0->audibleGain;
	r3 = ((double (*)(hxd__snd__Effect,double))r10->$type->vobj_proto[0])(r10,r3);
	r0->audibleGain = r3;
	goto label$3675$29;
	label$3675$47:
	return;
}

void hxd_snd_Channel_queueSound(hxd__snd__Channel r0,hxd__res__Sound r1) {
	hl__types__ArrayObj r3;
	int r2;
	r3 = r0->queue;
	if( r3 == NULL ) hl_null_access();
	r2 = hl_types_ArrayObj_push(r3,((vdynamic*)r1));
	return;
}

void hxd_snd_Channel_stop(hxd__snd__Channel r0) {
	hxd__snd__Manager r2;
	r2 = r0->manager;
	if( !r2 ) goto label$3677$5;
	r2 = r0->manager;
	if( r2 == NULL ) hl_null_access();
	hxd_snd_Manager_releaseChannel(r2,r0);
	label$3677$5:
	return;
}

void hxd_snd_Channel_onEnd(hxd__snd__Channel r0) {
	return;
}

void hxd_snd_Channel_new(hxd__snd__Channel r0) {
	hl__types__ArrayObj r7;
	hl_type *r9;
	bool r6;
	double r10;
	vclosure *r1;
	varray *r8;
	int r4, r5;
	hxd__snd__$Channel r3;
	r1 = r0->onEnd;
	if( r1 ) goto label$3725$4;
	r1 = hl_alloc_closure_ptr(&type$3744,hxd_snd_Channel_onEnd,r0);
	r0->onEnd = r1;
	label$3725$4:
	hxd_snd_ChannelBase_new(((hxd__snd__ChannelBase)r0));
	r3 = (hxd__snd__$Channel)global$1285;
	r4 = r3->ID;
	r5 = r4;
	++r4;
	r3->ID = r4;
	r0->id = r5;
	r6 = false;
	r6 = hxd_snd_Channel_set_pause(r0,r6);
	r6 = false;
	r0->isVirtual = r6;
	r6 = false;
	r0->loop = r6;
	r9 = &type$768;
	r4 = 0;
	r8 = hl_alloc_array(r9,r4);
	r7 = hl_types_ArrayObj_alloc(r8);
	r0->queue = r7;
	r10 = 0.;
	r10 = hxd_snd_Channel_set_position(r0,r10);
	r10 = 1.;
	r0->audibleGain = r10;
	return;
}

