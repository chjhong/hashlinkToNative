// Generated by HLC 4.0.0 (HL v4)
#include <hl/code.h>

bool hxd_System_set_allowTimeout(bool r0) {
	ui_sentinel *r2;
	bool r1;
	hxd__$System r3;
	r3 = (hxd__$System)global$409;
	r2 = r3->sentinel;
	r1 = !r0;
	r1 = hl__UI_Sentinel_Impl__set_pause(r2,r1);
	return r1;
}

bool hxd_System_get_allowTimeout() {
	ui_sentinel *r1;
	bool r0;
	hxd__$System r2;
	r2 = (hxd__$System)global$409;
	r1 = r2->sentinel;
	r0 = hl__UI_Sentinel_Impl__get_pause(r1);
	r0 = !r0;
	return r0;
}

void hxd_System_timeoutTick() {
	ui_sentinel *r1;
	hxd__$System r2;
	r2 = (hxd__$System)global$409;
	r1 = r2->sentinel;
	hl__UI_Sentinel_Impl__tick(r1);
	return;
}

int hxd_System_get_screenDPI() {
	int r0;
	r0 = 72;
	return r0;
}

venum* hxd_System_get_platform() {
	venum *r0;
	r0 = (venum*)global$971;
	return r0;
}

int hxd_System_get_height() {
	int r0;
	r0 = directx_get_screen_height();
	return r0;
}

int hxd_System_get_width() {
	int r0;
	r0 = directx_get_screen_width();
	return r0;
}

String hxd_System_get_lang() {
	String r1, r4, r8;
	hl__types__ArrayObj r6;
	EReg r7;
	hxd__$System r2;
	vdynamic *r10;
	varray *r11;
	int r5, r9;
	vbyte *r3;
	r2 = (hxd__$System)global$409;
	r1 = r2->_lang;
	if( r1 ) goto label$2395$25;
	r3 = hl_sys_locale();
	r1 = (String)hl_alloc_obj(String__val);
	r1->bytes = r3;
	r5 = 0;
	r5 = hl_ucs2length(r3,r5);
	r1->length = r5;
	r7 = (EReg)hl_alloc_obj(EReg__val);
	r4 = (String)global$970;
	r8 = (String)global$7;
	EReg_new(r7,r4,r8);
	r6 = EReg_split(r7,r1);
	if( r6 == NULL ) hl_null_access();
	r5 = 0;
	r9 = r6->length;
	if( ((unsigned)r5) < ((unsigned)r9) ) goto label$2395$20;
	r4 = NULL;
	goto label$2395$23;
	label$2395$20:
	r11 = r6->array;
	r10 = ((vdynamic**)(r11 + 1))[r5];
	r4 = (String)r10;
	label$2395$23:
	r2 = (hxd__$System)global$409;
	r2->_lang = r4;
	label$2395$25:
	r2 = (hxd__$System)global$409;
	r1 = r2->_lang;
	return r1;
}

void hxd_System_exit() {
	vdynamic *r0;
	int r2;
	hl_trap_ctx trap$0;
	hl_trap(trap$0,r0,label$2394$5);
	r2 = 0;
	hl_sys_exit(r2);
	hl_endtrap(trap$0);
	goto label$2394$6;
	label$2394$5:
	hxd_System_exit();
	label$2394$6:
	return;
}

bool hxd_System_getValue(venum* r0) {
	bool r3;
	int r1, r2;
	if( r0 == NULL ) hl_null_access();
	r1 = HL__ENUM_INDEX__(r0);
	r2 = 1;
	if( r1 != r2 ) goto label$2393$6;
	r3 = true;
	return r3;
	label$2393$6:
	r3 = false;
	return r3;
}

double hxd_System_getDefaultFrameRate() {
	double r0;
	r0 = 60.;
	return r0;
}

String hxd_System_getDeviceName() {
	String r0, r1;
	r0 = (String)global$969;
	r1 = dx_Driver_getDeviceName();
	r0 = String___add__(r0,r1);
	return r0;
}

void hxd_System_updateCursor() {
	dx_cursor *r8;
	hl__types__ArrayObj r7;
	hxd__CustomCursor r1;
	hxd__$Timer r5;
	hxd__$System r2;
	double r4;
	vdynamic *r9;
	varray *r10;
	int r3, r6;
	r2 = (hxd__$System)global$409;
	r1 = r2->currentCustomCursor;
	if( !r1 ) goto label$2390$24;
	r2 = (hxd__$System)global$409;
	r1 = r2->currentCustomCursor;
	if( r1 == NULL ) hl_null_access();
	r5 = (hxd__$Timer)global$146;
	r4 = r5->elapsedTime;
	r3 = hxd_CustomCursor_update(r1,r4);
	r6 = -1;
	if( r3 == r6 ) goto label$2390$24;
	r2 = (hxd__$System)global$409;
	r1 = r2->currentCustomCursor;
	if( r1 == NULL ) hl_null_access();
	r7 = r1->alloc;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->length;
	if( ((unsigned)r3) < ((unsigned)r6) ) goto label$2390$20;
	r8 = NULL;
	goto label$2390$23;
	label$2390$20:
	r10 = r7->array;
	r9 = ((vdynamic**)(r10 + 1))[r3];
	r8 = (dx_cursor*)hl_dyn_castp(&r9,&type$9,&type$884);
	label$2390$23:
	dx__Cursor_Cursor_Impl__set(r8);
	label$2390$24:
	return;
}

void hxd_System_setNativeCursor(venum* r0) {
	String r10;
	hxd__Pixels r15;
	hl__types__ArrayObj r11, r14;
	dx_cursor *r8, *r9;
	hxd__CustomCursor r6;
	venum *r3, *r18;
	haxe__io__Bytes r20;
	bool r2;
	hxd__BitmapData r16;
	hxd__$System r4;
	vdynamic *r5;
	vbyte *r19;
	varray *r17;
	int r7, r12, r13, r21, r22;
	r4 = (hxd__$System)global$409;
	r3 = r4->currentNativeCursor;
	r2 = hl_type_enum_eq(((vdynamic*)r0),((vdynamic*)r3));
	if( !r2 ) goto label$2389$5;
	return;
	label$2389$5:
	r4 = (hxd__$System)global$409;
	r4->currentNativeCursor = r0;
	r6 = NULL;
	r4 = (hxd__$System)global$409;
	r4->currentCustomCursor = r6;
	r3 = (venum*)global$968;
	if( r0 != r3 ) goto label$2389$18;
	r2 = false;
	r4 = (hxd__$System)global$409;
	r4->cursorVisible = r2;
	r2 = false;
	directx_show_cursor(r2);
	return;
	label$2389$18:
	if( r0 == NULL ) hl_null_access();
	r7 = HL__ENUM_INDEX__(r0);
	switch(r7) {
		default:
			goto label$2389$102;
		case 0:
			r7 = 32512;
			r9 = directx_load_cursor(r7);
			r8 = r9;
			goto label$2389$102;
		case 1:
			r7 = 32649;
			r9 = directx_load_cursor(r7);
			r8 = r9;
			goto label$2389$102;
		case 2:
			r7 = 32646;
			r9 = directx_load_cursor(r7);
			r8 = r9;
			goto label$2389$102;
		case 3:
			r7 = 32513;
			r9 = directx_load_cursor(r7);
			r8 = r9;
			goto label$2389$102;
		case 4:
			r10 = (String)global$319;
			hl_throw((vdynamic*)r10);
		case 5:
			r6 = ((hxd_Cursor_Custom*)r0)->p0;
			if( r6 == NULL ) hl_null_access();
			r11 = r6->alloc;
			if( r11 ) goto label$2389$82;
			r11 = (hl__types__ArrayObj)hl_alloc_obj(hl__types__ArrayObj__val);
			hl_types_ArrayObj_new(r11);
			r6->alloc = r11;
			r7 = 0;
			r11 = r6->frames;
			label$2389$49:
			if( r11 == NULL ) hl_null_access();
			r13 = r11->length;
			if( r7 >= r13 ) goto label$2389$82;
			r12 = r7;
			++r7;
			r13 = r11->length;
			if( ((unsigned)r12) < ((unsigned)r13) ) goto label$2389$59;
			r16 = NULL;
			goto label$2389$62;
			label$2389$59:
			r17 = r11->array;
			r5 = ((vdynamic**)(r17 + 1))[r12];
			r16 = (hxd__BitmapData)r5;
			label$2389$62:
			if( r16 == NULL ) hl_null_access();
			r15 = hxd_BitmapData_getPixels(r16);
			if( r15 == NULL ) hl_null_access();
			r18 = (venum*)global$903;
			hxd_Pixels_convert(r15,r18);
			if( r6 == NULL ) hl_null_access();
			r14 = r6->alloc;
			if( r14 == NULL ) hl_null_access();
			r12 = r15->width;
			r13 = r15->height;
			r20 = r15->bytes;
			if( r20 == NULL ) hl_null_access();
			r19 = r20->b;
			r21 = r6->offsetX;
			r22 = r6->offsetY;
			r9 = directx_create_cursor(r12,r13,r19,r21,r22);
			if( r9 == NULL ) r5 = NULL; else {
				r5 = hl_alloc_dynamic(&type$884);
				r5->v.ptr = r9;
			}
			r12 = hl_types_ArrayObj_push(r14,r5);
			hxd_Pixels_dispose(r15);
			goto label$2389$49;
			label$2389$82:
			if( r6 == NULL ) hl_null_access();
			r11 = r6->frames;
			if( r11 == NULL ) hl_null_access();
			r7 = r11->length;
			r12 = 1;
			if( r12 >= r7 ) goto label$2389$91;
			r4 = (hxd__$System)global$409;
			r4->currentCustomCursor = r6;
			hxd_CustomCursor_reset(r6);
			label$2389$91:
			r11 = r6->alloc;
			if( r11 == NULL ) hl_null_access();
			r7 = r6->frameIndex;
			r12 = r11->length;
			if( ((unsigned)r7) < ((unsigned)r12) ) goto label$2389$98;
			r9 = NULL;
			goto label$2389$101;
			label$2389$98:
			r17 = r11->array;
			r5 = ((vdynamic**)(r17 + 1))[r7];
			r9 = (dx_cursor*)hl_dyn_castp(&r5,&type$9,&type$884);
			label$2389$101:
			r8 = r9;
	}
	label$2389$102:
	dx__Cursor_Cursor_Impl__set(r8);
	r4 = (hxd__$System)global$409;
	r2 = r4->cursorVisible;
	if( r2 ) goto label$2389$111;
	r2 = true;
	r4 = (hxd__$System)global$409;
	r4->cursorVisible = r2;
	r2 = true;
	directx_show_cursor(r2);
	label$2389$111:
	return;
}

void hxd_System_reportError(vdynamic* r0) {
	bool *r13;
	String r1, r5, r6, r7;
	hl__types__ArrayObj r2;
	bool r8;
	hl__WinLog r10;
	hxd__$System r9;
	vclosure *r15;
	hl__Button r14;
	vdynamic *r4;
	int r11, r12;
	hl_trap_ctx trap$0;
	r2 = haxe_CallStack_exceptionStack();
	r1 = haxe_CallStack_toString(r2);
	hl_trap(trap$0,r4,label$2388$7);
	r6 = Std_string(r0);
	r5 = r6;
	hl_endtrap(trap$0);
	goto label$2388$9;
	label$2388$7:
	r6 = (String)global$963;
	r5 = r6;
	label$2388$9:
	r6 = String___add__(r6,r1);
	Sys_println(((vdynamic*)r6));
	r9 = (hxd__$System)global$409;
	r8 = r9->dismissErrors;
	if( !r8 ) goto label$2388$15;
	return;
	label$2388$15:
	r10 = (hl__WinLog)hl_alloc_obj(hl__WinLog__val);
	r6 = (String)global$964;
	r11 = 500;
	r12 = 400;
	hl_WinLog_new(r10,r6,r11,r12);
	r7 = (String)global$205;
	r6 = String___add__(r5,r7);
	r6 = String___add__(r6,r1);
	r13 = NULL;
	hl_WinLog_setTextContent(r10,r6,r13);
	r14 = (hl__Button)hl_alloc_obj(hl__Button__val);
	r6 = (String)global$965;
	hl_Button_new(r14,((hl__Window)r10),r6);
	r15 = &cl$3349;
	r14->onClick = r15;
	r14 = (hl__Button)hl_alloc_obj(hl__Button__val);
	r6 = (String)global$966;
	hl_Button_new(r14,((hl__Window)r10),r6);
	r15 = &cl$3350;
	r14->onClick = r15;
	r14 = (hl__Button)hl_alloc_obj(hl__Button__val);
	r6 = (String)global$967;
	hl_Button_new(r14,((hl__Window)r10),r6);
	r15 = &cl$3351;
	r14->onClick = r15;
	label$2388$40:
	r8 = true;
	r11 = ui_ui_loop(r8);
	r12 = 2;
	if( r11 == r12 ) goto label$2388$47;
	hxd_System_timeoutTick();
	goto label$2388$40;
	label$2388$47:
	if( r10 == NULL ) hl_null_access();
	hl_Window_destroy(((hl__Window)r10));
	return;
}

void hxd_System_runMainLoop() {
	bool r2;
	double r5;
	vclosure *r0, *r4;
	vdynamic *r3;
	int r6;
	hl_trap_ctx trap$0;
	r0 = &cl$3348;
	label$2387$1:
	r2 = true;
	if( !r2 ) goto label$2387$18;
	hl_trap(trap$0,r3,label$2387$13);
	hl_set_error_handler(r0);
	r5 = haxe_MainLoop_tick();
	r2 = hxd_System_mainLoop();
	if( r2 ) goto label$2387$11;
	hl_endtrap(trap$0);
	goto label$2387$18;
	label$2387$11:
	hl_endtrap(trap$0);
	goto label$2387$17;
	label$2387$13:
	r4 = NULL;
	hl_set_error_handler(r4);
	if( r0 == NULL ) hl_null_access();
	r0->hasValue ? ((void (*)(vdynamic*,vdynamic*))r0->fun)((vdynamic*)r0->value,r3) : ((void (*)(vdynamic*))r0->fun)(r3);
	label$2387$17:
	goto label$2387$1;
	label$2387$18:
	r6 = 0;
	hl_sys_exit(r6);
	return;
}

void hxd_System_start(vclosure* r0) {
	String r3;
	haxe__Timer r8;
	hxd__$Window r6;
	hxd__Window r2;
	vclosure *r7;
	int r4, r5;
	hxd_System_timeoutTick();
	r2 = (hxd__Window)hl_alloc_obj(hxd__Window__val);
	r3 = (String)global$8;
	r4 = 800;
	r5 = 600;
	hxd_Window_new(r2,r3,r4,r5);
	r6 = (hxd__$Window)global$36;
	r6->inst = r2;
	if( r0 == NULL ) hl_null_access();
	r0->hasValue ? ((void (*)(vdynamic*))r0->fun)((vdynamic*)r0->value) : ((void (*)(void))r0->fun)();
	hxd_System_timeoutTick();
	r7 = &cl$2387;
	r4 = 0;
	r8 = haxe_Timer_delay(r7,r4);
	return;
}

bool hxd_System_mainLoop() {
	bool r1;
	hxd__$Window r4;
	h3d__Engine r7;
	hxd__Window r3;
	h3d__$Engine r8;
	hxd__$System r6;
	vclosure *r2, *r5;
	h3d__impl__Driver r9;
	r4 = (hxd__$Window)global$36;
	r3 = r4->inst;
	if( r3 == NULL ) hl_null_access();
	r2 = hl_alloc_closure_ptr(&type$3317,hxd_Window_onEvent,r3);
	r1 = dx_Loop_processEvents(r2);
	if( r1 ) goto label$2386$8;
	r1 = false;
	return r1;
	label$2386$8:
	hxd_System_timeoutTick();
	r6 = (hxd__$System)global$409;
	r5 = r6->loopFunc;
	if( !r5 ) goto label$2386$16;
	r6 = (hxd__$System)global$409;
	r5 = r6->loopFunc;
	if( r5 == NULL ) hl_null_access();
	r5->hasValue ? ((void (*)(vdynamic*))r5->fun)((vdynamic*)r5->value) : ((void (*)(void))r5->fun)();
	label$2386$16:
	r8 = (h3d__$Engine)global$38;
	r7 = r8->CURRENT;
	if( !r7 ) goto label$2386$25;
	if( r7 == NULL ) hl_null_access();
	r1 = r7->ready;
	if( !r1 ) goto label$2386$25;
	r9 = r7->driver;
	if( r9 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver))r9->$type->vobj_proto[27])(r9);
	label$2386$25:
	r1 = true;
	return r1;
}

void hxd_System_setLoop(vclosure* r0) {
	hxd__$System r1;
	r1 = (hxd__$System)global$409;
	r1->loopFunc = r0;
	return;
}

vclosure* hxd_System_getCurrentLoop() {
	hxd__$System r1;
	vclosure *r0;
	r1 = (hxd__$System)global$409;
	r0 = r1->loopFunc;
	return r0;
}

