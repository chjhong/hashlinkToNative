// Generated by HLC 4.0.0 (HL v4)
#include <hl/code.h>

void format_png_Writer_write(format__png__Writer r0,haxe__ds__List r1) {
	String r9;
	vvirtual *r11;
	venum *r8, *r14;
	bool r13;
	haxe__io__Bytes r10;
	haxe__io__BytesOutput r12;
	haxe__io__Output r3;
	vdynamic *r7;
	haxe__ds___List__ListNode r5, r6;
	int r4, r15;
	r3 = r0->o;
	if( r3 == NULL ) hl_null_access();
	r4 = 137;
	((void (*)(haxe__io__Output,int))r3->$type->vobj_proto[0])(r3,r4);
	r3 = r0->o;
	if( r3 == NULL ) hl_null_access();
	r4 = 80;
	((void (*)(haxe__io__Output,int))r3->$type->vobj_proto[0])(r3,r4);
	r3 = r0->o;
	if( r3 == NULL ) hl_null_access();
	r4 = 78;
	((void (*)(haxe__io__Output,int))r3->$type->vobj_proto[0])(r3,r4);
	r3 = r0->o;
	if( r3 == NULL ) hl_null_access();
	r4 = 71;
	((void (*)(haxe__io__Output,int))r3->$type->vobj_proto[0])(r3,r4);
	r3 = r0->o;
	if( r3 == NULL ) hl_null_access();
	r4 = 13;
	((void (*)(haxe__io__Output,int))r3->$type->vobj_proto[0])(r3,r4);
	r3 = r0->o;
	if( r3 == NULL ) hl_null_access();
	r4 = 10;
	((void (*)(haxe__io__Output,int))r3->$type->vobj_proto[0])(r3,r4);
	r3 = r0->o;
	if( r3 == NULL ) hl_null_access();
	r4 = 26;
	((void (*)(haxe__io__Output,int))r3->$type->vobj_proto[0])(r3,r4);
	r3 = r0->o;
	if( r3 == NULL ) hl_null_access();
	r4 = 10;
	((void (*)(haxe__io__Output,int))r3->$type->vobj_proto[0])(r3,r4);
	if( r1 == NULL ) hl_null_access();
	r5 = r1->h;
	label$2315$34:
	if( !r5 ) goto label$2315$110;
	if( r5 == NULL ) hl_null_access();
	r7 = r5->item;
	r8 = (venum*)r7;
	r6 = r5->next;
	r5 = r6;
	if( r8 == NULL ) hl_null_access();
	r4 = HL__ENUM_INDEX__(r8);
	switch(r4) {
		default:
			goto label$2315$109;
		case 0:
			r9 = (String)global$357;
			r4 = 0;
			r10 = haxe_io_Bytes_alloc(r4);
			format_png_Writer_writeChunk(r0,r9,r10);
			goto label$2315$109;
		case 1:
			r11 = ((format_png_Chunk_CHeader*)r8)->p0;
			r12 = (haxe__io__BytesOutput)hl_alloc_obj(haxe__io__BytesOutput__val);
			haxe_io_BytesOutput_new(r12);
			r13 = true;
			r13 = haxe_io_Output_set_bigEndian(((haxe__io__Output)r12),r13);
			if( r11 == NULL ) hl_null_access();
			r4 = hl_vfields(r11)[4] ? (*(int*)(hl_vfields(r11)[4])) : (int)hl_dyn_geti(r11->value,-362629759/*width*/,&type$3);
			haxe_io_Output_writeInt32(((haxe__io__Output)r12),r4);
			r4 = hl_vfields(r11)[2] ? (*(int*)(hl_vfields(r11)[2])) : (int)hl_dyn_geti(r11->value,38537191/*height*/,&type$3);
			haxe_io_Output_writeInt32(((haxe__io__Output)r12),r4);
			r4 = hl_vfields(r11)[0] ? (*(int*)(hl_vfields(r11)[0])) : (int)hl_dyn_geti(r11->value,-423126202/*colbits*/,&type$3);
			haxe_io_BytesOutput_writeByte(r12,r4);
			r14 = hl_vfields(r11)[1] ? (*(venum**)(hl_vfields(r11)[1])) : (venum*)hl_dyn_getp(r11->value,173830765/*color*/,&type$458);
			if( r14 == NULL ) hl_null_access();
			r4 = HL__ENUM_INDEX__(r14);
			switch(r4) {
				default:
					goto label$2315$83;
				case 0:
					r13 = ((format_png_Color_ColGrey*)r14)->p0;
					if( !r13 ) goto label$2315$71;
					r15 = 4;
					goto label$2315$72;
					label$2315$71:
					r15 = 0;
					label$2315$72:
					r4 = r15;
					goto label$2315$83;
				case 1:
					r13 = ((format_png_Color_ColTrue*)r14)->p0;
					if( !r13 ) goto label$2315$78;
					r15 = 6;
					goto label$2315$79;
					label$2315$78:
					r15 = 2;
					label$2315$79:
					r4 = r15;
					goto label$2315$83;
				case 2:
					r15 = 3;
					r4 = r15;
			}
			label$2315$83:
			haxe_io_BytesOutput_writeByte(r12,r4);
			r15 = 0;
			haxe_io_BytesOutput_writeByte(r12,r15);
			r15 = 0;
			haxe_io_BytesOutput_writeByte(r12,r15);
			r13 = hl_vfields(r11)[3] ? (*(bool*)(hl_vfields(r11)[3])) : (bool)hl_dyn_geti(r11->value,-109524212/*interlaced*/,&type$7);
			if( !r13 ) goto label$2315$92;
			r15 = 1;
			goto label$2315$93;
			label$2315$92:
			r15 = 0;
			label$2315$93:
			haxe_io_BytesOutput_writeByte(r12,r15);
			r9 = (String)global$358;
			r10 = haxe_io_BytesOutput_getBytes(r12);
			format_png_Writer_writeChunk(r0,r9,r10);
			goto label$2315$109;
		case 2:
			r9 = (String)global$359;
			r10 = ((format_png_Chunk_CData*)r8)->p0;
			format_png_Writer_writeChunk(r0,r9,r10);
			goto label$2315$109;
		case 3:
			r9 = (String)global$360;
			r10 = ((format_png_Chunk_CPalette*)r8)->p0;
			format_png_Writer_writeChunk(r0,r9,r10);
			goto label$2315$109;
		case 4:
			r9 = ((format_png_Chunk_CUnknown*)r8)->p0;
			r10 = ((format_png_Chunk_CUnknown*)r8)->p1;
			format_png_Writer_writeChunk(r0,r9,r10);
	}
	label$2315$109:
	goto label$2315$34;
	label$2315$110:
	return;
}

void format_png_Writer_writeChunk(format__png__Writer r0,String r1,haxe__io__Bytes r2) {
	haxe__crypto__Crc32 r7;
	venum *r6;
	haxe__io__Output r4;
	vdynamic *r8;
	int r5, r9;
	r4 = r0->o;
	if( r4 == NULL ) hl_null_access();
	if( r2 == NULL ) hl_null_access();
	r5 = r2->length;
	haxe_io_Output_writeInt32(r4,r5);
	r4 = r0->o;
	if( r4 == NULL ) hl_null_access();
	r6 = NULL;
	haxe_io_Output_writeString(r4,r1,r6);
	r4 = r0->o;
	if( r4 == NULL ) hl_null_access();
	haxe_io_Output_write(r4,r2);
	r7 = (haxe__crypto__Crc32)hl_alloc_obj(haxe__crypto__Crc32__val);
	haxe_crypto_Crc32_new(r7);
	if( r1 == NULL ) hl_null_access();
	r5 = 0;
	r8 = String_charCodeAt(r1,r5);
	r5 = r8 ? r8->v.i : 0;
	haxe_crypto_Crc32_byte(r7,r5);
	r5 = 1;
	r8 = String_charCodeAt(r1,r5);
	r5 = r8 ? r8->v.i : 0;
	haxe_crypto_Crc32_byte(r7,r5);
	r5 = 2;
	r8 = String_charCodeAt(r1,r5);
	r5 = r8 ? r8->v.i : 0;
	haxe_crypto_Crc32_byte(r7,r5);
	r5 = 3;
	r8 = String_charCodeAt(r1,r5);
	r5 = r8 ? r8->v.i : 0;
	haxe_crypto_Crc32_byte(r7,r5);
	r5 = 0;
	r9 = r2->length;
	haxe_crypto_Crc32_update(r7,r2,r5,r9);
	r4 = r0->o;
	if( r4 == NULL ) hl_null_access();
	r5 = haxe_crypto_Crc32_get(r7);
	haxe_io_Output_writeInt32(r4,r5);
	return;
}

void format_png_Writer_new(format__png__Writer r0,haxe__io__Output r1) {
	bool r2;
	r0->o = r1;
	if( r1 == NULL ) hl_null_access();
	r2 = true;
	r2 = haxe_io_Output_set_bigEndian(r1,r2);
	return;
}

