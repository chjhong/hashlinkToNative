// Generated by HLC 4.0.0 (HL v4)
#include <hl/code.h>

void format_mp3_Reader_skipID3v2(format__mp3__Reader r0) {
	haxe__io__Bytes r7;
	haxe__io__Input r2;
	int r1, r3, r5, r6;
	r2 = r0->i;
	if( r2 == NULL ) hl_null_access();
	r1 = haxe_io_Input_readUInt16(r2);
	r0->id3v2_version = r1;
	r2 = r0->i;
	if( r2 == NULL ) hl_null_access();
	r1 = ((int (*)(haxe__io__Input))r2->$type->vobj_proto[0])(r2);
	r0->id3v2_flags = r1;
	r2 = r0->i;
	if( r2 == NULL ) hl_null_access();
	r1 = ((int (*)(haxe__io__Input))r2->$type->vobj_proto[0])(r2);
	r3 = 127;
	r1 = r1 & r3;
	r5 = 7;
	r3 = r1 << r5;
	r2 = r0->i;
	if( r2 == NULL ) hl_null_access();
	r5 = ((int (*)(haxe__io__Input))r2->$type->vobj_proto[0])(r2);
	r6 = 127;
	r5 = r5 & r6;
	r3 = r3 | r5;
	r5 = 7;
	r3 = r3 << r5;
	r2 = r0->i;
	if( r2 == NULL ) hl_null_access();
	r5 = ((int (*)(haxe__io__Input))r2->$type->vobj_proto[0])(r2);
	r6 = 127;
	r5 = r5 & r6;
	r3 = r3 | r5;
	r5 = 7;
	r3 = r3 << r5;
	r2 = r0->i;
	if( r2 == NULL ) hl_null_access();
	r5 = ((int (*)(haxe__io__Input))r2->$type->vobj_proto[0])(r2);
	r6 = 127;
	r5 = r5 & r6;
	r3 = r3 | r5;
	r2 = r0->i;
	if( r2 == NULL ) hl_null_access();
	r7 = haxe_io_Input_read(r2,r3);
	r0->id3v2_data = r7;
	return;
}

venum* format_mp3_Reader_seekFrame(format__mp3__Reader r0) {
	venum *r8;
	bool r3;
	format__tools__BitsInput r7;
	haxe__io__Eof r10;
	haxe__io__$Eof r9;
	haxe__io__Input r5;
	vdynamic *r1;
	int r4, r6;
	hl_trap_ctx trap$0;
	hl_trap(trap$0,r1,label$2282$42);
	label$2282$1:
	r3 = true;
	if( !r3 ) goto label$2282$40;
	r5 = r0->i;
	if( r5 == NULL ) hl_null_access();
	r4 = ((int (*)(haxe__io__Input))r5->$type->vobj_proto[0])(r5);
	r3 = r0->any_read;
	if( r3 ) goto label$2282$24;
	r3 = true;
	r0->any_read = r3;
	r6 = 73;
	if( r4 != r6 ) goto label$2282$24;
	r5 = r0->i;
	if( r5 == NULL ) hl_null_access();
	r4 = ((int (*)(haxe__io__Input))r5->$type->vobj_proto[0])(r5);
	r6 = 68;
	if( r4 != r6 ) goto label$2282$24;
	r5 = r0->i;
	if( r5 == NULL ) hl_null_access();
	r4 = ((int (*)(haxe__io__Input))r5->$type->vobj_proto[0])(r5);
	r6 = 51;
	if( r4 != r6 ) goto label$2282$24;
	format_mp3_Reader_skipID3v2(r0);
	label$2282$24:
	r6 = 255;
	if( r4 != r6 ) goto label$2282$39;
	r7 = r0->bits;
	if( r7 == NULL ) hl_null_access();
	r4 = 0;
	r7->nbits = r4;
	r7 = r0->bits;
	if( r7 == NULL ) hl_null_access();
	r4 = 3;
	r4 = format_tools_BitsInput_readBits(r7,r4);
	r6 = 7;
	if( r4 != r6 ) goto label$2282$39;
	r8 = (venum*)global$332;
	hl_endtrap(trap$0);
	return r8;
	label$2282$39:
	goto label$2282$1;
	label$2282$40:
	hl_endtrap(trap$0);
	goto label$2282$49;
	label$2282$42:
	r9 = (haxe__io__$Eof)global$333;
	r3 = hl_BaseType_check(((hl__BaseType)r9),r1);
	if( !r3 ) goto label$2282$48;
	r10 = (haxe__io__Eof)r1;
	r8 = (venum*)global$334;
	return r8;
	label$2282$48:
	hl_rethrow((vdynamic*)r1);
	label$2282$49:
	r8 = NULL;
	return r8;
}

hl__types__ArrayObj format_mp3_Reader_readFrames(format__mp3__Reader r0) {
	vvirtual *r7;
	hl__types__ArrayObj r1;
	venum *r4, *r5;
	bool r3;
	int r6;
	r1 = (hl__types__ArrayObj)hl_alloc_obj(hl__types__ArrayObj__val);
	hl_types_ArrayObj_new(r1);
	label$2283$2:
	r3 = true;
	if( !r3 ) goto label$2283$19;
	r4 = format_mp3_Reader_seekFrame(r0);
	r5 = (venum*)global$334;
	if( r4 != r5 ) goto label$2283$9;
	goto label$2283$19;
	label$2283$9:
	if( r4 == NULL ) hl_null_access();
	r6 = HL__ENUM_INDEX__(r4);
	switch(r6) {
		default:
			goto label$2283$18;
		case 0:
			r7 = format_mp3_Reader_readFrame(r0);
			if( !r7 ) goto label$2283$17;
			if( r1 == NULL ) hl_null_access();
			r6 = hl_types_ArrayObj_push(r1,((vdynamic*)r7));
			label$2283$17:
			goto label$2283$18;
		case 1:
			break;
	}
	label$2283$18:
	goto label$2283$2;
	label$2283$19:
	return r1;
}

vvirtual* format_mp3_Reader_readFrameHeader(format__mp3__Reader r0) {
	format__mp3__$CLayer r8;
	vvirtual *r9;
	venum *r10, *r12, *r15, *r16, *r23, *r24, *r25, *r26;
	format__mp3__$MPEG r7;
	bool r4, r13, r14, r17, r18, r19, r20;
	format__tools__BitsInput r2;
	haxe__io__Input r22;
	int r1, r3, r5, r6, r11, r21;
	r2 = r0->bits;
	if( r2 == NULL ) hl_null_access();
	r1 = 2;
	r1 = format_tools_BitsInput_readBits(r2,r1);
	r2 = r0->bits;
	if( r2 == NULL ) hl_null_access();
	r3 = 2;
	r3 = format_tools_BitsInput_readBits(r2,r3);
	r2 = r0->bits;
	if( r2 == NULL ) hl_null_access();
	r4 = format_tools_BitsInput_readBit(r2);
	r4 = !r4;
	r7 = (format__mp3__$MPEG)global$271;
	r6 = r7->Reserved;
	if( r1 == r6 ) goto label$2284$18;
	r8 = (format__mp3__$CLayer)global$313;
	r6 = r8->LReserved;
	if( r3 != r6 ) goto label$2284$20;
	label$2284$18:
	r9 = NULL;
	return r9;
	label$2284$20:
	r2 = r0->bits;
	if( r2 == NULL ) hl_null_access();
	r11 = 4;
	r11 = format_tools_BitsInput_readBits(r2,r11);
	r10 = format_mp3_Tools_getBitrate(r1,r3,r11);
	r2 = r0->bits;
	if( r2 == NULL ) hl_null_access();
	r6 = 2;
	r6 = format_tools_BitsInput_readBits(r2,r6);
	r12 = format_mp3_Tools_getSamplingRate(r1,r6);
	r2 = r0->bits;
	if( r2 == NULL ) hl_null_access();
	r13 = format_tools_BitsInput_readBit(r2);
	r2 = r0->bits;
	if( r2 == NULL ) hl_null_access();
	r14 = format_tools_BitsInput_readBit(r2);
	r15 = (venum*)global$287;
	if( r10 == r15 ) goto label$2284$42;
	r15 = (venum*)global$288;
	if( r10 == r15 ) goto label$2284$42;
	r16 = (venum*)global$276;
	if( r12 != r16 ) goto label$2284$44;
	label$2284$42:
	r9 = NULL;
	return r9;
	label$2284$44:
	r2 = r0->bits;
	if( r2 == NULL ) hl_null_access();
	r5 = 2;
	r5 = format_tools_BitsInput_readBits(r2,r5);
	r2 = r0->bits;
	if( r2 == NULL ) hl_null_access();
	r17 = format_tools_BitsInput_readBit(r2);
	r2 = r0->bits;
	if( r2 == NULL ) hl_null_access();
	r18 = format_tools_BitsInput_readBit(r2);
	r2 = r0->bits;
	if( r2 == NULL ) hl_null_access();
	r19 = format_tools_BitsInput_readBit(r2);
	r2 = r0->bits;
	if( r2 == NULL ) hl_null_access();
	r20 = format_tools_BitsInput_readBit(r2);
	r2 = r0->bits;
	if( r2 == NULL ) hl_null_access();
	r6 = 2;
	r6 = format_tools_BitsInput_readBits(r2,r6);
	r11 = 0;
	if( !r4 ) goto label$2284$70;
	r22 = r0->i;
	if( r22 == NULL ) hl_null_access();
	r21 = haxe_io_Input_readUInt16(r22);
	r11 = r21;
	label$2284$70:
	r9 = hl_alloc_virtual(&type$930);
	r23 = format_mp3_MPEG_num2Enum(r1);
	if( hl_vfields(r9)[13] ) *(venum**)(hl_vfields(r9)[13]) = (venum*)r23; else hl_dyn_setp(r9->value,485615783/*version*/,&type$431,r23);
	r24 = format_mp3_CLayer_num2Enum(r3);
	if( hl_vfields(r9)[10] ) *(venum**)(hl_vfields(r9)[10]) = (venum*)r24; else hl_dyn_setp(r9->value,264274784/*layer*/,&type$438,r24);
	if( hl_vfields(r9)[4] ) *(bool*)(hl_vfields(r9)[4]) = (bool)r4; else hl_dyn_seti(r9->value,-80572784/*hasCrc*/,&type$7,r4);
	if( hl_vfields(r9)[2] ) *(int*)(hl_vfields(r9)[2]) = (int)r11; else hl_dyn_seti(r9->value,206638019/*crc16*/,&type$3,r11);
	if( hl_vfields(r9)[0] ) *(venum**)(hl_vfields(r9)[0]) = (venum*)r10; else hl_dyn_setp(r9->value,-53479891/*bitrate*/,&type$437,r10);
	if( hl_vfields(r9)[12] ) *(venum**)(hl_vfields(r9)[12]) = (venum*)r12; else hl_dyn_setp(r9->value,372418284/*samplingRate*/,&type$434,r12);
	if( hl_vfields(r9)[9] ) *(bool*)(hl_vfields(r9)[9]) = (bool)r13; else hl_dyn_seti(r9->value,480631391/*isPadded*/,&type$7,r13);
	if( hl_vfields(r9)[11] ) *(bool*)(hl_vfields(r9)[11]) = (bool)r14; else hl_dyn_seti(r9->value,-424081925/*privateBit*/,&type$7,r14);
	r25 = format_mp3_CChannelMode_num2Enum(r5);
	if( hl_vfields(r9)[1] ) *(venum**)(hl_vfields(r9)[1]) = (venum*)r25; else hl_dyn_setp(r9->value,405740998/*channelMode*/,&type$446,r25);
	if( hl_vfields(r9)[6] ) *(bool*)(hl_vfields(r9)[6]) = (bool)r17; else hl_dyn_seti(r9->value,-195324543/*isIntensityStereo*/,&type$7,r17);
	if( hl_vfields(r9)[7] ) *(bool*)(hl_vfields(r9)[7]) = (bool)r18; else hl_dyn_seti(r9->value,-304952423/*isMSStereo*/,&type$7,r18);
	if( hl_vfields(r9)[5] ) *(bool*)(hl_vfields(r9)[5]) = (bool)r19; else hl_dyn_seti(r9->value,-448022702/*isCopyrighted*/,&type$7,r19);
	if( hl_vfields(r9)[8] ) *(bool*)(hl_vfields(r9)[8]) = (bool)r20; else hl_dyn_seti(r9->value,462899045/*isOriginal*/,&type$7,r20);
	r26 = format_mp3_CEmphasis_num2Enum(r6);
	if( hl_vfields(r9)[3] ) *(venum**)(hl_vfields(r9)[3]) = (venum*)r26; else hl_dyn_setp(r9->value,262448705/*emphasis*/,&type$448,r26);
	return r9;
}

vvirtual* format_mp3_Reader_readFrame(format__mp3__Reader r0) {
	vvirtual *r1, *r3;
	haxe__io__Bytes r5;
	bool r2;
	haxe__io__Eof r10;
	haxe__io__$Eof r9;
	haxe__io__Input r6;
	vdynamic *r4;
	int r7, r8;
	hl_trap_ctx trap$0;
	r1 = format_mp3_Reader_readFrameHeader(r0);
	if( !r1 ) goto label$2285$4;
	r2 = format_mp3_Tools_isInvalidFrameHeader(r1);
	if( !r2 ) goto label$2285$6;
	label$2285$4:
	r3 = NULL;
	return r3;
	label$2285$6:
	hl_trap(trap$0,r4,label$2285$26);
	r6 = r0->i;
	if( r6 == NULL ) hl_null_access();
	r7 = format_mp3_Tools_getSampleDataSizeHdr(r1);
	r5 = haxe_io_Input_read(r6,r7);
	r7 = r0->samples;
	r8 = format_mp3_Tools_getSampleCountHdr(r1);
	r7 = r7 + r8;
	r0->samples = r7;
	r7 = r0->sampleSize;
	if( r5 == NULL ) hl_null_access();
	r8 = r5->length;
	r7 = r7 + r8;
	r0->sampleSize = r7;
	r3 = hl_alloc_virtual(&type$934);
	if( hl_vfields(r3)[1] ) *(vvirtual**)(hl_vfields(r3)[1]) = (vvirtual*)r1; else hl_dyn_setp(r3->value,-50329203/*header*/,&type$930,r1);
	if( hl_vfields(r3)[0] ) *(haxe__io__Bytes*)(hl_vfields(r3)[0]) = (haxe__io__Bytes)r5; else hl_dyn_setp(r3->value,40064820/*data*/,&type$75,r5);
	hl_endtrap(trap$0);
	return r3;
	hl_endtrap(trap$0);
	label$2285$26:
	r9 = (haxe__io__$Eof)global$333;
	r2 = hl_BaseType_check(((hl__BaseType)r9),r4);
	if( !r2 ) goto label$2285$32;
	r10 = (haxe__io__Eof)r4;
	r3 = NULL;
	return r3;
	label$2285$32:
	hl_rethrow((vdynamic*)r4);
}

vvirtual* format_mp3_Reader_read(format__mp3__Reader r0) {
	hl__types__ArrayObj r2;
	vvirtual *r1, *r4;
	haxe__io__Bytes r5;
	int r3;
	r1 = hl_alloc_virtual(&type$1427);
	r2 = format_mp3_Reader_readFrames(r0);
	if( hl_vfields(r1)[0] ) *(hl__types__ArrayObj*)(hl_vfields(r1)[0]) = (hl__types__ArrayObj)r2; else hl_dyn_setp(r1->value,-326783332/*frames*/,&type$46,r2);
	r3 = r0->samples;
	if( hl_vfields(r1)[2] ) *(int*)(hl_vfields(r1)[2]) = (int)r3; else hl_dyn_seti(r1->value,27753940/*sampleCount*/,&type$3,r3);
	r3 = r0->sampleSize;
	if( hl_vfields(r1)[3] ) *(int*)(hl_vfields(r1)[3]) = (int)r3; else hl_dyn_seti(r1->value,133925786/*sampleSize*/,&type$3,r3);
	r5 = r0->id3v2_data;
	if( r5 ) goto label$2286$11;
	r4 = NULL;
	goto label$2286$18;
	label$2286$11:
	r4 = hl_alloc_virtual(&type$1428);
	r3 = r0->id3v2_version;
	if( hl_vfields(r4)[2] ) *(int*)(hl_vfields(r4)[2]) = (int)r3; else hl_dyn_seti(r4->value,320789309/*versionBytes*/,&type$3,r3);
	r3 = r0->id3v2_flags;
	if( hl_vfields(r4)[1] ) *(int*)(hl_vfields(r4)[1]) = (int)r3; else hl_dyn_seti(r4->value,-133719227/*flagByte*/,&type$3,r3);
	r5 = r0->id3v2_data;
	if( hl_vfields(r4)[0] ) *(haxe__io__Bytes*)(hl_vfields(r4)[0]) = (haxe__io__Bytes)r5; else hl_dyn_setp(r4->value,40064820/*data*/,&type$75,r5);
	label$2286$18:
	if( hl_vfields(r1)[1] ) *(vvirtual**)(hl_vfields(r1)[1]) = (vvirtual*)r4; else hl_dyn_setp(r1->value,-145532950/*id3v2*/,&type$1428,r4);
	return r1;
}

void format_mp3_Reader_new(format__mp3__Reader r0,haxe__io__Input r1) {
	bool r2;
	format__tools__BitsInput r3;
	int r5;
	r0->i = r1;
	if( r1 == NULL ) hl_null_access();
	r2 = true;
	r2 = haxe_io_Input_set_bigEndian(r1,r2);
	r3 = (format__tools__BitsInput)hl_alloc_obj(format__tools__BitsInput__val);
	format_tools_BitsInput_new(r3,r1);
	r0->bits = r3;
	r5 = 0;
	r0->samples = r5;
	r5 = 0;
	r0->sampleSize = r5;
	r2 = false;
	r0->any_read = r2;
	return;
}

