// Generated by HLC 4.0.0 (HL v4)
#include <hl/code.h>

h3d__mat__Texture h3d_impl_TextureCache_get(h3d__impl__TextureCache r0,int* r1) {
	hl__types__ArrayObj r3;
	vdynamic *r6;
	varray *r7;
	h3d__mat__Texture r5;
	int r2, r4;
	if( r1 ) goto label$1002$3;
	r2 = 0;
	goto label$1002$4;
	label$1002$3:
	r2 = *r1;
	label$1002$4:
	r3 = r0->cache;
	if( r3 == NULL ) hl_null_access();
	r4 = r3->length;
	if( ((unsigned)r2) < ((unsigned)r4) ) goto label$1002$10;
	r5 = NULL;
	goto label$1002$13;
	label$1002$10:
	r7 = r3->array;
	r6 = ((vdynamic**)(r7 + 1))[r2];
	r5 = (h3d__mat__Texture)r6;
	label$1002$13:
	return r5;
}

h3d__mat__Texture h3d_impl_TextureCache_getNamed(h3d__impl__TextureCache r0,String r1) {
	String r5;
	hl__types__ArrayObj r6;
	vdynamic *r9;
	varray *r10;
	h3d__mat__Texture r8;
	int r2, r3, r4, r7;
	r2 = 0;
	r3 = r0->position;
	label$1003$2:
	if( r2 >= r3 ) goto label$1003$29;
	r4 = r2;
	++r2;
	r6 = r0->cache;
	if( r6 == NULL ) hl_null_access();
	r7 = r6->length;
	if( ((unsigned)r4) < ((unsigned)r7) ) goto label$1003$12;
	r8 = NULL;
	goto label$1003$15;
	label$1003$12:
	r10 = r6->array;
	r9 = ((vdynamic**)(r10 + 1))[r4];
	r8 = (h3d__mat__Texture)r9;
	label$1003$15:
	if( r8 == NULL ) hl_null_access();
	r5 = r8->name;
	if( r5 != r1 && (!r5 || !r1 || String___compare(r5,(vdynamic*)r1) != 0) ) goto label$1003$28;
	r6 = r0->cache;
	if( r6 == NULL ) hl_null_access();
	r7 = r6->length;
	if( ((unsigned)r4) < ((unsigned)r7) ) goto label$1003$24;
	r8 = NULL;
	goto label$1003$27;
	label$1003$24:
	r10 = r6->array;
	r9 = ((vdynamic**)(r10 + 1))[r4];
	r8 = (h3d__mat__Texture)r9;
	label$1003$27:
	return r8;
	label$1003$28:
	goto label$1003$2;
	label$1003$29:
	r8 = NULL;
	return r8;
}

void h3d_impl_TextureCache_set(h3d__impl__TextureCache r0,h3d__mat__Texture r1,int r2) {
	hl__types__ArrayObj r3;
	varray *r6;
	int r4;
	r3 = r0->cache;
	if( r3 == NULL ) hl_null_access();
	r4 = r3->length;
	if( ((unsigned)r2) < ((unsigned)r4) ) goto label$1004$5;
	hl_types_ArrayObj___expand(r3,r2);
	label$1004$5:
	r6 = r3->array;
	((h3d__mat__Texture*)(r6 + 1))[r2] = r1;
	return;
}

void h3d_impl_TextureCache_begin(h3d__impl__TextureCache r0) {
	hl__types__ArrayObj r2;
	vdynamic *r4;
	h3d__mat__Texture r5;
	int r1, r3;
	label$1005$0:
	r2 = r0->cache;
	if( r2 == NULL ) hl_null_access();
	r1 = r2->length;
	r3 = r0->position;
	if( r3 >= r1 ) goto label$1005$14;
	r2 = r0->cache;
	if( r2 == NULL ) hl_null_access();
	r4 = hl_types_ArrayObj_pop(r2);
	r5 = (h3d__mat__Texture)r4;
	if( !r5 ) goto label$1005$13;
	if( r5 == NULL ) hl_null_access();
	h3d_mat_Texture_dispose(r5);
	label$1005$13:
	goto label$1005$0;
	label$1005$14:
	r1 = 0;
	r0->position = r1;
	return;
}

h3d__mat__Texture h3d_impl_TextureCache_allocTarget(h3d__impl__TextureCache r0,String r1,int r2,int r3,bool* r4,venum* r5,hl__types__ArrayObj r6) {
	h3d__mat__DepthBuffer r23;
	vvirtual *r17, *r22;
	hl__types__ArrayObj r8;
	hl_type *r19;
	venum *r15, *r21;
	bool r7;
	vclosure *r18;
	vdynamic *r12;
	varray *r13;
	h3d__mat__Texture r11, r16;
	int r9, r10, r20;
	if( r4 ) goto label$1006$3;
	r7 = true;
	goto label$1006$4;
	label$1006$3:
	r7 = *r4;
	label$1006$4:
	r8 = r0->cache;
	if( r8 == NULL ) hl_null_access();
	r9 = r0->position;
	r10 = r8->length;
	if( ((unsigned)r9) < ((unsigned)r10) ) goto label$1006$11;
	r11 = NULL;
	goto label$1006$14;
	label$1006$11:
	r13 = r8->array;
	r12 = ((vdynamic**)(r13 + 1))[r9];
	r11 = (h3d__mat__Texture)r12;
	label$1006$14:
	if( r5 ) goto label$1006$17;
	r15 = r0->defaultFormat;
	r5 = r15;
	label$1006$17:
	if( !r11 ) goto label$1006$29;
	if( r11 == NULL ) hl_null_access();
	r17 = r11->_t;
	if( r17 ) goto label$1006$23;
	r18 = r11->realloc;
	if( !r18 ) goto label$1006$29;
	label$1006$23:
	r9 = r11->width;
	if( r9 != r2 ) goto label$1006$29;
	r9 = r11->height;
	if( r9 != r3 ) goto label$1006$29;
	r15 = r11->format;
	if( r15 == r5 ) goto label$1006$54;
	label$1006$29:
	if( !r11 ) goto label$1006$32;
	if( r11 == NULL ) hl_null_access();
	h3d_mat_Texture_dispose(r11);
	label$1006$32:
	r16 = (h3d__mat__Texture)hl_alloc_obj(h3d__mat__Texture__val);
	if( r6 ) goto label$1006$42;
	r19 = &type$497;
	r20 = 1;
	r13 = hl_alloc_array(r19,r20);
	r21 = (venum*)global$432;
	r20 = 0;
	((venum**)(r13 + 1))[r20] = r21;
	r8 = hl_types_ArrayObj_alloc(r13);
	goto label$1006$43;
	label$1006$42:
	r8 = r6;
	label$1006$43:
	r22 = NULL;
	h3d_mat_Texture_new(r16,r2,r3,r8,r5,r22);
	r11 = r16;
	r8 = r0->cache;
	if( r8 == NULL ) hl_null_access();
	r9 = r0->position;
	r10 = r8->length;
	if( ((unsigned)r9) < ((unsigned)r10) ) goto label$1006$52;
	hl_types_ArrayObj___expand(r8,r9);
	label$1006$52:
	r13 = r8->array;
	((h3d__mat__Texture*)(r13 + 1))[r9] = r16;
	label$1006$54:
	if( !r7 ) goto label$1006$57;
	r23 = r0->defaultDepthBuffer;
	goto label$1006$58;
	label$1006$57:
	r23 = NULL;
	label$1006$58:
	r11->depthBuffer = r23;
	h3d_mat_Texture_setName(r11,r1);
	r9 = r0->position;
	++r9;
	r0->position = r9;
	return r11;
}

h3d__mat__Texture h3d_impl_TextureCache_allocTargetScale(h3d__impl__TextureCache r0,String r1,double r2,bool* r3,venum* r4) {
	hl__types__ArrayObj r13;
	bool r5, r12;
	h3d__Engine r6;
	h3d__$Engine r7;
	double r10;
	int r9, r11;
	h3d__mat__Texture r8;
	if( r3 ) goto label$1007$3;
	r5 = true;
	goto label$1007$4;
	label$1007$3:
	r5 = *r3;
	label$1007$4:
	r7 = (h3d__$Engine)global$38;
	r6 = r7->CURRENT;
	if( r6 == NULL ) hl_null_access();
	r9 = r6->width;
	r10 = (double)r9;
	r10 = r10 * r2;
	r9 = hl_math_ceil(r10);
	r11 = r6->height;
	r10 = (double)r11;
	r10 = r10 * r2;
	r11 = hl_math_ceil(r10);
	r12 = r5;
	r3 = &r12;
	r13 = NULL;
	r8 = h3d_impl_TextureCache_allocTarget(r0,r1,r9,r11,r3,r4,r13);
	return r8;
}

void h3d_impl_TextureCache_dispose(h3d__impl__TextureCache r0) {
	hl__types__ArrayObj r3;
	hl_type *r9;
	vdynamic *r7;
	varray *r8;
	h3d__mat__Texture r6;
	int r1, r4, r5;
	r1 = 0;
	r3 = r0->cache;
	label$1008$2:
	if( r3 == NULL ) hl_null_access();
	r5 = r3->length;
	if( r1 >= r5 ) goto label$1008$18;
	r4 = r1;
	++r1;
	r5 = r3->length;
	if( ((unsigned)r4) < ((unsigned)r5) ) goto label$1008$12;
	r6 = NULL;
	goto label$1008$15;
	label$1008$12:
	r8 = r3->array;
	r7 = ((vdynamic**)(r8 + 1))[r4];
	r6 = (h3d__mat__Texture)r7;
	label$1008$15:
	if( r6 == NULL ) hl_null_access();
	h3d_mat_Texture_dispose(r6);
	goto label$1008$2;
	label$1008$18:
	r9 = &type$93;
	r1 = 0;
	r8 = hl_alloc_array(r9,r1);
	r3 = hl_types_ArrayObj_alloc(r8);
	r0->cache = r3;
	return;
}

void h3d_impl_TextureCache_new(h3d__impl__TextureCache r0,h3d__impl__RenderContext r1) {
	h3d__mat__DepthBuffer r8;
	hl__types__ArrayObj r3;
	venum *r6;
	hl_type *r5;
	h3d__mat__$Texture r7;
	varray *r4;
	int r2;
	r2 = 0;
	r0->position = r2;
	r0->ctx = r1;
	r5 = &type$93;
	r2 = 0;
	r4 = hl_alloc_array(r5,r2);
	r3 = hl_types_ArrayObj_alloc(r4);
	r0->cache = r3;
	r7 = (h3d__mat__$Texture)global$31;
	r6 = r7->nativeFormat;
	r0->defaultFormat = r6;
	r8 = h3d_mat_DepthBuffer_getDefault();
	r0->defaultDepthBuffer = r8;
	return;
}

