// Generated by HLC 4.0.0 (HL v4)
#include <hl/code.h>

void h3d_impl_MemoryManager_init(h3d__impl__MemoryManager r0) {
	hl__types__ArrayObj r1;
	r1 = (hl__types__ArrayObj)hl_alloc_obj(hl__types__ArrayObj__val);
	hl_types_ArrayObj_new(r1);
	r0->indexes = r1;
	r1 = (hl__types__ArrayObj)hl_alloc_obj(hl__types__ArrayObj__val);
	hl_types_ArrayObj_new(r1);
	r0->textures = r1;
	r1 = (hl__types__ArrayObj)hl_alloc_obj(hl__types__ArrayObj__val);
	hl_types_ArrayObj_new(r1);
	r0->buffers = r1;
	r1 = (hl__types__ArrayObj)hl_alloc_obj(hl__types__ArrayObj__val);
	hl_types_ArrayObj_new(r1);
	r0->depths = r1;
	h3d_impl_MemoryManager_initIndexes(r0);
	return;
}

void h3d_impl_MemoryManager_initIndexes(h3d__impl__MemoryManager r0) {
	hl__types__ArrayBytes_hl_UI16 r1, r6;
	unsigned short r7;
	int *r9, *r10;
	h3d__Indexes r8;
	int r3, r4, r5, r11;
	r1 = (hl__types__ArrayBytes_hl_UI16)hl_alloc_obj(hl__types__ArrayBytes_hl_UI16__val);
	hl_types_ArrayBytes_hl_UI16_new(r1);
	r3 = 0;
	label$354$3:
	r5 = 65533;
	if( r3 >= r5 ) goto label$354$12;
	if( r1 == NULL ) hl_null_access();
	r4 = r3;
	++r3;
	r7 = (int)r4;
	r4 = hl_types_ArrayBytes_hl_UI16_push(r1,r7);
	goto label$354$3;
	label$354$12:
	r9 = NULL;
	r10 = NULL;
	r8 = h3d_Indexes_alloc(r1,r9,r10);
	r0->triIndexes = r8;
	r6 = (hl__types__ArrayBytes_hl_UI16)hl_alloc_obj(hl__types__ArrayBytes_hl_UI16__val);
	hl_types_ArrayBytes_hl_UI16_new(r6);
	r3 = 0;
	label$354$19:
	r5 = 16383;
	if( r3 >= r5 ) goto label$354$50;
	r4 = r3;
	++r3;
	r5 = 2;
	r4 = r4 << r5;
	if( r6 == NULL ) hl_null_access();
	r7 = (int)r4;
	r5 = hl_types_ArrayBytes_hl_UI16_push(r6,r7);
	r11 = 1;
	r5 = r4 + r11;
	r7 = (int)r5;
	r5 = hl_types_ArrayBytes_hl_UI16_push(r6,r7);
	r11 = 2;
	r5 = r4 + r11;
	r7 = (int)r5;
	r5 = hl_types_ArrayBytes_hl_UI16_push(r6,r7);
	r11 = 2;
	r5 = r4 + r11;
	r7 = (int)r5;
	r5 = hl_types_ArrayBytes_hl_UI16_push(r6,r7);
	r11 = 1;
	r5 = r4 + r11;
	r7 = (int)r5;
	r5 = hl_types_ArrayBytes_hl_UI16_push(r6,r7);
	r11 = 3;
	r5 = r4 + r11;
	r7 = (int)r5;
	r5 = hl_types_ArrayBytes_hl_UI16_push(r6,r7);
	goto label$354$19;
	label$354$50:
	if( r6 == NULL ) hl_null_access();
	r3 = 65533;
	r7 = (int)r3;
	r3 = hl_types_ArrayBytes_hl_UI16_push(r6,r7);
	r9 = NULL;
	r10 = NULL;
	r8 = h3d_Indexes_alloc(r6,r9,r10);
	r0->quadIndexes = r8;
	return;
}

void h3d_impl_MemoryManager_cleanManagedBuffers(h3d__impl__MemoryManager r0) {
	hl__types__ArrayObj r4;
	h3d__impl___ManagedBuffer__FreeCell r13;
	vdynamic *r9;
	varray *r10;
	h3d__impl__ManagedBuffer r8, r11, r12, r14;
	int r1, r3, r5, r6, r7;
	r1 = 1;
	r4 = r0->buffers;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->length;
	label$356$4:
	if( r1 >= r3 ) goto label$356$46;
	r5 = r1;
	++r1;
	r4 = r0->buffers;
	if( r4 == NULL ) hl_null_access();
	r7 = r4->length;
	if( ((unsigned)r5) < ((unsigned)r7) ) goto label$356$14;
	r8 = NULL;
	goto label$356$17;
	label$356$14:
	r10 = r4->array;
	r9 = ((vdynamic**)(r10 + 1))[r5];
	r8 = (h3d__impl__ManagedBuffer)r9;
	label$356$17:
	r11 = NULL;
	label$356$18:
	if( !r8 ) goto label$356$45;
	if( r8 == NULL ) hl_null_access();
	r13 = r8->freeList;
	if( r13 == NULL ) hl_null_access();
	r6 = r13->count;
	r7 = r8->size;
	if( r6 != r7 ) goto label$356$41;
	h3d_impl_ManagedBuffer_dispose(r8);
	if( r11 ) goto label$356$37;
	r4 = r0->buffers;
	if( r4 == NULL ) hl_null_access();
	r12 = r8->next;
	r7 = r4->length;
	if( ((unsigned)r5) < ((unsigned)r7) ) goto label$356$34;
	hl_types_ArrayObj___expand(r4,r5);
	label$356$34:
	r10 = r4->array;
	((h3d__impl__ManagedBuffer*)(r10 + 1))[r5] = r12;
	goto label$356$40;
	label$356$37:
	if( r11 == NULL ) hl_null_access();
	r14 = r8->next;
	r11->next = r14;
	label$356$40:
	goto label$356$42;
	label$356$41:
	r11 = r8;
	label$356$42:
	r12 = r8->next;
	r8 = r12;
	goto label$356$18;
	label$356$45:
	goto label$356$4;
	label$356$46:
	return;
}

void h3d_impl_MemoryManager_allocManaged(h3d__impl__MemoryManager r0,h3d__impl__ManagedBuffer r1) {
	String r13, r16;
	vvirtual *r3;
	bool r10;
	vclosure *r11;
	double r7, r8, r12;
	int *r14;
	h3d__impl__Driver r9;
	vbyte *r15;
	int r4, r5, r6;
	if( r1 == NULL ) hl_null_access();
	r3 = r1->vbuf;
	if( !r3 ) goto label$357$4;
	return;
	label$357$4:
	r4 = r1->size;
	r5 = r1->stride;
	r4 = r4 * r5;
	r5 = 4;
	r4 = r4 * r5;
	r6 = 0;
	if( r4 != r6 ) goto label$357$12;
	return;
	label$357$12:
	r7 = r0->usedMemory;
	r8 = (double)r4;
	r7 = r7 + r8;
	r8 = 4294967296.;
	if( r8 < r7 ) goto label$357$27;
	r5 = r0->bufferCount;
	r6 = 65536;
	if( r5 >= r6 ) goto label$357$27;
	if( r1 == NULL ) hl_null_access();
	r9 = r0->driver;
	if( r9 == NULL ) hl_null_access();
	r3 = ((vvirtual* (*)(h3d__impl__Driver,h3d__impl__ManagedBuffer))r9->$type->vobj_proto[30])(r9,r1);
	r1->vbuf = r3;
	if( r3 ) goto label$357$70;
	label$357$27:
	r9 = r0->driver;
	if( r9 == NULL ) hl_null_access();
	r10 = ((bool (*)(h3d__impl__Driver))r9->$type->vobj_proto[2])(r9);
	if( !r10 ) goto label$357$32;
	return;
	label$357$32:
	r7 = r0->usedMemory;
	r5 = h3d_impl_MemoryManager_freeMemorySize(r0);
	r8 = (double)r5;
	r7 = r7 - r8;
	r11 = r0->garbage;
	if( r11 == NULL ) hl_null_access();
	r11->hasValue ? ((void (*)(vdynamic*))r11->fun)((vdynamic*)r11->value) : ((void (*)(void))r11->fun)();
	h3d_impl_MemoryManager_cleanManagedBuffers(r0);
	r8 = r0->usedMemory;
	r5 = h3d_impl_MemoryManager_freeMemorySize(r0);
	r12 = (double)r5;
	r8 = r8 - r12;
	if( r8 != r7 ) goto label$357$69;
	r5 = r0->bufferCount;
	r6 = 65536;
	if( r5 < r6 ) goto label$357$50;
	r13 = (String)global$545;
	hl_throw((vdynamic*)r13);
	label$357$50:
	r13 = (String)global$546;
	r5 = 1024;
	r12 = (double)r5;
	r8 = r7 / r12;
	r8 = hl_math_fceil(r8);
	r14 = &r5;
	r15 = hl_ftos(r8,r14);
	r16 = String___alloc__(r15,r5);
	r13 = String___add__(r13,r16);
	r16 = (String)global$547;
	r13 = String___add__(r13,r16);
	r5 = r0->bufferCount;
	r14 = &r5;
	r15 = hl_itos(r5,r14);
	r16 = String___alloc__(r15,r5);
	r13 = String___add__(r13,r16);
	r16 = (String)global$548;
	r13 = String___add__(r13,r16);
	hl_throw((vdynamic*)r13);
	label$357$69:
	goto label$357$12;
	label$357$70:
	r7 = r0->usedMemory;
	r8 = (double)r4;
	r7 = r7 + r8;
	r0->usedMemory = r7;
	r5 = r0->bufferCount;
	++r5;
	r0->bufferCount = r5;
	return;
}

void h3d_impl_MemoryManager_freeManaged(h3d__impl__MemoryManager r0,h3d__impl__ManagedBuffer r1) {
	vvirtual *r3;
	double r5, r8;
	h3d__impl__Driver r4;
	int r6, r7;
	if( r1 == NULL ) hl_null_access();
	r3 = r1->vbuf;
	if( r3 ) goto label$358$4;
	return;
	label$358$4:
	r4 = r0->driver;
	if( r4 == NULL ) hl_null_access();
	r3 = r1->vbuf;
	((void (*)(h3d__impl__Driver,vvirtual*))r4->$type->vobj_proto[34])(r4,r3);
	r3 = NULL;
	r1->vbuf = r3;
	r5 = r0->usedMemory;
	r6 = r1->size;
	r7 = r1->stride;
	r6 = r6 * r7;
	r7 = 4;
	r6 = r6 * r7;
	r8 = (double)r6;
	r5 = r5 - r8;
	r0->usedMemory = r5;
	r6 = r0->bufferCount;
	--r6;
	r0->bufferCount = r6;
	return;
}

void h3d_impl_MemoryManager_allocBuffer(h3d__impl__MemoryManager r0,h3d__Buffer r1,int r2) {
	String r8, r11;
	vvirtual *r24;
	hl__types__ArrayObj r14, r17;
	venum *r21;
	hl_type *r16;
	bool r25;
	h3d__impl__$MemoryManager r18;
	h3d__Buffer r4, r13, r23;
	vdynamic *r12;
	int *r9;
	h3d__impl__ManagedBuffer r26, r27, r28;
	varray *r15;
	vbyte *r10;
	int r3, r5, r7, r19, r20, r22, r29, r30;
	if( r1 == NULL ) hl_null_access();
	r3 = r1->flags;
	r5 = 4;
	r3 = r3 & r5;
	r5 = 0;
	if( r3 == r5 ) goto label$359$8;
	r3 = 65532;
	goto label$359$16;
	label$359$8:
	r3 = r1->flags;
	r5 = 2;
	r3 = r3 & r5;
	r5 = 0;
	if( r3 == r5 ) goto label$359$15;
	r3 = 65533;
	goto label$359$16;
	label$359$15:
	r3 = 65534;
	label$359$16:
	r5 = r1->vertices;
	if( r3 >= r5 ) goto label$359$78;
	r7 = 65534;
	if( r3 != r7 ) goto label$359$29;
	r8 = (String)global$549;
	r5 = r1->vertices;
	r9 = &r5;
	r10 = hl_itos(r5,r9);
	r11 = String___alloc__(r10,r5);
	r8 = String___add__(r8,r11);
	r11 = (String)global$550;
	r8 = String___add__(r8,r11);
	hl_throw((vdynamic*)r8);
	label$359$29:
	r5 = r1->vertices;
	r5 = r5 - r3;
	r1->vertices = r3;
	h3d_impl_MemoryManager_allocBuffer(r0,r1,r2);
	r4 = r1;
	label$359$34:
	if( r4 == NULL ) hl_null_access();
	r13 = r4->next;
	if( !r13 ) goto label$359$41;
	r13 = r4->next;
	r4 = r13;
	goto label$359$34;
	label$359$41:
	r16 = &type$496;
	r7 = 0;
	r15 = hl_alloc_array(r16,r7);
	r14 = hl_types_ArrayObj_alloc(r15);
	r7 = 0;
	r18 = (h3d__impl__$MemoryManager)global$25;
	r17 = r18->ALL_FLAGS;
	label$359$48:
	if( r17 == NULL ) hl_null_access();
	r20 = r17->length;
	if( r7 >= r20 ) goto label$359$72;
	r20 = r17->length;
	if( ((unsigned)r7) < ((unsigned)r20) ) goto label$359$56;
	r21 = NULL;
	goto label$359$59;
	label$359$56:
	r15 = r17->array;
	r12 = ((vdynamic**)(r15 + 1))[r7];
	r21 = (venum*)r12;
	label$359$59:
	++r7;
	if( r1 == NULL ) hl_null_access();
	r19 = r1->flags;
	r20 = 1;
	if( r21 == NULL ) hl_null_access();
	r22 = HL__ENUM_INDEX__(r21);
	r20 = r20 << r22;
	r19 = r19 & r20;
	r20 = 0;
	if( r19 == r20 ) goto label$359$71;
	if( r14 == NULL ) hl_null_access();
	r19 = hl_types_ArrayObj_push(r14,((vdynamic*)r21));
	label$359$71:
	goto label$359$48;
	label$359$72:
	if( r4 == NULL ) hl_null_access();
	r23 = (h3d__Buffer)hl_alloc_obj(h3d__Buffer__val);
	r24 = NULL;
	h3d_Buffer_new(r23,r5,r2,r14,r24);
	r4->next = r23;
	return;
	label$359$78:
	r5 = r1->flags;
	r7 = 8;
	r5 = r5 & r7;
	r7 = 0;
	if( r5 != r7 ) goto label$359$119;
	r14 = NULL;
	r5 = r1->flags;
	r7 = 1;
	r5 = r5 & r7;
	r7 = 0;
	if( r5 == r7 ) goto label$359$97;
	r16 = &type$496;
	r5 = 0;
	r15 = hl_alloc_array(r16,r5);
	r17 = hl_types_ArrayObj_alloc(r15);
	r14 = r17;
	if( r17 == NULL ) hl_null_access();
	r21 = (venum*)global$424;
	r5 = hl_types_ArrayObj_push(r17,((vdynamic*)r21));
	label$359$97:
	r5 = r1->flags;
	r7 = 64;
	r5 = r5 & r7;
	r7 = 0;
	if( r5 == r7 ) goto label$359$111;
	if( r14 ) goto label$359$108;
	r16 = &type$496;
	r5 = 0;
	r15 = hl_alloc_array(r16,r5);
	r17 = hl_types_ArrayObj_alloc(r15);
	r14 = r17;
	label$359$108:
	if( r14 == NULL ) hl_null_access();
	r21 = (venum*)global$551;
	r5 = hl_types_ArrayObj_push(r14,((vdynamic*)r21));
	label$359$111:
	r26 = (h3d__impl__ManagedBuffer)hl_alloc_obj(h3d__impl__ManagedBuffer__val);
	r7 = r1->vertices;
	h3d_impl_ManagedBuffer_new(r26,r2,r7,r14);
	r25 = h3d_impl_ManagedBuffer_allocBuffer(r26,r1);
	if( r25 ) goto label$359$118;
	r8 = (String)global$319;
	hl_throw((vdynamic*)r8);
	label$359$118:
	return;
	label$359$119:
	r14 = r0->buffers;
	if( r14 == NULL ) hl_null_access();
	r7 = r14->length;
	if( ((unsigned)r2) < ((unsigned)r7) ) goto label$359$125;
	r26 = NULL;
	goto label$359$128;
	label$359$125:
	r15 = r14->array;
	r12 = ((vdynamic**)(r15 + 1))[r2];
	r26 = (h3d__impl__ManagedBuffer)r12;
	label$359$128:
	r27 = NULL;
	label$359$129:
	if( !r26 ) goto label$359$139;
	if( r26 == NULL ) hl_null_access();
	r25 = h3d_impl_ManagedBuffer_allocBuffer(r26,r1);
	if( !r25 ) goto label$359$135;
	return;
	label$359$135:
	r27 = r26;
	r28 = r26->next;
	r26 = r28;
	goto label$359$129;
	label$359$139:
	if( r1 == NULL ) hl_null_access();
	r5 = r1->flags;
	r7 = 2;
	r5 = r5 & r7;
	r7 = 0;
	if( r5 == r7 ) goto label$359$147;
	r5 = 3;
	goto label$359$155;
	label$359$147:
	r5 = r1->flags;
	r7 = 4;
	r5 = r5 & r7;
	r7 = 0;
	if( r5 == r7 ) goto label$359$154;
	r5 = 4;
	goto label$359$155;
	label$359$154:
	r5 = 0;
	label$359$155:
	if( r26 ) goto label$359$229;
	r19 = 0;
	if( r19 >= r5 ) goto label$359$229;
	r7 = r1->vertices;
	r19 = r7;
	label$359$160:
	r22 = 2048;
	if( r22 >= r19 ) goto label$359$227;
	r14 = r0->buffers;
	if( r14 == NULL ) hl_null_access();
	r22 = r14->length;
	if( ((unsigned)r2) < ((unsigned)r22) ) goto label$359$169;
	r28 = NULL;
	goto label$359$172;
	label$359$169:
	r15 = r14->array;
	r12 = ((vdynamic**)(r15 + 1))[r2];
	r28 = (h3d__impl__ManagedBuffer)r12;
	label$359$172:
	r26 = r28;
	r22 = 1;
	r20 = r19 >> r22;
	r22 = r5 == 0 ? 0 : r20 % r5;
	r20 = r20 - r22;
	r19 = r20;
	if( r1 == NULL ) hl_null_access();
	r1->vertices = r20;
	label$359$180:
	if( !r26 ) goto label$359$226;
	if( r26 == NULL ) hl_null_access();
	r25 = h3d_impl_ManagedBuffer_allocBuffer(r26,r1);
	if( !r25 ) goto label$359$223;
	r16 = &type$496;
	r20 = 0;
	r15 = hl_alloc_array(r16,r20);
	r14 = hl_types_ArrayObj_alloc(r15);
	r20 = 0;
	r18 = (h3d__impl__$MemoryManager)global$25;
	r17 = r18->ALL_FLAGS;
	label$359$192:
	if( r17 == NULL ) hl_null_access();
	r29 = r17->length;
	if( r20 >= r29 ) goto label$359$216;
	r29 = r17->length;
	if( ((unsigned)r20) < ((unsigned)r29) ) goto label$359$200;
	r21 = NULL;
	goto label$359$203;
	label$359$200:
	r15 = r17->array;
	r12 = ((vdynamic**)(r15 + 1))[r20];
	r21 = (venum*)r12;
	label$359$203:
	++r20;
	if( r1 == NULL ) hl_null_access();
	r22 = r1->flags;
	r29 = 1;
	if( r21 == NULL ) hl_null_access();
	r30 = HL__ENUM_INDEX__(r21);
	r29 = r29 << r30;
	r22 = r22 & r29;
	r29 = 0;
	if( r22 == r29 ) goto label$359$215;
	if( r14 == NULL ) hl_null_access();
	r22 = hl_types_ArrayObj_push(r14,((vdynamic*)r21));
	label$359$215:
	goto label$359$192;
	label$359$216:
	if( r1 == NULL ) hl_null_access();
	r13 = (h3d__Buffer)hl_alloc_obj(h3d__Buffer__val);
	r20 = r7 - r19;
	r24 = NULL;
	h3d_Buffer_new(r13,r20,r2,r14,r24);
	r1->next = r13;
	return;
	label$359$223:
	r28 = r26->next;
	r26 = r28;
	goto label$359$180;
	label$359$226:
	goto label$359$160;
	label$359$227:
	if( r1 == NULL ) hl_null_access();
	r1->vertices = r7;
	label$359$229:
	r28 = (h3d__impl__ManagedBuffer)hl_alloc_obj(h3d__impl__ManagedBuffer__val);
	r19 = 65533;
	r16 = &type$496;
	r20 = 1;
	r15 = hl_alloc_array(r16,r20);
	r21 = (venum*)global$552;
	r20 = 0;
	((venum**)(r15 + 1))[r20] = r21;
	r14 = hl_types_ArrayObj_alloc(r15);
	h3d_impl_ManagedBuffer_new(r28,r2,r19,r14);
	r26 = r28;
	if( r27 ) goto label$359$249;
	r14 = r0->buffers;
	if( r14 == NULL ) hl_null_access();
	r19 = r14->length;
	if( ((unsigned)r2) < ((unsigned)r19) ) goto label$359$246;
	hl_types_ArrayObj___expand(r14,r2);
	label$359$246:
	r15 = r14->array;
	((h3d__impl__ManagedBuffer*)(r15 + 1))[r2] = r26;
	goto label$359$251;
	label$359$249:
	if( r27 == NULL ) hl_null_access();
	r27->next = r26;
	label$359$251:
	r25 = h3d_impl_ManagedBuffer_allocBuffer(r26,r1);
	if( r25 ) goto label$359$255;
	r8 = (String)global$319;
	hl_throw((vdynamic*)r8);
	label$359$255:
	return;
}

void h3d_impl_MemoryManager_deleteIndexes(h3d__impl__MemoryManager r0,h3d__Indexes r1) {
	vvirtual *r6;
	hl__types__ArrayObj r3;
	bool r2;
	double r7, r10;
	h3d__impl__Driver r5;
	int r8, r9;
	r3 = r0->indexes;
	if( r3 == NULL ) hl_null_access();
	r2 = hl_types_ArrayObj_remove(r3,((vdynamic*)r1));
	r5 = r0->driver;
	if( r5 == NULL ) hl_null_access();
	if( r1 == NULL ) hl_null_access();
	r6 = r1->ibuf;
	((void (*)(h3d__impl__Driver,vvirtual*))r5->$type->vobj_proto[33])(r5,r6);
	r6 = NULL;
	r1->ibuf = r6;
	r7 = r0->usedMemory;
	r8 = r1->count;
	r2 = r1->is32;
	if( !r2 ) goto label$360$16;
	r9 = 4;
	goto label$360$17;
	label$360$16:
	r9 = 2;
	label$360$17:
	r8 = r8 * r9;
	r10 = (double)r8;
	r7 = r7 - r10;
	r0->usedMemory = r7;
	return;
}

void h3d_impl_MemoryManager_allocIndexes(h3d__impl__MemoryManager r0,h3d__Indexes r1) {
	hl__types__ArrayObj r6;
	vvirtual *r2;
	bool r5;
	double r7, r9;
	h3d__impl__Driver r3;
	int r4, r8;
	if( r1 == NULL ) hl_null_access();
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	r4 = r1->count;
	r5 = r1->is32;
	r2 = ((vvirtual* (*)(h3d__impl__Driver,int,bool))r3->$type->vobj_proto[29])(r3,r4,r5);
	r1->ibuf = r2;
	r6 = r0->indexes;
	if( r6 == NULL ) hl_null_access();
	r4 = hl_types_ArrayObj_push(r6,((vdynamic*)r1));
	r7 = r0->usedMemory;
	r4 = r1->count;
	r5 = r1->is32;
	if( !r5 ) goto label$361$16;
	r8 = 4;
	goto label$361$17;
	label$361$16:
	r8 = 2;
	label$361$17:
	r4 = r4 * r8;
	r9 = (double)r4;
	r7 = r7 + r9;
	r0->usedMemory = r7;
	return;
}

int h3d_impl_MemoryManager_bpp(h3d__impl__MemoryManager r0,h3d__mat__Texture r1) {
	int r2;
	r2 = 4;
	return r2;
}

bool h3d_impl_MemoryManager_cleanTextures(h3d__impl__MemoryManager r0,bool* r1) {
	hl__types__ArrayObj r4;
	bool r2, r14;
	hxd__$Timer r15;
	vclosure *r5, *r6, *r13;
	vdynamic *r11;
	varray *r12;
	h3d__mat__Texture r10;
	int r7, r8, r9, r16;
	if( r1 ) goto label$363$3;
	r2 = true;
	goto label$363$4;
	label$363$3:
	r2 = *r1;
	label$363$4:
	r4 = r0->textures;
	if( r4 == NULL ) hl_null_access();
	r5 = hl_alloc_closure_ptr(&type$2182,h3d_impl_MemoryManager_sortByLRU,r0);
	if( r5 ) goto label$363$10;
	r6 = NULL;
	goto label$363$11;
	label$363$10:
	r6 = hl_alloc_closure_ptr(&type$2179,fun$2691,r5);
	label$363$11:
	hl_types_ArrayObj_sort(r4,r6);
	r7 = 0;
	r4 = r0->textures;
	label$363$14:
	if( r4 == NULL ) hl_null_access();
	r9 = r4->length;
	if( r7 >= r9 ) goto label$363$41;
	r9 = r4->length;
	if( ((unsigned)r7) < ((unsigned)r9) ) goto label$363$22;
	r10 = NULL;
	goto label$363$25;
	label$363$22:
	r12 = r4->array;
	r11 = ((vdynamic**)(r12 + 1))[r7];
	r10 = (h3d__mat__Texture)r11;
	label$363$25:
	++r7;
	if( r10 == NULL ) hl_null_access();
	r13 = r10->realloc;
	if( r13 ) goto label$363$30;
	goto label$363$14;
	label$363$30:
	if( r2 ) goto label$363$37;
	r8 = r10->lastFrame;
	r15 = (hxd__$Timer)global$146;
	r9 = r15->frameCount;
	r16 = 3600;
	r9 = r9 - r16;
	if( r8 >= r9 ) goto label$363$40;
	label$363$37:
	h3d_mat_Texture_dispose(r10);
	r14 = true;
	return r14;
	label$363$40:
	goto label$363$14;
	label$363$41:
	r14 = false;
	return r14;
}

int h3d_impl_MemoryManager_sortByLRU(h3d__impl__MemoryManager r0,h3d__mat__Texture r1,h3d__mat__Texture r2) {
	int r3, r4;
	if( r1 == NULL ) hl_null_access();
	r3 = r1->lastFrame;
	if( r2 == NULL ) hl_null_access();
	r4 = r2->lastFrame;
	r3 = r3 - r4;
	return r3;
}

void h3d_impl_MemoryManager_deleteTexture(h3d__impl__MemoryManager r0,h3d__mat__Texture r1) {
	hl__types__ArrayObj r4;
	bool r3;
	double r6, r9;
	h3d__impl__Driver r5;
	int r7, r8;
	r4 = r0->textures;
	if( r4 == NULL ) hl_null_access();
	r3 = hl_types_ArrayObj_remove(r4,((vdynamic*)r1));
	if( r3 ) goto label$365$5;
	return;
	label$365$5:
	r5 = r0->driver;
	if( r5 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,h3d__mat__Texture))r5->$type->vobj_proto[32])(r5,r1);
	r6 = r0->texMemory;
	if( r1 == NULL ) hl_null_access();
	r7 = r1->width;
	r8 = r1->height;
	r7 = r7 * r8;
	r8 = h3d_impl_MemoryManager_bpp(r0,r1);
	r7 = r7 * r8;
	r9 = (double)r7;
	r6 = r6 - r9;
	r0->texMemory = r6;
	return;
}

void h3d_impl_MemoryManager_allocTexture(h3d__impl__MemoryManager r0,h3d__mat__Texture r1) {
	String r8;
	bool *r3;
	hl__types__ArrayObj r10;
	vvirtual *r4;
	bool r2, r7;
	double r11, r13;
	h3d__impl__Driver r5;
	int r9, r12;
	r2 = false;
	r3 = &r2;
	r2 = h3d_impl_MemoryManager_cleanTextures(r0,r3);
	if( r1 == NULL ) hl_null_access();
	r5 = r0->driver;
	if( r5 == NULL ) hl_null_access();
	r4 = ((vvirtual* (*)(h3d__impl__Driver,h3d__mat__Texture))r5->$type->vobj_proto[28])(r5,r1);
	r1->_t = r4;
	r4 = r1->_t;
	if( r4 ) goto label$366$23;
	r5 = r0->driver;
	if( r5 == NULL ) hl_null_access();
	r7 = ((bool (*)(h3d__impl__Driver))r5->$type->vobj_proto[2])(r5);
	if( !r7 ) goto label$366$15;
	return;
	label$366$15:
	r7 = true;
	r3 = &r7;
	r7 = h3d_impl_MemoryManager_cleanTextures(r0,r3);
	if( r7 ) goto label$366$21;
	r8 = (String)global$553;
	hl_throw((vdynamic*)r8);
	label$366$21:
	h3d_impl_MemoryManager_allocTexture(r0,r1);
	return;
	label$366$23:
	r10 = r0->textures;
	if( r10 == NULL ) hl_null_access();
	r9 = hl_types_ArrayObj_push(r10,((vdynamic*)r1));
	r11 = r0->texMemory;
	r9 = r1->width;
	r12 = r1->height;
	r9 = r9 * r12;
	r12 = h3d_impl_MemoryManager_bpp(r0,r1);
	r9 = r9 * r12;
	r13 = (double)r9;
	r11 = r11 + r13;
	r0->texMemory = r11;
	return;
}

void h3d_impl_MemoryManager_allocDepth(h3d__impl__MemoryManager r0,h3d__mat__DepthBuffer r1) {
	String r8;
	bool *r3;
	hl__types__ArrayObj r10;
	vvirtual *r4;
	bool r2, r7;
	double r11, r13;
	h3d__impl__Driver r5;
	int r9, r12;
	r2 = false;
	r3 = &r2;
	r2 = h3d_impl_MemoryManager_cleanTextures(r0,r3);
	if( r1 == NULL ) hl_null_access();
	r5 = r0->driver;
	if( r5 == NULL ) hl_null_access();
	r4 = ((vvirtual* (*)(h3d__impl__Driver,h3d__mat__DepthBuffer))r5->$type->vobj_proto[24])(r5,r1);
	r1->b = r4;
	r4 = r1->b;
	if( r4 ) goto label$367$23;
	r5 = r0->driver;
	if( r5 == NULL ) hl_null_access();
	r7 = ((bool (*)(h3d__impl__Driver))r5->$type->vobj_proto[2])(r5);
	if( !r7 ) goto label$367$15;
	return;
	label$367$15:
	r7 = true;
	r3 = &r7;
	r7 = h3d_impl_MemoryManager_cleanTextures(r0,r3);
	if( r7 ) goto label$367$21;
	r8 = (String)global$553;
	hl_throw((vdynamic*)r8);
	label$367$21:
	h3d_impl_MemoryManager_allocDepth(r0,r1);
	return;
	label$367$23:
	r10 = r0->depths;
	if( r10 == NULL ) hl_null_access();
	r9 = hl_types_ArrayObj_push(r10,((vdynamic*)r1));
	r11 = r0->texMemory;
	r9 = r1->width;
	r12 = r1->height;
	r9 = r9 * r12;
	r12 = 4;
	r9 = r9 * r12;
	r13 = (double)r9;
	r11 = r11 + r13;
	r0->texMemory = r11;
	return;
}

void h3d_impl_MemoryManager_deleteDepth(h3d__impl__MemoryManager r0,h3d__mat__DepthBuffer r1) {
	hl__types__ArrayObj r4;
	bool r3;
	double r6, r9;
	h3d__impl__Driver r5;
	int r7, r8;
	r4 = r0->depths;
	if( r4 == NULL ) hl_null_access();
	r3 = hl_types_ArrayObj_remove(r4,((vdynamic*)r1));
	if( r3 ) goto label$368$5;
	return;
	label$368$5:
	r5 = r0->driver;
	if( r5 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,h3d__mat__DepthBuffer))r5->$type->vobj_proto[25])(r5,r1);
	r6 = r0->texMemory;
	if( r1 == NULL ) hl_null_access();
	r7 = r1->width;
	r8 = r1->height;
	r7 = r7 * r8;
	r8 = 4;
	r7 = r7 * r8;
	r9 = (double)r7;
	r6 = r6 - r9;
	r0->texMemory = r6;
	return;
}

void h3d_impl_MemoryManager_onContextLost(h3d__impl__MemoryManager r0) {
	h3d_impl_MemoryManager_dispose(r0);
	h3d_impl_MemoryManager_initIndexes(r0);
	return;
}

void h3d_impl_MemoryManager_dispose(h3d__impl__MemoryManager r0) {
	h3d__mat__DepthBuffer r10;
	hl__types__ArrayObj r4;
	hl_type *r13;
	double r14;
	vdynamic *r8;
	h3d__impl__ManagedBuffer r11, r12;
	varray *r9;
	h3d__mat__Texture r7;
	int r3, r5, r6;
	h3d__Indexes r2;
	r2 = r0->triIndexes;
	if( r2 == NULL ) hl_null_access();
	h3d_Indexes_dispose(r2);
	r2 = r0->quadIndexes;
	if( r2 == NULL ) hl_null_access();
	h3d_Indexes_dispose(r2);
	r2 = NULL;
	r0->triIndexes = r2;
	r2 = NULL;
	r0->quadIndexes = r2;
	r3 = 0;
	r4 = r0->textures;
	if( r4 == NULL ) hl_null_access();
	r4 = hl_types_ArrayObj_copy(r4);
	label$370$14:
	if( r4 == NULL ) hl_null_access();
	r6 = r4->length;
	if( r3 >= r6 ) goto label$370$30;
	r5 = r3;
	++r3;
	r6 = r4->length;
	if( ((unsigned)r5) < ((unsigned)r6) ) goto label$370$24;
	r7 = NULL;
	goto label$370$27;
	label$370$24:
	r9 = r4->array;
	r8 = ((vdynamic**)(r9 + 1))[r5];
	r7 = (h3d__mat__Texture)r8;
	label$370$27:
	if( r7 == NULL ) hl_null_access();
	h3d_mat_Texture_dispose(r7);
	goto label$370$14;
	label$370$30:
	r3 = 0;
	r4 = r0->depths;
	if( r4 == NULL ) hl_null_access();
	r4 = hl_types_ArrayObj_copy(r4);
	label$370$34:
	if( r4 == NULL ) hl_null_access();
	r6 = r4->length;
	if( r3 >= r6 ) goto label$370$50;
	r5 = r3;
	++r3;
	r6 = r4->length;
	if( ((unsigned)r5) < ((unsigned)r6) ) goto label$370$44;
	r10 = NULL;
	goto label$370$47;
	label$370$44:
	r9 = r4->array;
	r8 = ((vdynamic**)(r9 + 1))[r5];
	r10 = (h3d__mat__DepthBuffer)r8;
	label$370$47:
	if( r10 == NULL ) hl_null_access();
	h3d_mat_DepthBuffer_dispose(r10);
	goto label$370$34;
	label$370$50:
	r3 = 0;
	r4 = r0->buffers;
	if( r4 == NULL ) hl_null_access();
	r4 = hl_types_ArrayObj_copy(r4);
	label$370$54:
	if( r4 == NULL ) hl_null_access();
	r6 = r4->length;
	if( r3 >= r6 ) goto label$370$75;
	r5 = r3;
	++r3;
	r6 = r4->length;
	if( ((unsigned)r5) < ((unsigned)r6) ) goto label$370$64;
	r11 = NULL;
	goto label$370$67;
	label$370$64:
	r9 = r4->array;
	r8 = ((vdynamic**)(r9 + 1))[r5];
	r11 = (h3d__impl__ManagedBuffer)r8;
	label$370$67:
	if( !r11 ) goto label$370$74;
	if( r11 == NULL ) hl_null_access();
	h3d_impl_ManagedBuffer_dispose(r11);
	r12 = r11->next;
	r11 = r12;
	goto label$370$67;
	label$370$74:
	goto label$370$54;
	label$370$75:
	r3 = 0;
	r4 = r0->indexes;
	if( r4 == NULL ) hl_null_access();
	r4 = hl_types_ArrayObj_copy(r4);
	label$370$79:
	if( r4 == NULL ) hl_null_access();
	r6 = r4->length;
	if( r3 >= r6 ) goto label$370$95;
	r5 = r3;
	++r3;
	r6 = r4->length;
	if( ((unsigned)r5) < ((unsigned)r6) ) goto label$370$89;
	r2 = NULL;
	goto label$370$92;
	label$370$89:
	r9 = r4->array;
	r8 = ((vdynamic**)(r9 + 1))[r5];
	r2 = (h3d__Indexes)r8;
	label$370$92:
	if( r2 == NULL ) hl_null_access();
	h3d_Indexes_dispose(r2);
	goto label$370$79;
	label$370$95:
	r13 = &type$186;
	r3 = 0;
	r9 = hl_alloc_array(r13,r3);
	r4 = hl_types_ArrayObj_alloc(r9);
	r0->buffers = r4;
	r13 = &type$62;
	r3 = 0;
	r9 = hl_alloc_array(r13,r3);
	r4 = hl_types_ArrayObj_alloc(r9);
	r0->indexes = r4;
	r13 = &type$93;
	r3 = 0;
	r9 = hl_alloc_array(r13,r3);
	r4 = hl_types_ArrayObj_alloc(r9);
	r0->textures = r4;
	r3 = 0;
	r0->bufferCount = r3;
	r3 = 0;
	r14 = (double)r3;
	r0->usedMemory = r14;
	r3 = 0;
	r14 = (double)r3;
	r0->texMemory = r14;
	return;
}

int h3d_impl_MemoryManager_freeMemorySize(h3d__impl__MemoryManager r0) {
	hl__types__ArrayObj r3;
	h3d__impl___ManagedBuffer__FreeCell r10, r11;
	vdynamic *r7;
	varray *r8;
	h3d__impl__ManagedBuffer r6, r9;
	int r1, r2, r4, r5, r12;
	r1 = 0;
	r2 = 0;
	r3 = r0->buffers;
	label$371$3:
	if( r3 == NULL ) hl_null_access();
	r5 = r3->length;
	if( r2 >= r5 ) goto label$371$39;
	r4 = r2;
	++r2;
	r5 = r3->length;
	if( ((unsigned)r4) < ((unsigned)r5) ) goto label$371$13;
	r6 = NULL;
	goto label$371$16;
	label$371$13:
	r8 = r3->array;
	r7 = ((vdynamic**)(r8 + 1))[r4];
	r6 = (h3d__impl__ManagedBuffer)r7;
	label$371$16:
	if( !r6 ) goto label$371$38;
	if( r6 == NULL ) hl_null_access();
	r10 = r6->freeList;
	label$371$20:
	if( !r10 ) goto label$371$34;
	if( r10 == NULL ) hl_null_access();
	r5 = r10->count;
	if( r6 == NULL ) hl_null_access();
	r12 = r6->stride;
	r5 = r5 * r12;
	r12 = 4;
	r5 = r5 * r12;
	r4 = r1 + r5;
	r1 = r4;
	r11 = r10->next;
	r10 = r11;
	goto label$371$20;
	label$371$34:
	if( r6 == NULL ) hl_null_access();
	r9 = r6->next;
	r6 = r9;
	goto label$371$16;
	label$371$38:
	goto label$371$3;
	label$371$39:
	return r1;
}

vvirtual* h3d_impl_MemoryManager_stats(h3d__impl__MemoryManager r0) {
	vvirtual *r14;
	hl__types__ArrayObj r4;
	h3d__impl___ManagedBuffer__FreeCell r12, r13;
	double r15, r16;
	vdynamic *r8;
	varray *r9;
	h3d__impl__ManagedBuffer r7, r10;
	int r1, r2, r3, r5, r6, r11;
	r1 = 0;
	r2 = 0;
	r3 = 0;
	r4 = r0->buffers;
	label$372$4:
	if( r4 == NULL ) hl_null_access();
	r6 = r4->length;
	if( r3 >= r6 ) goto label$372$47;
	r5 = r3;
	++r3;
	r6 = r4->length;
	if( ((unsigned)r5) < ((unsigned)r6) ) goto label$372$14;
	r7 = NULL;
	goto label$372$17;
	label$372$14:
	r9 = r4->array;
	r8 = ((vdynamic**)(r9 + 1))[r5];
	r7 = (h3d__impl__ManagedBuffer)r8;
	label$372$17:
	if( !r7 ) goto label$372$46;
	if( r7 == NULL ) hl_null_access();
	r6 = r7->stride;
	r11 = r7->size;
	r6 = r6 * r11;
	r11 = 4;
	r6 = r6 * r11;
	r5 = r1 + r6;
	r1 = r5;
	r12 = r7->freeList;
	label$372$28:
	if( !r12 ) goto label$372$42;
	if( r12 == NULL ) hl_null_access();
	r6 = r12->count;
	if( r7 == NULL ) hl_null_access();
	r11 = r7->stride;
	r6 = r6 * r11;
	r11 = 4;
	r6 = r6 * r11;
	r5 = r2 + r6;
	r2 = r5;
	r13 = r12->next;
	r12 = r13;
	goto label$372$28;
	label$372$42:
	if( r7 == NULL ) hl_null_access();
	r10 = r7->next;
	r7 = r10;
	goto label$372$17;
	label$372$46:
	goto label$372$4;
	label$372$47:
	r14 = hl_alloc_virtual(&type$2187);
	r3 = r0->bufferCount;
	if( hl_vfields(r14)[0] ) *(int*)(hl_vfields(r14)[0]) = (int)r3; else hl_dyn_seti(r14->value,-407971921/*bufferCount*/,&type$3,r3);
	if( hl_vfields(r14)[1] ) *(int*)(hl_vfields(r14)[1]) = (int)r2; else hl_dyn_seti(r14->value,506895363/*freeManagedMemory*/,&type$3,r2);
	if( hl_vfields(r14)[2] ) *(int*)(hl_vfields(r14)[2]) = (int)r1; else hl_dyn_seti(r14->value,-536452549/*managedMemory*/,&type$3,r1);
	r15 = r0->usedMemory;
	r16 = r0->texMemory;
	r15 = r15 + r16;
	if( hl_vfields(r14)[5] ) *(double*)(hl_vfields(r14)[5]) = (double)r15; else hl_dyn_setd(r14->value,-352993952/*totalMemory*/,r15);
	r4 = r0->textures;
	if( r4 == NULL ) hl_null_access();
	r3 = r4->length;
	if( hl_vfields(r14)[3] ) *(int*)(hl_vfields(r14)[3]) = (int)r3; else hl_dyn_seti(r14->value,50524926/*textureCount*/,&type$3,r3);
	r15 = r0->texMemory;
	if( hl_vfields(r14)[4] ) *(double*)(hl_vfields(r14)[4]) = (double)r15; else hl_dyn_setd(r14->value,-136864595/*textureMemory*/,r15);
	return r14;
}

hl__types__ArrayObj h3d_impl_MemoryManager_allocStats(h3d__impl__MemoryManager r0) {
	hl__types__ArrayObj r1;
	hl_type *r3;
	int r4;
	varray *r2;
	r3 = &type$2189;
	r4 = 0;
	r2 = hl_alloc_array(r3,r4);
	r1 = hl_types_ArrayObj_alloc(r2);
	return r1;
}

void h3d_impl_MemoryManager_garbage(h3d__impl__MemoryManager r0) {
	return;
}

void h3d_impl_MemoryManager_new(h3d__impl__MemoryManager r0,h3d__impl__Driver r1) {
	double r4;
	vclosure *r2;
	int r3;
	r2 = r0->garbage;
	if( r2 ) goto label$449$4;
	r2 = hl_alloc_closure_ptr(&type$2174,h3d_impl_MemoryManager_garbage,r0);
	r0->garbage = r2;
	label$449$4:
	r3 = 0;
	r0->bufferCount = r3;
	r4 = 0.;
	r0->texMemory = r4;
	r4 = 0.;
	r0->usedMemory = r4;
	r0->driver = r1;
	return;
}

