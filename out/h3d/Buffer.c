// Generated by HLC 4.0.0 (HL v4)
#include <hl/code.h>

bool h3d_Buffer_isDisposed(h3d__Buffer r0) {
	vvirtual *r3, *r4;
	bool r2;
	h3d__impl__ManagedBuffer r1;
	r1 = r0->buffer;
	if( !r1 ) goto label$856$11;
	r1 = r0->buffer;
	if( r1 == NULL ) hl_null_access();
	r3 = r1->vbuf;
	r4 = NULL;
	if( r3 == r4 || (r3 && r4 && r3->value && r4->value && r3->value == r4->value) ) goto label$856$9;
	r2 = false;
	goto label$856$10;
	label$856$9:
	r2 = true;
	label$856$10:
	return r2;
	label$856$11:
	r2 = true;
	return r2;
}

void h3d_Buffer_dispose(h3d__Buffer r0) {
	h3d__Buffer r3;
	h3d__impl__ManagedBuffer r2;
	r2 = r0->buffer;
	if( !r2 ) goto label$857$12;
	r2 = r0->buffer;
	if( r2 == NULL ) hl_null_access();
	h3d_impl_ManagedBuffer_freeBuffer(r2,r0);
	r2 = NULL;
	r0->buffer = r2;
	r3 = r0->next;
	if( !r3 ) goto label$857$12;
	r3 = r0->next;
	if( r3 == NULL ) hl_null_access();
	h3d_Buffer_dispose(r3);
	label$857$12:
	return;
}

int h3d_Buffer_totalVertices(h3d__Buffer r0) {
	h3d__Buffer r2, r3;
	int r1, r4, r5;
	r1 = 0;
	r2 = r0;
	label$858$2:
	if( !r2 ) goto label$858$11;
	if( r2 == NULL ) hl_null_access();
	r5 = r2->vertices;
	r4 = r1 + r5;
	r1 = r4;
	r3 = r2->next;
	r2 = r3;
	goto label$858$2;
	label$858$11:
	return r1;
}

void h3d_Buffer_uploadVector(h3d__Buffer r0,hl__types__ArrayBytes_Single r1,int r2,int r3,int* r4) {
	String r11;
	h3d__Buffer r6, r8;
	h3d__impl__ManagedBuffer r12;
	int r5, r9, r10, r13, r14, r15;
	if( r4 ) goto label$859$3;
	r5 = 0;
	goto label$859$4;
	label$859$3:
	r5 = *r4;
	label$859$4:
	r6 = r0;
	label$859$5:
	if( !r6 ) goto label$859$16;
	if( r6 == NULL ) hl_null_access();
	r10 = r6->vertices;
	if( r5 < r10 ) goto label$859$16;
	r10 = r6->vertices;
	r9 = r5 - r10;
	r5 = r9;
	r8 = r6->next;
	r6 = r8;
	goto label$859$5;
	label$859$16:
	r10 = 0;
	if( r10 >= r3 ) goto label$859$50;
	if( r6 ) goto label$859$22;
	r11 = (String)global$451;
	hl_throw((vdynamic*)r11);
	label$859$22:
	r9 = r3 + r5;
	if( r6 == NULL ) hl_null_access();
	r10 = r6->vertices;
	if( r10 >= r9 ) goto label$859$29;
	r9 = r6->vertices;
	r9 = r9 - r5;
	goto label$859$30;
	label$859$29:
	r9 = r3;
	label$859$30:
	r12 = r6->buffer;
	if( r12 == NULL ) hl_null_access();
	r10 = r6->position;
	r10 = r10 + r5;
	r14 = r2;
	r4 = &r14;
	h3d_impl_ManagedBuffer_uploadVertexBuffer(r12,r10,r9,r1,r4);
	r10 = 0;
	r5 = r10;
	r12 = r0->buffer;
	if( r12 == NULL ) hl_null_access();
	r15 = r12->stride;
	r13 = r9 * r15;
	r10 = r2 + r13;
	r2 = r10;
	r10 = r3 - r9;
	r3 = r10;
	r8 = r6->next;
	r6 = r8;
	goto label$859$16;
	label$859$50:
	return;
}

void h3d_Buffer_uploadBytes(h3d__Buffer r0,haxe__io__Bytes r1,int r2,int r3) {
	String r9;
	h3d__Buffer r4, r8;
	int *r13;
	h3d__impl__ManagedBuffer r10;
	int r6, r7, r11, r12, r14;
	r4 = r0;
	label$860$1:
	r7 = 0;
	if( r7 >= r3 ) goto label$860$32;
	if( r4 ) goto label$860$7;
	r9 = (String)global$451;
	hl_throw((vdynamic*)r9);
	label$860$7:
	if( r4 == NULL ) hl_null_access();
	r7 = r4->vertices;
	if( r7 >= r3 ) goto label$860$12;
	r6 = r4->vertices;
	goto label$860$13;
	label$860$12:
	r6 = r3;
	label$860$13:
	r10 = r4->buffer;
	if( r10 == NULL ) hl_null_access();
	r7 = r4->position;
	r12 = r2;
	r13 = &r12;
	h3d_impl_ManagedBuffer_uploadVertexBytes(r10,r7,r6,r1,r13);
	r10 = r0->buffer;
	if( r10 == NULL ) hl_null_access();
	r14 = r10->stride;
	r11 = r6 * r14;
	r14 = 4;
	r11 = r11 * r14;
	r7 = r2 + r11;
	r2 = r7;
	r7 = r3 - r6;
	r3 = r7;
	r8 = r4->next;
	r4 = r8;
	goto label$860$1;
	label$860$32:
	return;
}

void h3d_Buffer_readBytes(h3d__Buffer r0,haxe__io__Bytes r1,int r2,int r3,int* r4) {
	String r11;
	h3d__Buffer r6, r8;
	h3d__impl__ManagedBuffer r12;
	int r5, r9, r10, r13, r14, r15;
	if( r4 ) goto label$861$3;
	r5 = 0;
	goto label$861$4;
	label$861$3:
	r5 = *r4;
	label$861$4:
	r6 = r0;
	label$861$5:
	if( !r6 ) goto label$861$16;
	if( r6 == NULL ) hl_null_access();
	r10 = r6->vertices;
	if( r5 < r10 ) goto label$861$16;
	r10 = r6->vertices;
	r9 = r5 - r10;
	r5 = r9;
	r8 = r6->next;
	r6 = r8;
	goto label$861$5;
	label$861$16:
	r10 = 0;
	if( r10 >= r3 ) goto label$861$52;
	if( r6 ) goto label$861$22;
	r11 = (String)global$451;
	hl_throw((vdynamic*)r11);
	label$861$22:
	r9 = r3 + r5;
	if( r6 == NULL ) hl_null_access();
	r10 = r6->vertices;
	if( r10 >= r9 ) goto label$861$29;
	r9 = r6->vertices;
	r9 = r9 - r5;
	goto label$861$30;
	label$861$29:
	r9 = r3;
	label$861$30:
	r12 = r6->buffer;
	if( r12 == NULL ) hl_null_access();
	r10 = r6->position;
	r10 = r10 + r5;
	r14 = r2;
	r4 = &r14;
	h3d_impl_ManagedBuffer_readVertexBytes(r12,r10,r9,r1,r4);
	r10 = 0;
	r5 = r10;
	r12 = r0->buffer;
	if( r12 == NULL ) hl_null_access();
	r15 = r12->stride;
	r13 = r9 * r15;
	r15 = 4;
	r13 = r13 * r15;
	r10 = r2 + r13;
	r2 = r10;
	r10 = r3 - r9;
	r3 = r10;
	r8 = r6->next;
	r6 = r8;
	goto label$861$16;
	label$861$52:
	return;
}

void h3d_Buffer_new(h3d__Buffer r0,int r1,int r2,hl__types__ArrayObj r3,vvirtual* r4) {
	venum *r12;
	h3d__$Buffer r5;
	h3d__Engine r16;
	h3d__$Engine r17;
	h3d__impl__MemoryManager r15;
	vdynamic *r13;
	varray *r14;
	int r6, r7, r9, r10, r11;
	r5 = (h3d__$Buffer)global$73;
	r6 = r5->GUID;
	r7 = r6;
	++r6;
	r5->GUID = r6;
	r0->id = r7;
	r0->vertices = r1;
	r6 = 0;
	r0->flags = r6;
	if( !r3 ) goto label$864$32;
	r6 = 0;
	label$864$11:
	if( r3 == NULL ) hl_null_access();
	r9 = r3->length;
	if( r6 >= r9 ) goto label$864$32;
	r7 = r0->flags;
	r9 = 1;
	r10 = r6;
	++r6;
	r11 = r3->length;
	if( ((unsigned)r10) < ((unsigned)r11) ) goto label$864$23;
	r12 = NULL;
	goto label$864$26;
	label$864$23:
	r14 = r3->array;
	r13 = ((vdynamic**)(r14 + 1))[r10];
	r12 = (venum*)r13;
	label$864$26:
	if( r12 == NULL ) hl_null_access();
	r10 = HL__ENUM_INDEX__(r12);
	r9 = r9 << r10;
	r7 = r7 | r9;
	r0->flags = r7;
	goto label$864$11;
	label$864$32:
	r6 = r0->flags;
	r7 = 32;
	r6 = r6 & r7;
	r7 = 0;
	if( r6 != r7 ) goto label$864$43;
	r17 = (h3d__$Engine)global$38;
	r16 = r17->CURRENT;
	if( r16 == NULL ) hl_null_access();
	r15 = r16->mem;
	if( r15 == NULL ) hl_null_access();
	h3d_impl_MemoryManager_allocBuffer(r15,r0,r2);
	label$864$43:
	return;
}

h3d__Buffer h3d_Buffer_ofSubFloats(hl__types__ArrayBytes_Single r0,int r1,int r2,hl__types__ArrayObj r3,vvirtual* r4) {
	h3d__Buffer r5;
	int *r8;
	int r6;
	r5 = (h3d__Buffer)hl_alloc_obj(h3d__Buffer__val);
	h3d_Buffer_new(r5,r2,r1,r3,r4);
	r6 = 0;
	r8 = NULL;
	h3d_Buffer_uploadVector(r5,r0,r6,r2,r8);
	return r5;
}

h3d__Buffer h3d_Buffer_ofFloats(hl__types__ArrayBytes_Single r0,int r1,hl__types__ArrayObj r2,vvirtual* r3) {
	h3d__Buffer r8;
	double r4, r6;
	int *r10;
	int r5, r9;
	if( r0 == NULL ) hl_null_access();
	r5 = r0->length;
	r4 = (double)r5;
	r6 = (double)r1;
	r4 = r4 / r6;
	r5 = (int)r4;
	r8 = (h3d__Buffer)hl_alloc_obj(h3d__Buffer__val);
	h3d_Buffer_new(r8,r5,r1,r2,r3);
	r9 = 0;
	r10 = NULL;
	h3d_Buffer_uploadVector(r8,r0,r9,r5,r10);
	return r8;
}

