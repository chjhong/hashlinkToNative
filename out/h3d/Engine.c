// Generated by HLC 4.0.0 (HL v4)
#include <hl/code.h>

void h3d_Engine_setDriver(h3d__Engine r0,h3d__impl__Driver r1) {
	h3d__impl__MemoryManager r3;
	r0->driver = r1;
	r3 = r0->mem;
	if( !r3 ) goto label$273$6;
	r3 = r0->mem;
	if( r3 == NULL ) hl_null_access();
	r3->driver = r1;
	label$273$6:
	return;
}

void h3d_Engine_setCurrent(h3d__Engine r0) {
	h3d__$Engine r1;
	r1 = (h3d__$Engine)global$38;
	r1->CURRENT = r0;
	return;
}

void h3d_Engine_init(h3d__Engine r0) {
	bool *r5;
	bool r4;
	vclosure *r3;
	h3d__impl__Driver r2;
	r2 = r0->driver;
	if( r2 == NULL ) hl_null_access();
	r3 = hl_alloc_closure_ptr(&type$1775,h3d_Engine_onCreate,r0);
	r4 = r0->hardware;
	r4 = !r4;
	r5 = &r4;
	((void (*)(h3d__impl__Driver,vclosure*,bool*))r2->$type->vobj_proto[11])(r2,r3,r5);
	return;
}

String h3d_Engine_driverName(h3d__Engine r0,bool* r1) {
	String r3;
	bool r2;
	h3d__impl__Driver r4;
	if( r1 ) goto label$276$3;
	r2 = false;
	goto label$276$4;
	label$276$3:
	r2 = *r1;
	label$276$4:
	r4 = r0->driver;
	if( r4 == NULL ) hl_null_access();
	r3 = ((String (*)(h3d__impl__Driver,bool))r4->$type->vobj_proto[10])(r4,r2);
	return r3;
}

void h3d_Engine_selectShader(h3d__Engine r0,hxsl__RuntimeShader r1) {
	bool r3;
	h3d__impl__Driver r4;
	int r5;
	r3 = r0->needFlushTarget;
	if( !r3 ) goto label$277$3;
	h3d_Engine_doFlushTarget(r0);
	label$277$3:
	r4 = r0->driver;
	if( r4 == NULL ) hl_null_access();
	r3 = ((bool (*)(h3d__impl__Driver,hxsl__RuntimeShader))r4->$type->vobj_proto[13])(r4,r1);
	if( !r3 ) goto label$277$10;
	r5 = r0->shaderSwitches;
	++r5;
	r0->shaderSwitches = r5;
	label$277$10:
	return;
}

void h3d_Engine_selectMaterial(h3d__Engine r0,h3d__mat__Pass r1) {
	h3d__impl__Driver r3;
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,h3d__mat__Pass))r3->$type->vobj_proto[14])(r3,r1);
	return;
}

void h3d_Engine_uploadShaderBuffers(h3d__Engine r0,h3d__shader__Buffers r1,int r2) {
	h3d__impl__Driver r4;
	r4 = r0->driver;
	if( r4 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,h3d__shader__Buffers,int))r4->$type->vobj_proto[15])(r4,r1,r2);
	return;
}

bool h3d_Engine_selectBuffer(h3d__Engine r0,h3d__Buffer r1) {
	bool r3;
	h3d__impl__Driver r4;
	if( r1 == NULL ) hl_null_access();
	r3 = h3d_Buffer_isDisposed(r1);
	if( !r3 ) goto label$280$5;
	r3 = false;
	return r3;
	label$280$5:
	r3 = r0->needFlushTarget;
	if( !r3 ) goto label$280$8;
	h3d_Engine_doFlushTarget(r0);
	label$280$8:
	r4 = r0->driver;
	if( r4 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,h3d__Buffer))r4->$type->vobj_proto[17])(r4,r1);
	r3 = true;
	return r3;
}

void h3d_Engine_renderTriBuffer(h3d__Engine r0,h3d__Buffer r1,int* r2,int* r3) {
	h3d__impl__MemoryManager r8;
	h3d__Indexes r7;
	int r4, r5, r9, r10, r11;
	if( r2 ) goto label$281$3;
	r4 = 0;
	goto label$281$4;
	label$281$3:
	r4 = *r2;
	label$281$4:
	if( r3 ) goto label$281$7;
	r5 = -1;
	goto label$281$8;
	label$281$7:
	r5 = *r3;
	label$281$8:
	r8 = r0->mem;
	if( r8 == NULL ) hl_null_access();
	r7 = r8->triIndexes;
	r9 = 3;
	r10 = r4;
	r2 = &r10;
	r11 = r5;
	r3 = &r11;
	h3d_Engine_renderBuffer(r0,r1,r7,r9,r2,r3);
	return;
}

void h3d_Engine_renderQuadBuffer(h3d__Engine r0,h3d__Buffer r1,int* r2,int* r3) {
	h3d__impl__MemoryManager r8;
	h3d__Indexes r7;
	int r4, r5, r9, r10, r11;
	if( r2 ) goto label$282$3;
	r4 = 0;
	goto label$282$4;
	label$282$3:
	r4 = *r2;
	label$282$4:
	if( r3 ) goto label$282$7;
	r5 = -1;
	goto label$282$8;
	label$282$7:
	r5 = *r3;
	label$282$8:
	r8 = r0->mem;
	if( r8 == NULL ) hl_null_access();
	r7 = r8->quadIndexes;
	r9 = 2;
	r10 = r4;
	r2 = &r10;
	r11 = r5;
	r3 = &r11;
	h3d_Engine_renderBuffer(r0,r1,r7,r9,r2,r3);
	return;
}

void h3d_Engine_renderBuffer(h3d__Engine r0,h3d__Buffer r1,h3d__Indexes r2,int r3,int* r4,int* r5) {
	vvirtual *r19;
	bool r9;
	h3d__Buffer r12;
	double r10, r13, r15;
	h3d__impl__Driver r18;
	int r6, r7, r11, r14, r16, r17;
	if( r4 ) goto label$283$3;
	r6 = 0;
	goto label$283$4;
	label$283$3:
	r6 = *r4;
	label$283$4:
	if( r5 ) goto label$283$7;
	r7 = -1;
	goto label$283$8;
	label$283$7:
	r7 = *r5;
	label$283$8:
	if( r2 == NULL ) hl_null_access();
	r9 = h3d_Indexes_isDisposed(r2);
	if( !r9 ) goto label$283$12;
	return;
	label$283$12:
	r9 = true;
	if( !r9 ) goto label$283$77;
	if( r1 == NULL ) hl_null_access();
	r11 = r1->vertices;
	r10 = (double)r11;
	r13 = (double)r3;
	r10 = r10 / r13;
	r11 = (int)r10;
	r14 = r1->position;
	r13 = (double)r14;
	r15 = (double)r3;
	r13 = r13 / r15;
	r14 = (int)r13;
	r17 = 0;
	if( r17 >= r6 ) goto label$283$42;
	if( r6 < r11 ) goto label$283$36;
	r16 = r6 - r11;
	r6 = r16;
	r12 = r1->next;
	r1 = r12;
	if( r12 ) goto label$283$35;
	goto label$283$77;
	label$283$35:
	goto label$283$12;
	label$283$36:
	r16 = r14 + r6;
	r14 = r16;
	r16 = r11 - r6;
	r11 = r16;
	r16 = 0;
	r6 = r16;
	label$283$42:
	r17 = 0;
	if( r7 < r17 ) goto label$283$55;
	r17 = 0;
	if( r7 != r17 ) goto label$283$47;
	return;
	label$283$47:
	r16 = r7 - r11;
	r7 = r16;
	r17 = 0;
	if( r16 >= r17 ) goto label$283$55;
	r16 = r11 + r7;
	r11 = r16;
	r16 = 0;
	r7 = r16;
	label$283$55:
	r17 = 0;
	if( r17 >= r11 ) goto label$283$72;
	r9 = h3d_Engine_selectBuffer(r0,r1);
	if( !r9 ) goto label$283$72;
	r18 = r0->driver;
	if( r18 == NULL ) hl_null_access();
	if( r2 == NULL ) hl_null_access();
	r19 = r2->ibuf;
	r17 = 3;
	r16 = r14 * r17;
	((void (*)(h3d__impl__Driver,vvirtual*,int,int))r18->$type->vobj_proto[19])(r18,r19,r16,r11);
	r16 = r0->drawTriangles;
	r16 = r16 + r11;
	r0->drawTriangles = r16;
	r16 = r0->drawCalls;
	++r16;
	r0->drawCalls = r16;
	label$283$72:
	r12 = r1->next;
	r1 = r12;
	if( r12 ) goto label$283$76;
	goto label$283$77;
	label$283$76:
	goto label$283$12;
	label$283$77:
	return;
}

void h3d_Engine_renderIndexed(h3d__Engine r0,h3d__Buffer r1,h3d__Indexes r2,int* r3,int* r4) {
	String r9;
	vvirtual *r17;
	bool r10;
	double r11, r13;
	h3d__Buffer r8;
	h3d__impl__Driver r16;
	int r5, r6, r12, r14, r15;
	if( r3 ) goto label$284$3;
	r5 = 0;
	goto label$284$4;
	label$284$3:
	r5 = *r3;
	label$284$4:
	if( r4 ) goto label$284$7;
	r6 = -1;
	goto label$284$8;
	label$284$7:
	r6 = *r4;
	label$284$8:
	if( r1 == NULL ) hl_null_access();
	r8 = r1->next;
	if( !r8 ) goto label$284$13;
	r9 = (String)global$462;
	hl_throw((vdynamic*)r9);
	label$284$13:
	if( r2 == NULL ) hl_null_access();
	r10 = h3d_Indexes_isDisposed(r2);
	if( !r10 ) goto label$284$17;
	return;
	label$284$17:
	r12 = r2->count;
	r11 = (double)r12;
	r12 = 3;
	r13 = (double)r12;
	r11 = r11 / r13;
	r12 = (int)r11;
	r15 = 0;
	if( r6 >= r15 ) goto label$284$27;
	r14 = r12 - r5;
	r6 = r14;
	label$284$27:
	r15 = 0;
	if( r15 >= r6 ) goto label$284$43;
	r10 = h3d_Engine_selectBuffer(r0,r1);
	if( !r10 ) goto label$284$43;
	r16 = r0->driver;
	if( r16 == NULL ) hl_null_access();
	r17 = r2->ibuf;
	r15 = 3;
	r14 = r5 * r15;
	((void (*)(h3d__impl__Driver,vvirtual*,int,int))r16->$type->vobj_proto[19])(r16,r17,r14,r6);
	r14 = r0->drawTriangles;
	r14 = r14 + r6;
	r0->drawTriangles = r14;
	r14 = r0->drawCalls;
	++r14;
	r0->drawCalls = r14;
	label$284$43:
	return;
}

void h3d_Engine_renderMultiBuffers(h3d__Engine r0,h3d__BufferOffset r1,h3d__Indexes r2,int* r3,int* r4) {
	vvirtual *r15;
	bool r13;
	double r7, r9;
	h3d__impl__Driver r14;
	int r5, r6, r8, r11, r12;
	if( r3 ) goto label$285$3;
	r5 = 0;
	goto label$285$4;
	label$285$3:
	r5 = *r3;
	label$285$4:
	if( r4 ) goto label$285$7;
	r6 = -1;
	goto label$285$8;
	label$285$7:
	r6 = *r4;
	label$285$8:
	if( r2 == NULL ) hl_null_access();
	r8 = r2->count;
	r7 = (double)r8;
	r8 = 3;
	r9 = (double)r8;
	r7 = r7 / r9;
	r8 = (int)r7;
	r12 = 0;
	if( r12 < r8 ) goto label$285$18;
	return;
	label$285$18:
	r13 = r0->needFlushTarget;
	if( !r13 ) goto label$285$21;
	h3d_Engine_doFlushTarget(r0);
	label$285$21:
	r14 = r0->driver;
	if( r14 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,h3d__BufferOffset))r14->$type->vobj_proto[18])(r14,r1);
	r13 = h3d_Indexes_isDisposed(r2);
	if( !r13 ) goto label$285$27;
	return;
	label$285$27:
	r12 = 0;
	if( r6 >= r12 ) goto label$285$31;
	r11 = r8 - r5;
	r6 = r11;
	label$285$31:
	r12 = 0;
	if( r12 >= r6 ) goto label$285$45;
	r14 = r0->driver;
	if( r14 == NULL ) hl_null_access();
	r15 = r2->ibuf;
	r12 = 3;
	r11 = r5 * r12;
	((void (*)(h3d__impl__Driver,vvirtual*,int,int))r14->$type->vobj_proto[19])(r14,r15,r11,r6);
	r11 = r0->drawTriangles;
	r11 = r11 + r6;
	r0->drawTriangles = r11;
	r11 = r0->drawCalls;
	++r11;
	r0->drawCalls = r11;
	label$285$45:
	return;
}

void h3d_Engine_renderInstanced(h3d__Engine r0,h3d__BufferOffset r1,h3d__Indexes r2,h3d__impl__InstanceBuffer r3) {
	vvirtual *r9;
	bool r5;
	h3d__impl__Driver r6;
	int r7, r8;
	r5 = r0->needFlushTarget;
	if( !r5 ) goto label$286$3;
	h3d_Engine_doFlushTarget(r0);
	label$286$3:
	r6 = r0->driver;
	if( r6 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,h3d__BufferOffset))r6->$type->vobj_proto[18])(r6,r1);
	if( r2 == NULL ) hl_null_access();
	r5 = h3d_Indexes_isDisposed(r2);
	if( !r5 ) goto label$286$10;
	return;
	label$286$10:
	if( r3 == NULL ) hl_null_access();
	r7 = r3->commandCount;
	r8 = 0;
	if( r8 >= r7 ) goto label$286$25;
	r6 = r0->driver;
	if( r6 == NULL ) hl_null_access();
	r9 = r2->ibuf;
	((void (*)(h3d__impl__Driver,vvirtual*,h3d__impl__InstanceBuffer))r6->$type->vobj_proto[20])(r6,r9,r3);
	r7 = r0->drawTriangles;
	r8 = r3->triCount;
	r7 = r7 + r8;
	r0->drawTriangles = r7;
	r7 = r0->drawCalls;
	++r7;
	r0->drawCalls = r7;
	label$286$25:
	return;
}

bool h3d_Engine_set_debug(h3d__Engine r0,bool r1) {
	r0->debug = r1;
	return r1;
}

void h3d_Engine_onCreate(h3d__Engine r0,bool r1) {
	venum *r9;
	bool r4;
	hxd__Window r6;
	h3d__impl__MemoryManager r7;
	h3d__$Engine r2;
	vclosure *r11;
	h3d__impl__Driver r8;
	int r5, r10;
	r2 = (h3d__$Engine)global$38;
	r2->CURRENT = r0;
	r4 = r0->autoResize;
	if( !r4 ) goto label$288$12;
	r6 = r0->window;
	if( r6 == NULL ) hl_null_access();
	r5 = hxd_Window_get_width(r6);
	r0->width = r5;
	r6 = r0->window;
	if( r6 == NULL ) hl_null_access();
	r5 = hxd_Window_get_height(r6);
	r0->height = r5;
	label$288$12:
	if( !r1 ) goto label$288$17;
	r7 = r0->mem;
	if( r7 == NULL ) hl_null_access();
	h3d_impl_MemoryManager_onContextLost(r7);
	goto label$288$24;
	label$288$17:
	r7 = (h3d__impl__MemoryManager)hl_alloc_obj(h3d__impl__MemoryManager__val);
	r8 = r0->driver;
	h3d_impl_MemoryManager_new(r7,r8);
	r0->mem = r7;
	r7 = r0->mem;
	if( r7 == NULL ) hl_null_access();
	h3d_impl_MemoryManager_init(r7);
	label$288$24:
	r8 = r0->driver;
	if( r8 == NULL ) hl_null_access();
	r9 = (venum*)global$464;
	r4 = ((bool (*)(h3d__impl__Driver,venum*))r8->$type->vobj_proto[0])(r8,r9);
	r0->hardware = r4;
	r4 = r0->debug;
	r4 = h3d_Engine_set_debug(r0,r4);
	r4 = r0->fullScreen;
	r4 = h3d_Engine_set_fullScreen(r0,r4);
	r5 = r0->width;
	r10 = r0->height;
	h3d_Engine_resize(r0,r5,r10);
	if( !r1 ) goto label$288$41;
	r11 = r0->onContextLost;
	if( r11 == NULL ) hl_null_access();
	r11->hasValue ? ((void (*)(vdynamic*))r11->fun)((vdynamic*)r11->value) : ((void (*)(void))r11->fun)();
	goto label$288$44;
	label$288$41:
	r11 = r0->onReady;
	if( r11 == NULL ) hl_null_access();
	r11->hasValue ? ((void (*)(vdynamic*))r11->fun)((vdynamic*)r11->value) : ((void (*)(void))r11->fun)();
	label$288$44:
	r4 = true;
	r0->ready = r4;
	return;
}

void h3d_Engine_onWindowResize(h3d__Engine r0) {
	bool r2;
	hxd__Window r5;
	vclosure *r8;
	h3d__impl__Driver r3;
	int r4, r6, r7;
	r2 = r0->autoResize;
	if( !r2 ) goto label$291$20;
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	r2 = ((bool (*)(h3d__impl__Driver))r3->$type->vobj_proto[2])(r3);
	if( r2 ) goto label$291$20;
	r5 = r0->window;
	if( r5 == NULL ) hl_null_access();
	r4 = hxd_Window_get_width(r5);
	r5 = r0->window;
	if( r5 == NULL ) hl_null_access();
	r6 = hxd_Window_get_height(r5);
	r7 = r0->width;
	if( r4 != r7 ) goto label$291$16;
	r7 = r0->height;
	if( r6 == r7 ) goto label$291$17;
	label$291$16:
	h3d_Engine_resize(r0,r4,r6);
	label$291$17:
	r8 = r0->onResized;
	if( r8 == NULL ) hl_null_access();
	r8->hasValue ? ((void (*)(vdynamic*))r8->fun)((vdynamic*)r8->value) : ((void (*)(void))r8->fun)();
	label$291$20:
	return;
}

bool h3d_Engine_set_fullScreen(h3d__Engine r0,bool r1) {
	venum *r5;
	bool r2;
	hxd__Window r6;
	h3d__impl__MemoryManager r4;
	r0->fullScreen = r1;
	r4 = r0->mem;
	if( !r4 ) goto label$292$9;
	r5 = (venum*)global$456;
	r2 = hxd_System_getValue(r5);
	if( !r2 ) goto label$292$9;
	r6 = r0->window;
	if( r6 == NULL ) hl_null_access();
	hxd_Window_setFullScreen(r6,r1);
	label$292$9:
	return r1;
}

void h3d_Engine_resize(h3d__Engine r0,int r1,int r2) {
	bool r6;
	h3d__impl__Driver r7;
	int r4, r5;
	r5 = 32;
	if( r1 >= r5 ) goto label$294$4;
	r4 = 32;
	r1 = r4;
	label$294$4:
	r5 = 32;
	if( r2 >= r5 ) goto label$294$8;
	r4 = 32;
	r2 = r4;
	label$294$8:
	r0->width = r1;
	r0->height = r2;
	r7 = r0->driver;
	if( r7 == NULL ) hl_null_access();
	r6 = ((bool (*)(h3d__impl__Driver))r7->$type->vobj_proto[2])(r7);
	if( r6 ) goto label$294$17;
	r7 = r0->driver;
	if( r7 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,int,int))r7->$type->vobj_proto[12])(r7,r1,r2);
	label$294$17:
	return;
}

bool h3d_Engine_begin(h3d__Engine r0) {
	h3d___Engine__TargetTmp r5;
	bool r2;
	hxd__$Timer r8;
	double r10;
	vdynamic *r9, *r11, *r12;
	h3d__impl__Driver r3;
	h3d__mat__Texture r6, r7;
	int r4;
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	r2 = ((bool (*)(h3d__impl__Driver))r3->$type->vobj_proto[2])(r3);
	if( !r2 ) goto label$295$6;
	r2 = false;
	return r2;
	label$295$6:
	r4 = 0;
	r0->drawTriangles = r4;
	r4 = 0;
	r0->shaderSwitches = r4;
	r4 = 0;
	r0->drawCalls = r4;
	r5 = NULL;
	r0->targetStack = r5;
	r6 = r0->currentTargetTex;
	r7 = NULL;
	if( r6 != r7 ) goto label$295$19;
	r2 = false;
	goto label$295$20;
	label$295$19:
	r2 = true;
	label$295$20:
	r0->needFlushTarget = r2;
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	r8 = (hxd__$Timer)global$146;
	r4 = r8->frameCount;
	((void (*)(h3d__impl__Driver,int))r3->$type->vobj_proto[4])(r3,r4);
	r9 = r0->backgroundColor;
	if( !r9 ) goto label$295$35;
	r9 = r0->backgroundColor;
	r4 = 1;
	r10 = (double)r4;
	r11 = hl_alloc_dynamic(&type$6);
	r11->v.d = r10;
	r4 = 0;
	r12 = hl_alloc_dynamic(&type$3);
	r12->v.i = r4;
	h3d_Engine_clear(r0,r9,r11,r12);
	label$295$35:
	r2 = true;
	return r2;
}

bool h3d_Engine_hasFeature(h3d__Engine r0,venum* r1) {
	bool r2;
	h3d__impl__Driver r3;
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	r2 = ((bool (*)(h3d__impl__Driver,venum*))r3->$type->vobj_proto[0])(r3,r1);
	return r2;
}

void h3d_Engine_end(h3d__Engine r0) {
	return;
}

h3d__mat__Texture h3d_Engine_getCurrentTarget(h3d__Engine r0) {
	h3d___Engine__TargetTmp r1;
	h3d__mat__Texture r2;
	r1 = r0->targetStack;
	if( r1 ) goto label$298$4;
	r2 = NULL;
	return r2;
	label$298$4:
	r1 = r0->targetStack;
	if( r1 == NULL ) hl_null_access();
	r2 = r1->_t;
	return r2;
}

void h3d_Engine_pushTarget(h3d__Engine r0,h3d__mat__Texture r1,int* r2,int* r3) {
	h3d___Engine__TargetTmp r6, r8, r9;
	int r4, r5;
	if( r2 ) goto label$299$3;
	r4 = 0;
	goto label$299$4;
	label$299$3:
	r4 = *r2;
	label$299$4:
	if( r3 ) goto label$299$7;
	r5 = 0;
	goto label$299$8;
	label$299$7:
	r5 = *r3;
	label$299$8:
	r6 = r0->targetTmp;
	if( r6 ) goto label$299$15;
	r8 = (h3d___Engine__TargetTmp)hl_alloc_obj(h3d___Engine__TargetTmp__val);
	r9 = r0->targetStack;
	h3d__Engine_TargetTmp_new(r8,r1,r9,r4,r5);
	r6 = r8;
	goto label$299$23;
	label$299$15:
	if( r6 == NULL ) hl_null_access();
	r8 = r6->next;
	r0->targetTmp = r8;
	r6->_t = r1;
	r9 = r0->targetStack;
	r6->next = r9;
	r6->mipLevel = r5;
	r6->layer = r4;
	label$299$23:
	r0->targetStack = r6;
	h3d_Engine_updateNeedFlush(r0);
	return;
}

void h3d_Engine_updateNeedFlush(h3d__Engine r0) {
	h3d___Engine__TargetTmp r1;
	bool r3;
	int r6, r7;
	h3d__mat__Texture r4, r5;
	r1 = r0->targetStack;
	if( r1 ) goto label$300$10;
	r4 = r0->currentTargetTex;
	r5 = NULL;
	if( r4 != r5 ) goto label$300$7;
	r3 = false;
	goto label$300$8;
	label$300$7:
	r3 = true;
	label$300$8:
	r0->needFlushTarget = r3;
	goto label$300$24;
	label$300$10:
	r4 = r0->currentTargetTex;
	if( r1 == NULL ) hl_null_access();
	r5 = r1->_t;
	if( r4 != r5 ) goto label$300$22;
	r6 = r0->currentTargetLayer;
	r7 = r1->layer;
	if( r6 != r7 ) goto label$300$22;
	r6 = r0->currentTargetMip;
	r7 = r1->mipLevel;
	if( r6 != r7 ) goto label$300$22;
	r3 = false;
	goto label$300$23;
	label$300$22:
	r3 = true;
	label$300$23:
	r0->needFlushTarget = r3;
	label$300$24:
	return;
}

void h3d_Engine_pushTargets(h3d__Engine r0,hl__types__ArrayObj r1) {
	vvirtual *r12;
	hl__types__ArrayObj r6;
	venum *r10, *r11;
	hl_type *r8;
	bool r16;
	h3d__impl__Driver r15;
	int *r13, *r14;
	varray *r7;
	int r4, r5, r9;
	h3d__mat__Texture r3;
	r3 = r0->nullTexture;
	if( r3 ) goto label$301$16;
	r3 = (h3d__mat__Texture)hl_alloc_obj(h3d__mat__Texture__val);
	r4 = 0;
	r5 = 0;
	r8 = &type$497;
	r9 = 1;
	r7 = hl_alloc_array(r8,r9);
	r10 = (venum*)global$465;
	r9 = 0;
	((venum**)(r7 + 1))[r9] = r10;
	r6 = hl_types_ArrayObj_alloc(r7);
	r11 = NULL;
	r12 = NULL;
	h3d_mat_Texture_new(r3,r4,r5,r6,r11,r12);
	r0->nullTexture = r3;
	label$301$16:
	r3 = r0->nullTexture;
	r13 = NULL;
	r14 = NULL;
	h3d_Engine_pushTarget(r0,r3,r13,r14);
	r15 = r0->driver;
	if( r15 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,hl__types__ArrayObj))r15->$type->vobj_proto[23])(r15,r1);
	r3 = r0->nullTexture;
	r0->currentTargetTex = r3;
	r16 = false;
	r0->needFlushTarget = r16;
	return;
}

void h3d_Engine_popTarget(h3d__Engine r0) {
	String r4;
	h3d___Engine__TargetTmp r1, r3, r6;
	h3d__mat__Texture r5;
	r1 = r0->targetStack;
	if( r1 ) goto label$302$4;
	r4 = (String)global$466;
	hl_throw((vdynamic*)r4);
	label$302$4:
	if( r1 == NULL ) hl_null_access();
	r3 = r1->next;
	r0->targetStack = r3;
	h3d_Engine_updateNeedFlush(r0);
	r5 = NULL;
	r1->_t = r5;
	r6 = r0->targetTmp;
	r1->next = r6;
	r0->targetTmp = r1;
	return;
}

void h3d_Engine_flushTarget(h3d__Engine r0) {
	bool r2;
	r2 = r0->needFlushTarget;
	if( !r2 ) goto label$303$3;
	h3d_Engine_doFlushTarget(r0);
	label$303$3:
	return;
}

void h3d_Engine_doFlushTarget(h3d__Engine r0) {
	h3d___Engine__TargetTmp r1;
	bool r10;
	int *r5, *r6;
	h3d__impl__Driver r3;
	int r7, r8, r9;
	h3d__mat__Texture r4;
	r1 = r0->targetStack;
	if( r1 ) goto label$304$11;
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	r4 = NULL;
	r5 = NULL;
	r6 = NULL;
	((void (*)(h3d__impl__Driver,h3d__mat__Texture,int*,int*))r3->$type->vobj_proto[22])(r3,r4,r5,r6);
	r4 = NULL;
	r0->currentTargetTex = r4;
	goto label$304$26;
	label$304$11:
	r3 = r0->driver;
	if( r3 == NULL ) hl_null_access();
	if( r1 == NULL ) hl_null_access();
	r4 = r1->_t;
	r7 = r1->layer;
	r5 = &r7;
	r8 = r1->mipLevel;
	r6 = &r8;
	((void (*)(h3d__impl__Driver,h3d__mat__Texture,int*,int*))r3->$type->vobj_proto[22])(r3,r4,r5,r6);
	r4 = r1->_t;
	r0->currentTargetTex = r4;
	r9 = r1->layer;
	r0->currentTargetLayer = r9;
	r9 = r1->mipLevel;
	r0->currentTargetMip = r9;
	label$304$26:
	r10 = false;
	r0->needFlushTarget = r10;
	return;
}

void h3d_Engine_clearF(h3d__Engine r0,h3d__Vector r1,vdynamic* r2,vdynamic* r3) {
	bool r5;
	h3d__impl__Driver r6;
	r5 = r0->needFlushTarget;
	if( !r5 ) goto label$305$3;
	h3d_Engine_doFlushTarget(r0);
	label$305$3:
	r6 = r0->driver;
	if( r6 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,h3d__Vector,vdynamic*,vdynamic*))r6->$type->vobj_proto[7])(r6,r1,r2,r3);
	return;
}

void h3d_Engine_clear(h3d__Engine r0,vdynamic* r1,vdynamic* r2,vdynamic* r3) {
	bool r11;
	h3d__Vector r5;
	double r7, r10;
	h3d__impl__Driver r12;
	int r6, r8, r9;
	if( !r1 ) goto label$306$36;
	r5 = r0->tmpVector;
	r6 = r1 ? r1->v.i : 0;
	if( r5 == NULL ) hl_null_access();
	r9 = 16;
	r8 = r6 >> r9;
	r9 = 255;
	r8 = r8 & r9;
	r7 = (double)r8;
	r8 = 255;
	r10 = (double)r8;
	r7 = r7 / r10;
	r5->x = r7;
	r9 = 8;
	r8 = r6 >> r9;
	r9 = 255;
	r8 = r8 & r9;
	r7 = (double)r8;
	r8 = 255;
	r10 = (double)r8;
	r7 = r7 / r10;
	r5->y = r7;
	r9 = 255;
	r8 = r6 & r9;
	r7 = (double)r8;
	r8 = 255;
	r10 = (double)r8;
	r7 = r7 / r10;
	r5->z = r7;
	r9 = 24;
	r8 = ((unsigned)r6) >> r9;
	r7 = (double)r8;
	r8 = 255;
	r10 = (double)r8;
	r7 = r7 / r10;
	r5->w = r7;
	label$306$36:
	r11 = r0->needFlushTarget;
	if( !r11 ) goto label$306$39;
	h3d_Engine_doFlushTarget(r0);
	label$306$39:
	r12 = r0->driver;
	if( r12 == NULL ) hl_null_access();
	if( r1 ) goto label$306$44;
	r5 = NULL;
	goto label$306$45;
	label$306$44:
	r5 = r0->tmpVector;
	label$306$45:
	((void (*)(h3d__impl__Driver,h3d__Vector,vdynamic*,vdynamic*))r12->$type->vobj_proto[7])(r12,r5,r2,r3);
	return;
}

void h3d_Engine_setRenderZone(h3d__Engine r0,int* r1,int* r2,int* r3,int* r4) {
	bool r10;
	h3d__impl__Driver r11;
	int r5, r6, r7, r8;
	if( r1 ) goto label$307$3;
	r5 = 0;
	goto label$307$4;
	label$307$3:
	r5 = *r1;
	label$307$4:
	if( r2 ) goto label$307$7;
	r6 = 0;
	goto label$307$8;
	label$307$7:
	r6 = *r2;
	label$307$8:
	if( r3 ) goto label$307$11;
	r7 = -1;
	goto label$307$12;
	label$307$11:
	r7 = *r3;
	label$307$12:
	if( r4 ) goto label$307$15;
	r8 = -1;
	goto label$307$16;
	label$307$15:
	r8 = *r4;
	label$307$16:
	r10 = r0->needFlushTarget;
	if( !r10 ) goto label$307$19;
	h3d_Engine_doFlushTarget(r0);
	label$307$19:
	r11 = r0->driver;
	if( r11 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver,int,int,int,int))r11->$type->vobj_proto[21])(r11,r5,r6,r7,r8);
	return;
}

bool h3d_Engine_render(h3d__Engine r0,vdynamic* r1) {
	bool r3;
	double r5, r6, r7, r9, r10;
	vclosure *r4;
	int r8;
	r3 = h3d_Engine_begin(r0);
	if( r3 ) goto label$308$4;
	r3 = false;
	return r3;
	label$308$4:
	if( r1 == NULL ) hl_null_access();
	r4 = (vclosure*)hl_dyn_getp((vdynamic*)r1,86600534/*render*/,&type$1331);
	if( r4 == NULL ) hl_null_access();
	r4->hasValue ? ((void (*)(vdynamic*,h3d__Engine))r4->fun)((vdynamic*)r4->value,r0) : ((void (*)(h3d__Engine))r4->fun)(r0);
	h3d_Engine_end(r0);
	r5 = hl_sys_time();
	r6 = r0->lastTime;
	r5 = r5 - r6;
	r6 = r0->lastTime;
	r6 = r6 + r5;
	r0->lastTime = r6;
	r8 = 0;
	r7 = (double)r8;
	if( !(r7 < r5) ) goto label$308$53;
	r6 = 1.;
	r6 = r6 / r5;
	r9 = r0->realFps;
	r8 = 2;
	r10 = (double)r8;
	r9 = r9 * r10;
	if( !(r9 < r6) ) goto label$308$31;
	r7 = r0->realFps;
	r8 = 2;
	r9 = (double)r8;
	r7 = r7 * r9;
	r6 = r7;
	goto label$308$39;
	label$308$31:
	r9 = r0->realFps;
	r10 = 0.5;
	r9 = r9 * r10;
	if( !(r6 < r9) ) goto label$308$39;
	r7 = r0->realFps;
	r9 = 0.5;
	r7 = r7 * r9;
	r6 = r7;
	label$308$39:
	r9 = 0.5;
	r7 = r5 / r9;
	r10 = 0.29999999999999999;
	if( !(r10 < r7) ) goto label$308$45;
	r9 = 0.29999999999999999;
	r7 = r9;
	label$308$45:
	r9 = r0->realFps;
	r8 = 1;
	r10 = (double)r8;
	r10 = r10 - r7;
	r9 = r9 * r10;
	r10 = r6 * r7;
	r9 = r9 + r10;
	r0->realFps = r9;
	label$308$53:
	r3 = true;
	return r3;
}

void h3d_Engine_dispose(h3d__Engine r0) {
	hxd__Window r3;
	vclosure *r4;
	h3d__impl__Driver r2;
	r2 = r0->driver;
	if( r2 == NULL ) hl_null_access();
	((void (*)(h3d__impl__Driver))r2->$type->vobj_proto[3])(r2);
	r3 = r0->window;
	if( r3 == NULL ) hl_null_access();
	r4 = hl_alloc_closure_ptr(&type$1331,h3d_Engine_onWindowResize,r0);
	hxd_Window_removeResizeEvent(r3,r4);
	return;
}

double h3d_Engine_get_fps(h3d__Engine r0) {
	double r1, r3;
	int r2;
	r1 = r0->realFps;
	r2 = 100;
	r3 = (double)r2;
	r1 = r1 * r3;
	r2 = hl_math_ceil(r1);
	r1 = (double)r2;
	r2 = 100;
	r3 = (double)r2;
	r1 = r1 / r3;
	return r1;
}

void h3d_Engine_onResized(h3d__Engine r0) {
	return;
}

void h3d_Engine_onReady(h3d__Engine r0) {
	return;
}

void h3d_Engine_onContextLost(h3d__Engine r0) {
	return;
}

void h3d_Engine_new(h3d__Engine r0,bool* r1,int* r2) {
	haxe__ds__ObjectMap r6;
	venum *r17;
	bool r3, r8;
	h3d__impl__DirectXDriver r20;
	haxe__ds__IntMap r9;
	hxd__Window r18;
	h3d__$Engine r21;
	h3d__Vector r10;
	double r19;
	vclosure *r5;
	vdynamic *r16;
	double *r11, *r12, *r13, *r14;
	int r4, r15;
	if( r1 ) goto label$608$3;
	r3 = true;
	goto label$608$4;
	label$608$3:
	r3 = *r1;
	label$608$4:
	if( r2 ) goto label$608$7;
	r4 = 0;
	goto label$608$8;
	label$608$7:
	r4 = *r2;
	label$608$8:
	r5 = r0->onContextLost;
	if( r5 ) goto label$608$12;
	r5 = hl_alloc_closure_ptr(&type$1331,h3d_Engine_onContextLost,r0);
	r0->onContextLost = r5;
	label$608$12:
	r5 = r0->onReady;
	if( r5 ) goto label$608$16;
	r5 = hl_alloc_closure_ptr(&type$1331,h3d_Engine_onReady,r0);
	r0->onReady = r5;
	label$608$16:
	r5 = r0->onResized;
	if( r5 ) goto label$608$20;
	r5 = hl_alloc_closure_ptr(&type$1331,h3d_Engine_onResized,r0);
	r0->onResized = r5;
	label$608$20:
	r6 = (haxe__ds__ObjectMap)hl_alloc_obj(haxe__ds__ObjectMap__val);
	haxe_ds_ObjectMap_new(r6);
	r0->resCache = r6;
	r8 = false;
	r0->ready = r8;
	r9 = (haxe__ds__IntMap)hl_alloc_obj(haxe__ds__IntMap__val);
	haxe_ds_IntMap_new(r9);
	r0->textureColorCache = r9;
	r10 = (h3d__Vector)hl_alloc_obj(h3d__Vector__val);
	r11 = NULL;
	r12 = NULL;
	r13 = NULL;
	r14 = NULL;
	h3d_Vector_new(r10,r11,r12,r13,r14);
	r0->tmpVector = r10;
	r15 = -16777216;
	r16 = hl_alloc_dynamic(&type$3);
	r16->v.i = r15;
	r0->backgroundColor = r16;
	r0->hardware = r3;
	r0->antiAlias = r4;
	r8 = true;
	r0->autoResize = r8;
	r17 = (venum*)global$456;
	r8 = hxd_System_getValue(r17);
	r8 = !r8;
	r8 = h3d_Engine_set_fullScreen(r0,r8);
	r18 = hxd_Window_getInstance();
	r0->window = r18;
	r19 = hxd_System_getDefaultFrameRate();
	r0->realFps = r19;
	r19 = hl_sys_time();
	r0->lastTime = r19;
	r18 = r0->window;
	if( r18 == NULL ) hl_null_access();
	r5 = hl_alloc_closure_ptr(&type$1331,h3d_Engine_onWindowResize,r0);
	hxd_Window_addResizeEvent(r18,r5);
	r20 = (h3d__impl__DirectXDriver)hl_alloc_obj(h3d__impl__DirectXDriver__val);
	h3d_impl_DirectXDriver_new(r20);
	r0->driver = ((h3d__impl__Driver)r20);
	r21 = (h3d__$Engine)global$38;
	r21->CURRENT = r0;
	return;
}

h3d__Engine h3d_Engine_getCurrent() {
	h3d__Engine r0;
	h3d__$Engine r1;
	r1 = (h3d__$Engine)global$38;
	r0 = r1->CURRENT;
	return r0;
}

