// Generated by HLC 4.0.0 (HL v4)
#include <hl/code.h>

h3d__Engine h3d_pass_ScreenFx_get_engine(h3d__pass__ScreenFx r0) {
	h3d__Engine r1;
	h3d__$Engine r2;
	r1 = r0->_engine;
	if( r1 ) goto label$2786$5;
	r2 = (h3d__$Engine)global$38;
	r1 = r2->CURRENT;
	r0->_engine = r1;
	label$2786$5:
	r1 = r0->_engine;
	return r1;
}

void h3d_pass_ScreenFx_copy(h3d__pass__ScreenFx r0,h3d__mat__Texture r1,h3d__mat__Texture r2) {
	venum *r4;
	h3d__mat__Pass r5;
	r4 = NULL;
	r5 = NULL;
	h3d_pass_Copy_run(r1,r2,r4,r5);
	return;
}

void h3d_pass_ScreenFx_setGlobals(h3d__pass__ScreenFx r0,h3d__scene__RenderContext r1) {
	hl__types__ArrayObj r4;
	h3d__pass__ShaderManager r12;
	haxe__ds__IntMap r10;
	hxsl__Globals r11;
	h3d__scene___RenderContext__SharedGlobal r7;
	vdynamic *r8;
	varray *r9;
	int r2, r5, r6;
	r2 = 0;
	if( r1 == NULL ) hl_null_access();
	r4 = r1->sharedGlobals;
	label$2788$3:
	if( r4 == NULL ) hl_null_access();
	r6 = r4->length;
	if( r2 >= r6 ) goto label$2788$26;
	r6 = r4->length;
	if( ((unsigned)r2) < ((unsigned)r6) ) goto label$2788$11;
	r7 = NULL;
	goto label$2788$14;
	label$2788$11:
	r9 = r4->array;
	r8 = ((vdynamic**)(r9 + 1))[r2];
	r7 = (h3d__scene___RenderContext__SharedGlobal)r8;
	label$2788$14:
	++r2;
	r12 = r0->manager;
	if( r12 == NULL ) hl_null_access();
	r11 = r12->globals;
	if( r11 == NULL ) hl_null_access();
	r10 = r11->map;
	if( r10 == NULL ) hl_null_access();
	if( r7 == NULL ) hl_null_access();
	r5 = r7->gid;
	r8 = r7->value;
	haxe_ds_IntMap_set(r10,r5,r8);
	goto label$2788$3;
	label$2788$26:
	return;
}

hxsl__Shader h3d_pass_ScreenFx_addShader(h3d__pass__ScreenFx r0,hxsl__Shader r1) {
	hxsl__Shader r3;
	h3d__mat__Pass r4;
	hxsl__ShaderList r2;
	r2 = r0->shaders;
	r2 = hxsl_ShaderList_addSort(r1,r2);
	r0->shaders = r2;
	r4 = r0->pass;
	if( r4 == NULL ) hl_null_access();
	r3 = h3d_mat_Pass_addShader(r4,r1);
	return r3;
}

bool h3d_pass_ScreenFx_removeShader(h3d__pass__ScreenFx r0,hxsl__Shader r1) {
	bool r7;
	hxsl__Shader r5;
	hxsl__ShaderList r2, r3, r4, r6;
	r2 = NULL;
	r3 = r0->shaders;
	label$2790$2:
	if( !r3 ) goto label$2790$20;
	if( r3 == NULL ) hl_null_access();
	r5 = r3->s;
	if( r5 != r1 ) goto label$2790$16;
	if( r2 ) goto label$2790$11;
	r4 = r3->next;
	r0->shaders = r4;
	goto label$2790$14;
	label$2790$11:
	if( r2 == NULL ) hl_null_access();
	r6 = r3->next;
	r2->next = r6;
	label$2790$14:
	r7 = true;
	return r7;
	label$2790$16:
	r2 = r3;
	r4 = r3->next;
	r3 = r4;
	goto label$2790$2;
	label$2790$20:
	r7 = false;
	return r7;
}

hxsl__Shader h3d_pass_ScreenFx_getShader(h3d__pass__ScreenFx r0,hl__Class r1) {
	bool r7;
	hxsl__Shader r5, r6;
	hxsl__ShaderList r2, r3, r4;
	r2 = r0->shaders;
	r3 = NULL;
	label$2791$2:
	if( r2 == r3 ) goto label$2791$16;
	if( r2 == NULL ) hl_null_access();
	r5 = r2->s;
	r4 = r2->next;
	r2 = r4;
	r7 = hl_BaseType_check(((hl__BaseType)r1),((vdynamic*)r5));
	if( !r7 ) goto label$2791$12;
	r6 = r5;
	goto label$2791$13;
	label$2791$12:
	r6 = NULL;
	label$2791$13:
	if( !r6 ) goto label$2791$15;
	return r6;
	label$2791$15:
	goto label$2791$2;
	label$2791$16:
	r5 = NULL;
	return r5;
}

void h3d_pass_ScreenFx_render(h3d__pass__ScreenFx r0) {
	hxsl__RuntimeShader r4;
	h3d__shader__ScreenShader r7;
	h3d__prim__Primitive r2;
	hxsl__RuntimeShaderData r18;
	venum *r12;
	h3d__pass__ShaderManager r5;
	bool r9;
	h3d__shader__ShaderBuffers r17;
	h3d__Engine r11;
	h3d__mat__Pass r15;
	hxsl__ShaderList r6;
	double r8;
	h3d__impl__Driver r10;
	vdynamic *r3;
	h3d__shader__Buffers r16;
	int r14;
	h3d__mat__Texture r13;
	r2 = r0->plane;
	if( r2 ) goto label$2792$5;
	r3 = h3d_prim_Plane2D_get();
	r2 = (h3d__prim__Primitive)hl_dyn_castp(&r3,&type$9,&type$1352);
	r0->plane = r2;
	label$2792$5:
	r5 = r0->manager;
	if( r5 == NULL ) hl_null_access();
	r6 = r0->shaders;
	r4 = h3d_pass_ShaderManager_compileShaders(r5,r6);
	r7 = r0->shader;
	if( r7 == NULL ) hl_null_access();
	r11 = h3d_pass_ScreenFx_get_engine(r0);
	if( r11 == NULL ) hl_null_access();
	r10 = r11->driver;
	if( r10 == NULL ) hl_null_access();
	r12 = (venum*)global$417;
	r9 = ((bool (*)(h3d__impl__Driver,venum*))r10->$type->vobj_proto[0])(r10,r12);
	if( !r9 ) goto label$2792$25;
	r11 = h3d_pass_ScreenFx_get_engine(r0);
	if( r11 == NULL ) hl_null_access();
	r13 = h3d_Engine_getCurrentTarget(r11);
	if( !r13 ) goto label$2792$25;
	r14 = -1;
	r8 = (double)r14;
	goto label$2792$27;
	label$2792$25:
	r14 = 1;
	r8 = (double)r14;
	label$2792$27:
	r7->flipY__ = r8;
	r11 = h3d_pass_ScreenFx_get_engine(r0);
	if( r11 == NULL ) hl_null_access();
	r15 = r0->pass;
	h3d_Engine_selectMaterial(r11,r15);
	r11 = h3d_pass_ScreenFx_get_engine(r0);
	if( r11 == NULL ) hl_null_access();
	h3d_Engine_selectShader(r11,r4);
	r16 = r0->buffers;
	if( r16 ) goto label$2792$41;
	r16 = (h3d__shader__Buffers)hl_alloc_obj(h3d__shader__Buffers__val);
	h3d_shader_Buffers_new(r16,r4);
	r0->buffers = r16;
	goto label$2792$52;
	label$2792$41:
	r16 = r0->buffers;
	if( r16 == NULL ) hl_null_access();
	r17 = r16->vertex;
	if( r17 == NULL ) hl_null_access();
	if( r4 == NULL ) hl_null_access();
	r18 = r4->vertex;
	h3d_shader_ShaderBuffers_grow(r17,r18);
	r17 = r16->fragment;
	if( r17 == NULL ) hl_null_access();
	r18 = r4->fragment;
	h3d_shader_ShaderBuffers_grow(r17,r18);
	label$2792$52:
	r5 = r0->manager;
	if( r5 == NULL ) hl_null_access();
	r16 = r0->buffers;
	h3d_pass_ShaderManager_fillGlobals(r5,r16,r4);
	r5 = r0->manager;
	if( r5 == NULL ) hl_null_access();
	r16 = r0->buffers;
	r6 = r0->shaders;
	h3d_pass_ShaderManager_fillParams(r5,r16,r4,r6);
	r11 = h3d_pass_ScreenFx_get_engine(r0);
	if( r11 == NULL ) hl_null_access();
	r16 = r0->buffers;
	r14 = 0;
	h3d_Engine_uploadShaderBuffers(r11,r16,r14);
	r11 = h3d_pass_ScreenFx_get_engine(r0);
	if( r11 == NULL ) hl_null_access();
	r16 = r0->buffers;
	r14 = 1;
	h3d_Engine_uploadShaderBuffers(r11,r16,r14);
	r11 = h3d_pass_ScreenFx_get_engine(r0);
	if( r11 == NULL ) hl_null_access();
	r16 = r0->buffers;
	r14 = 2;
	h3d_Engine_uploadShaderBuffers(r11,r16,r14);
	r2 = r0->plane;
	if( r2 == NULL ) hl_null_access();
	r11 = h3d_pass_ScreenFx_get_engine(r0);
	((void (*)(h3d__prim__Primitive,h3d__Engine))r2->$type->vobj_proto[6])(r2,r11);
	return;
}

void h3d_pass_ScreenFx_dispose(h3d__pass__ScreenFx r0) {
	return;
}

void h3d_pass_ScreenFx_new(h3d__pass__ScreenFx r0,h3d__shader__ScreenShader r1,hl__types__ArrayObj r2) {
	String r8;
	venum *r10, *r12;
	h3d__pass__ShaderManager r6;
	bool r11;
	h3d__mat__Pass r7, r9;
	hxsl__ShaderList r3, r4;
	r0->shader = r1;
	r3 = (hxsl__ShaderList)hl_alloc_obj(hxsl__ShaderList__val);
	r4 = NULL;
	hxsl_ShaderList_new(r3,((hxsl__Shader)r1),r4);
	r0->shaders = r3;
	r6 = (h3d__pass__ShaderManager)hl_alloc_obj(h3d__pass__ShaderManager__val);
	h3d_pass_ShaderManager_new(r6,r2);
	r0->manager = r6;
	r7 = (h3d__mat__Pass)hl_alloc_obj(h3d__mat__Pass__val);
	r8 = Std_string(((vdynamic*)r0));
	r3 = (hxsl__ShaderList)hl_alloc_obj(hxsl__ShaderList__val);
	r4 = NULL;
	hxsl_ShaderList_new(r3,((hxsl__Shader)r1),r4);
	r9 = NULL;
	h3d_mat_Pass_new(r7,r8,r3,r9);
	r0->pass = r7;
	r7 = r0->pass;
	if( r7 == NULL ) hl_null_access();
	r10 = (venum*)global$415;
	r10 = h3d_mat_Pass_set_culling(r7,r10);
	r7 = r0->pass;
	if( r7 == NULL ) hl_null_access();
	r11 = false;
	r12 = (venum*)global$414;
	h3d_mat_Pass_depth(r7,r11,r12);
	return;
}

