// Generated by HLC 4.0.0 (HL v4)
#include <hl/code.h>

void h3d_scene_RenderContext_emit(h3d__scene__RenderContext r0,h3d__mat__Material r1,h3d__scene__Object r2,int* r3) {
	h3d__pass__Object r8;
	h3d__mat__Pass r5, r7;
	int r4;
	if( r3 ) goto label$1229$3;
	r4 = 0;
	goto label$1229$4;
	label$1229$3:
	r4 = *r3;
	label$1229$4:
	if( r1 == NULL ) hl_null_access();
	r5 = r1->passes;
	label$1229$6:
	if( !r5 ) goto label$1229$15;
	r8 = h3d_scene_RenderContext_emitPass(r0,r5,r2);
	if( r8 == NULL ) hl_null_access();
	r8->index = r4;
	if( r5 == NULL ) hl_null_access();
	r7 = r5->nextPass;
	r5 = r7;
	goto label$1229$6;
	label$1229$15:
	return;
}

void h3d_scene_RenderContext_start(h3d__scene__RenderContext r0) {
	hl__types__ArrayObj r1;
	hl_type *r3;
	bool r8;
	h3d__pass__Object r6;
	h3d__scene__Light r5;
	double r9, r10;
	vclosure *r7;
	int r4;
	varray *r2;
	r3 = &type$2327;
	r4 = 0;
	r2 = hl_alloc_array(r3,r4);
	r1 = hl_types_ArrayObj_alloc(r2);
	r0->sharedGlobals = r1;
	r5 = NULL;
	r0->lights = r5;
	r6 = NULL;
	r0->drawPass = r6;
	r6 = NULL;
	r0->passes = r6;
	r5 = NULL;
	r0->lights = r5;
	r7 = NULL;
	r0->uploadParams = r7;
	r4 = 0;
	r0->cachedPos = r4;
	r8 = true;
	r0->visibleFlag = r8;
	r9 = r0->time;
	r10 = r0->elapsedTime;
	r9 = r9 + r10;
	r0->time = r9;
	r4 = r0->frame;
	++r4;
	r0->frame = r4;
	return;
}

void h3d_scene_RenderContext_nextPass(h3d__scene__RenderContext r0) {
	h3d__pass__Object r2;
	int r1;
	r1 = 0;
	r0->cachedPos = r1;
	r2 = NULL;
	r0->drawPass = r2;
	return;
}

vdynamic* h3d_scene_RenderContext_getGlobal(h3d__scene__RenderContext r0,String r1) {
	hl__types__ArrayObj r4;
	h3d__scene___RenderContext__SharedGlobal r7;
	vdynamic *r2, *r8, *r10;
	varray *r9;
	int r3, r5, r6;
	r2 = hxsl_Globals_allocID(r1);
	r3 = 0;
	r4 = r0->sharedGlobals;
	label$1232$3:
	if( r4 == NULL ) hl_null_access();
	r6 = r4->length;
	if( r3 >= r6 ) goto label$1232$22;
	r6 = r4->length;
	if( ((unsigned)r3) < ((unsigned)r6) ) goto label$1232$11;
	r7 = NULL;
	goto label$1232$14;
	label$1232$11:
	r9 = r4->array;
	r8 = ((vdynamic**)(r9 + 1))[r3];
	r7 = (h3d__scene___RenderContext__SharedGlobal)r8;
	label$1232$14:
	++r3;
	if( r7 == NULL ) hl_null_access();
	r5 = r7->gid;
	r10 = hl_alloc_dynamic(&type$3);
	r10->v.i = r5;
	if( r10 != r2 && (!r10 || !r2 || (r10->v.i != r2->v.i)) ) goto label$1232$21;
	r8 = r7->value;
	return r8;
	label$1232$21:
	goto label$1232$3;
	label$1232$22:
	r8 = NULL;
	return r8;
}

void h3d_scene_RenderContext_setGlobal(h3d__scene__RenderContext r0,String r1,vdynamic* r2) {
	vdynamic *r4;
	int r5;
	r4 = hxsl_Globals_allocID(r1);
	r5 = r4 ? r4->v.i : 0;
	h3d_scene_RenderContext_setGlobalID(r0,r5,r2);
	return;
}

void h3d_scene_RenderContext_setGlobalID(h3d__scene__RenderContext r0,int r1,vdynamic* r2) {
	hl__types__ArrayObj r5;
	h3d__scene___RenderContext__SharedGlobal r8;
	vdynamic *r9;
	varray *r10;
	int r3, r6, r7;
	r3 = 0;
	r5 = r0->sharedGlobals;
	label$1234$2:
	if( r5 == NULL ) hl_null_access();
	r7 = r5->length;
	if( r3 >= r7 ) goto label$1234$20;
	r7 = r5->length;
	if( ((unsigned)r3) < ((unsigned)r7) ) goto label$1234$10;
	r8 = NULL;
	goto label$1234$13;
	label$1234$10:
	r10 = r5->array;
	r9 = ((vdynamic**)(r10 + 1))[r3];
	r8 = (h3d__scene___RenderContext__SharedGlobal)r9;
	label$1234$13:
	++r3;
	if( r8 == NULL ) hl_null_access();
	r6 = r8->gid;
	if( r6 != r1 ) goto label$1234$19;
	r8->value = r2;
	return;
	label$1234$19:
	goto label$1234$2;
	label$1234$20:
	r5 = r0->sharedGlobals;
	if( r5 == NULL ) hl_null_access();
	r8 = (h3d__scene___RenderContext__SharedGlobal)hl_alloc_obj(h3d__scene___RenderContext__SharedGlobal__val);
	h3d_scene__RenderContext_SharedGlobal_new(r8,r1,r2);
	r3 = hl_types_ArrayObj_push(r5,((vdynamic*)r8));
	return;
}

h3d__pass__Object h3d_scene_RenderContext_emitPass(h3d__scene__RenderContext r0,h3d__mat__Pass r1,h3d__scene__Object r2) {
	h3d__pass__Object r3, r5, r6;
	r3 = r0->pool;
	if( r3 ) goto label$1235$9;
	r5 = (h3d__pass__Object)hl_alloc_obj(h3d__pass__Object__val);
	h3d_pass_Object_new(r5);
	r3 = r5;
	r6 = r0->firstAlloc;
	r5->nextAlloc = r6;
	r0->firstAlloc = r5;
	goto label$1235$12;
	label$1235$9:
	if( r3 == NULL ) hl_null_access();
	r5 = r3->nextAlloc;
	r0->pool = r5;
	label$1235$12:
	r3->pass = r1;
	r3->obj = r2;
	r6 = r0->passes;
	r3->next = r6;
	r0->passes = r3;
	return r3;
}

hxsl__ShaderList h3d_scene_RenderContext_allocShaderList(h3d__scene__RenderContext r0,hxsl__Shader r1,hxsl__ShaderList r2) {
	hl__types__ArrayObj r3;
	hxsl__Shader r11;
	hxsl__ShaderList r6, r10, r12;
	vdynamic *r7;
	varray *r8;
	int r4, r5;
	r3 = r0->cachedShaderList;
	if( r3 == NULL ) hl_null_access();
	r4 = r0->cachedPos;
	r5 = r4;
	++r4;
	r0->cachedPos = r4;
	r4 = r3->length;
	if( ((unsigned)r5) < ((unsigned)r4) ) goto label$1236$10;
	r6 = NULL;
	goto label$1236$13;
	label$1236$10:
	r8 = r3->array;
	r7 = ((vdynamic**)(r8 + 1))[r5];
	r6 = (hxsl__ShaderList)r7;
	label$1236$13:
	if( r6 ) goto label$1236$29;
	r10 = (hxsl__ShaderList)hl_alloc_obj(hxsl__ShaderList__val);
	r11 = NULL;
	r12 = NULL;
	hxsl_ShaderList_new(r10,r11,r12);
	r6 = r10;
	r3 = r0->cachedShaderList;
	if( r3 == NULL ) hl_null_access();
	r4 = r0->cachedPos;
	r5 = 1;
	r4 = r4 - r5;
	r5 = r3->length;
	if( ((unsigned)r4) < ((unsigned)r5) ) goto label$1236$27;
	hl_types_ArrayObj___expand(r3,r4);
	label$1236$27:
	r8 = r3->array;
	((hxsl__ShaderList*)(r8 + 1))[r4] = r10;
	label$1236$29:
	if( r6 == NULL ) hl_null_access();
	r6->s = r1;
	r6->next = r2;
	return r6;
}

void h3d_scene_RenderContext_emitLight(h3d__scene__RenderContext r0,h3d__scene__Light r1) {
	h3d__scene__Light r2;
	if( r1 == NULL ) hl_null_access();
	r2 = r0->lights;
	r1->next = r2;
	r0->lights = r1;
	return;
}

void h3d_scene_RenderContext_done(h3d__scene__RenderContext r0) {
	hxsl__RuntimeShader r7;
	hl__types__ArrayObj r11;
	hxsl__Shader r15;
	h3d__pass__Object r1, r4, r9;
	hxsl__ShaderList r8, r16;
	h3d__mat__Pass r6;
	h3d__scene__Light r17;
	vclosure *r2;
	vdynamic *r13;
	varray *r14;
	int r10, r12;
	h3d__scene__Object r5;
	r1 = NULL;
	r0->drawPass = r1;
	r2 = NULL;
	r0->uploadParams = r2;
	r1 = r0->firstAlloc;
	label$1238$5:
	if( !r1 ) goto label$1238$25;
	if( r1 == NULL ) hl_null_access();
	r5 = NULL;
	r1->obj = r5;
	r6 = NULL;
	r1->pass = r6;
	r7 = NULL;
	r1->shader = r7;
	r8 = NULL;
	r1->shaders = r8;
	r9 = NULL;
	r1->next = r9;
	r10 = 0;
	r1->index = r10;
	r10 = 0;
	r1->texture = r10;
	r4 = r1->nextAlloc;
	r1 = r4;
	goto label$1238$5;
	label$1238$25:
	r4 = r0->firstAlloc;
	r0->pool = r4;
	r10 = 0;
	r11 = r0->cachedShaderList;
	label$1238$29:
	if( r11 == NULL ) hl_null_access();
	r12 = r11->length;
	if( r10 >= r12 ) goto label$1238$47;
	r12 = r11->length;
	if( ((unsigned)r10) < ((unsigned)r12) ) goto label$1238$37;
	r8 = NULL;
	goto label$1238$40;
	label$1238$37:
	r14 = r11->array;
	r13 = ((vdynamic**)(r14 + 1))[r10];
	r8 = (hxsl__ShaderList)r13;
	label$1238$40:
	++r10;
	if( r8 == NULL ) hl_null_access();
	r15 = NULL;
	r8->s = r15;
	r16 = NULL;
	r8->next = r16;
	goto label$1238$29;
	label$1238$47:
	r4 = NULL;
	r0->passes = r4;
	r17 = NULL;
	r0->lights = r17;
	return;
}

void h3d_scene_RenderContext_new(h3d__scene__RenderContext r0) {
	hl__types__ArrayObj r2;
	hl_type *r4;
	int r5;
	varray *r3;
	h3d_impl_RenderContext_new(((h3d__impl__RenderContext)r0));
	r4 = &type$141;
	r5 = 0;
	r3 = hl_alloc_array(r4,r5);
	r2 = hl_types_ArrayObj_alloc(r3);
	r0->cachedShaderList = r2;
	return;
}

